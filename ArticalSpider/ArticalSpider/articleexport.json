[
{"url_object_id": "02652b201d914ce5fe67ea168ab4d993", "title": "Linux 命令行工具使用小贴士及技巧（3）", "url": "http://blog.jobbole.com/110845/", "create_date": "2017/04/11", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/23426c26d6b88a782a1d894de8e89bca.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,命令行", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/tutorial/linux-command-line-tips-tricks-part-3-cdpath/\">Ansh</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8387-1.html\">HaitaoBio</a>   </div><p>在这个系列的<a href=\"http://blog.jobbole.com/110739/\">第一部分</a>，我们详细地讨论了 <code>cd -</code> 命令，在<a href=\"http://blog.jobbole.com/110774/\">第二部分</a>，我们深入探究了 <code>pushd</code> 和 <code>popd</code> 两个命令，以及它们使用的场景。</p>\n<p>继续对命令行的讨论，在这篇教程中，我们将会通过简单易懂的实例来讨论 <code>CDPATH</code> 这个环境变量。我们也会讨论关于此变量的一些进阶细节。</p>\n<p><em>在这之前，先声明一下此教程中的所有实例都已经在 Ubuntu 14.04 和 4.3.11(1) 版本的 Bash 下测试过。</em></p>\n<h3 id=\"toc_1\">环境变量 CDPATH</h3>\n<p>即使你的命令行所有操作都在特定的目录下 – 例如你的主目录，然而在你切换目录时也不得不提供绝对路径。比如，考虑我现在的情况，就是在 <code>/home/himanshu/Downloads</code> 目录下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d68fe061596455\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pwd\r\n/home/himanshu/Downloads\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d68fe061596455-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d68fe061596455-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d68fe061596455-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d68fe061596455-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d68fe061596455-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">himanshu</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">Downloads</span></div><div class=\"crayon-line\" id=\"crayon-58f7dc78d68fe061596455-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在要求切换至 <code>/home/himanshu/Desktop</code> 目录，我一般会这样做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d6907261599037\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd /home/himanshu/Desktop/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d6907261599037-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d6907261599037-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d6907261599037-1\"><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">himanshu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Desktop</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d6907261599037-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d690b667350542\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd ~/Desktop/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d690b667350542-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d690b667350542-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d690b667350542-1\"><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Desktop</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d690b667350542-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d690e080656031\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd ../Desktop/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d690e080656031-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d690e080656031-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d690e080656031-1\"><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Desktop</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d690e080656031-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>能不能只是运行以下命令就能简单地实现呢：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d6911172785431\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd Desktop\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d6911172785431-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d6911172785431-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d6911172785431-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-i\">Desktop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d6911172785431-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>是的，这完全有可能。这就是环境变量 <code>CDPATH</code> 出现的时候了。你可使用这个变量来为 <code>cd</code> 命令定义基础目录。</p>\n<p>如果你尝试打印它的值，你会看见这个环境变量默认是空值的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d6914473945678\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ echo $CDPATH\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d6914473945678-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d6914473945678-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d6914473945678-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">CDPATH</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d6914473945678-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>现在 ，考虑到上面提到的场景，我们使用这个环境变量，将 <code>/home/himanshu</code> 作为 <code>cd</code> 命令的基础目录来使用。</p>\n<p>最简单的做法这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d6918190719531\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nexport CDPATH=/home/himanshu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d6918190719531-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d6918190719531-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d6918190719531-1\"><span class=\"crayon-e\">export </span><span class=\"crayon-v\">CDPATH</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">himanshu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d6918190719531-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>现在，我能做到之前所不能做到的事了 – 当前工作目录在 <code>/home/himanshu/Downloads</code> 目录里时，成功地运行了 <code>cd Desktop</code> 命令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d691b319138020\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pwd\r\n/home/himanshu/Downloads\r\n$ cd Desktop/\r\n/home/himanshu/Desktop\r\n$\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d691b319138020-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d691b319138020-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d691b319138020-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d691b319138020-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d691b319138020-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d691b319138020-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d691b319138020-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d691b319138020-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">himanshu</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">Downloads</span></div><div class=\"crayon-line\" id=\"crayon-58f7dc78d691b319138020-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">Desktop</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d691b319138020-4\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">himanshu</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">Desktop</span></div><div class=\"crayon-line\" id=\"crayon-58f7dc78d691b319138020-5\"><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d691b319138020-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这表明了我可以使用 <code>cd</code> 命令来到达 <code>/home/himanshu</code> 下的任意一个目录，而不需要在 <code>cd</code> 命令中显式地指定 <code>/home/himanshu</code> 或者 <code>~</code>，又或者是 <code>../</code> (或者多个 <code>../</code>)。</p>\n<h3 id=\"toc_2\">要点</h3>\n<p>现在你应该知道了怎样利用环境变量 <code>CDPATH</code> 在 <code>/home/himanshu/Downloads</code> 和 <code>/home/himanshu/Desktop</code> 之间轻松切换。现在，考虑以下这种情况， 在 <code>/home/himanshu/Desktop</code> 目录里包含一个名字叫做 <code>Downloads</code> 的子目录，这是将要切换到的目录。</p>\n<p>但突然你会意识到 <code>cd Downloads</code> 会切换到 <code>/home/himanshu/Downloads</code>。所以，为了确保这不会发生，你可以这样做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d691e236329867\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd ./Downloads\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d691e236329867-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d691e236329867-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d691e236329867-1\"><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">Downloads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d691e236329867-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>虽然上述命令本身没有问题，但你还是需要耗费点额外的精力（虽然很小），尤其是每次这种情况发生时你都不得不这样做。所以，有一个更加优雅的解决方案来处理，就是以如下方式来设定 <code>CDPATH</code> 环境变量。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d6924598609871\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nexport CDPATH=\".:/home/himanshu\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d6924598609871-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d6924598609871-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d6924598609871-1\"><span class=\"crayon-e\">export </span><span class=\"crayon-v\">CDPATH</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\".:/home/himanshu\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d6924598609871-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>它的意思是告诉 <code>cd</code> 命令先在当前的工作目录查找该目录，然后再尝试搜寻 <code>/home/himanshu</code> 目录。当然， <code>cd</code> 命令是否以这样的方式运行，完全取决于你的偏好和要求 – 讨论这一点的目的是为了让你知道这种情况可能会发生。</p>\n<p>就如你现在所知道的，一旦环境变量 <code>CDPATH</code> 被设置，它的值 – 或者它所包含的路径集合 – 就是系统中 <code>cd</code> 命令搜索目录的地方 ( 当然除了使用绝对路径的场景 )。所以，完全取决于你来确保该命令行为的一致性。</p>\n<p>继续说，如果一个 bash 脚本以相对路径使用 <code>cd</code> 命令，最好还是先清除或者重置环境变量 <code>CDPATH</code>，除非你觉得遇上不可预测的麻烦也无所谓。还有一个可选的方法，比起在终端使用 <code>export</code> 命令来设置 <code>CDPATH</code>，你可以在测试完当前的 shell 是交互式还是非交互式之后，再在你的 <code>.bashrc</code> 文件里设置环境变量，这样可以确保你对环境变量的改动只对交互式 shell 生效。</p>\n<p>环境变量中，路径出现的顺序同样也是很重要。举个例子，如果当前目录是在 <code>/home/himanshu</code> 目录之前列出来，<code>cd</code> 命令就会先搜索当前的工作目录然后才会搜索 <code>/home/himanshu</code> 目录。然而，如果该值为 <code>/home/himanshu:.</code>，搜索就首先从 <code>/home/himanshu</code> 开始，然后到当前目录。不用说，这会影响 <code>cd</code> 命令的行为，并且不注意路径的顺序可能会导致一些麻烦。</p>\n<p>要牢记在心的是，环境变量 <code>CDPATH</code>，就像其名字表达的，只对 <code>cd</code> 命令有作用。意味着在 <code>/home/himanshu/Downloads</code> 目录里面时，你能运行 <code>cd Desktop</code> 命令来切换到 <code>/home/himanshu/Desktop</code> 目录，但你不能使用 <code>ls</code>。以下是一个例子:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d6928258558350\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pwd\r\n/home/himanshu/Downloads\r\n$ ls Desktop\r\nls: cannot access Desktop: No such file or directory\r\n$\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d6928258558350-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d6928258558350-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d6928258558350-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d6928258558350-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d6928258558350-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d6928258558350-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d6928258558350-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d6928258558350-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">himanshu</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">Downloads</span></div><div class=\"crayon-line\" id=\"crayon-58f7dc78d6928258558350-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls </span><span class=\"crayon-e\">Desktop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d6928258558350-4\"><span class=\"crayon-v\">ls</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cannot </span><span class=\"crayon-e\">access </span><span class=\"crayon-v\">Desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">No </span><span class=\"crayon-e\">such </span><span class=\"crayon-e\">file </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">directory</span></div><div class=\"crayon-line\" id=\"crayon-58f7dc78d6928258558350-5\"><span class=\"crayon-sy\">$</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d6928258558350-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>然而，这还是有简单的变通处理的。例如，我们可以用以下不怎么费力的方式来达到目的:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d692c266617163\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cd Desktop/;ls\r\n/home/himanshu/Desktop\r\nbackup backup~ Downloads gdb.html outline~ outline.txt outline.txt~\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d692c266617163-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d692c266617163-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d692c266617163-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d692c266617163-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d692c266617163-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">Desktop</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d692c266617163-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">himanshu</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">Desktop</span></div><div class=\"crayon-line\" id=\"crayon-58f7dc78d692c266617163-3\"><span class=\"crayon-e\">backup </span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Downloads </span><span class=\"crayon-v\">gdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">html </span><span class=\"crayon-v\">outline</span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outline</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">outline</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d692c266617163-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>不过，不是每种情况就能变通处理的。</p>\n<p>另一个重点是：就像你可能已经观察到的，每次你使用 <code>CDPATH</code> 环境变量集来运行 <code>cd</code> 命令时，该命令都会在输出里显示你切换到的目录的完整路径。不用说，不是所有人都想在每次运行 <code>cd</code> 命令时看到这些信息。</p>\n<p>为了确保该输出被制止，你可以使用以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7dc78d692f813042133\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalias cd='&gt;/dev/null cd'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7dc78d692f813042133-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7dc78d692f813042133-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7dc78d692f813042133-1\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">cd</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'&gt;/dev/null cd'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7dc78d692f813042133-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果 <code>cd</code> 命令运行成功，上述命令不会输出任何东西，如果失败，则允许产生错误信息。</p>\n<p>最后，假如你遇到设置 <code>CDPATH</code> 环境变量后，不能使用 shell 的 tab 自动补全功能的问题，可以尝试安装并启用 bash 自动补全（bash-completion）。更多请参考 <a href=\"http://bash-completion.alioth.debian.org/\">这里</a>。</p>\n<h3 id=\"toc_3\">总结</h3>\n<p><code>CDPATH</code> 环境变量时一把双刃剑，如果没有掌握完善的知识和随意使用，可能会令你陷入困境，并花费你大量宝贵时间去解决问题。当然，这不代表你不应该去试一下；只需要了解一下所有的可用选项，如果你得出结论，使用 <code>CDPATH</code> 会带来很大的帮助，就继续使用它吧。</p>\n<p>你已经能够熟练地使用 <code>CDPATH</code> 了吗？你有更多的贴士要分享？请在评论区里发表一下你的想法吧。</p>\n<p>请使用手机”扫一扫”x</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110845\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110845votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110845\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "c99467353ce7e258605062a58336b2bc", "title": "在微服务中使用领域事件", "url": "http://blog.jobbole.com/110931/", "create_date": "2017/04/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/01/bb278c4985b1e32dab4f29c11a7c0bdc.png"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,微服务,领域事件", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>稍微回想一下计算机硬件的工作原理我们便不难发现，整个计算机的工作过程其实就是一个对事件的处理过程。当你点击鼠标、敲击键盘或者插上U盘时，计算机便以中断的形式处理各种外部事件。在软件开发领域，<a href=\"https://en.wikipedia.org/wiki/Event-driven_architecture\">事件驱动架构</a>（Event Driven Architecture，EDA）早已被开发者用于各种实践，典型的应用场景比如浏览器对用户输入的处理、消息机制以及SOA。最近几年重新进入开发者视野的<a href=\"https://en.wikipedia.org/wiki/Reactive_programming\">响应式编程</a>（Reactive Programming）更是将事件作为该编程模型中的一等公民。可见，“事件”这个概念一直在计算机科学领域中扮演着重要的角色。</p>\n<h3>认识领域事件</h3>\n<p><a href=\"https://martinfowler.com/eaaDev/DomainEvent.html\">领域事件</a>（Domain Events）是<a href=\"https://en.wikipedia.org/wiki/Domain-driven_design\">领域驱动设计</a>（Domain Driven Design，DDD）中的一个概念，用于捕获我们所建模的领域中所发生过的事情。领域事件本身也作为通用语言（Ubiquitous Language）的一部分成为包括领域专家在内的所有项目成员的交流用语。比如，在用户注册过程中，我们可能会说“当用户注册成功之后，发送一封欢迎邮件给客户。”，此时的“用户已经注册”便是一个领域事件。</p>\n<p>当然，并不是所有发生过的事情都可以成为领域事件。一个领域事件必须对业务有价值，有助于形成完整的业务闭环，也即一个领域事件将导致进一步的业务操作。举个咖啡厅建模的例子，当客户来到前台时将产生“客户已到达”的事件，如果你关注的是客户接待，比如需要为客户预留位置等，那么此时的“客户已到达”便是一个典型的领域事件，因为它将用于触发下一步——“预留位置”操作；但是如果你建模的是咖啡结账系统，那么此时的“客户已到达”便没有多大存在的必要——你不可能在用户到达时就立即向客户要钱对吧，而”客户已下单“才是对结账系统有用的事件。</p>\n<p>在<a href=\"https://martinfowler.com/articles/microservices.html\">微服务</a>（Microservices）架构实践中，人们大量地借用了DDD中的概念和技术，比如一个微服务应该对应DDD中的一个限界上下文（Bounded Context）；在微服务设计中应该首先识别出DDD中的聚合根（Aggregate Root）；还有在微服务之间集成时采用DDD中的防腐层（Anti-Corruption Layer, ACL）；我们甚至可以说DDD和微服务有着天生的默契。更多有关DDD的内容，请参考笔者的<a href=\"http://www.cnblogs.com/davenkin/p/road-to-ddd.html\">另一篇</a>文章或参考<a href=\"https://book.douban.com/subject/5344973/\">《领域驱动设计》</a>及<a href=\"https://book.douban.com/subject/25844633/\">《实现领域驱动设计》</a>。</p>\n<p><strong>在DDD中有一条原则：一个业务用例对应一个事务，一个事务对应一个聚合根，也即在一次事务中，只能对一个聚合根进行操作。</strong>但是在实际应用中，我们经常发现一个用例需要修改多个聚合根的情况，并且不同的聚合根还处于不同的限界上下文中。比如，当你在电商网站上买了东西之后，你的积分会相应增加。这里的购买行为可能被建模为一个订单（Order）对象，而积分可以建模成账户（Account）对象的某个属性，订单和账户均为聚合根，并且分别属于订单系统和账户系统。显然，我们需要在订单和积分之间维护数据一致性，通常的做法是在同一个事务中同时更新两者，但是这会存在以下问题：</p>\n<ul>\n<li>违背DDD中”单个事务修改单个聚合根”的设计原则；</li>\n<li>需要在不同的系统之间采用重量级的<a href=\"https://en.wikipedia.org/wiki/Distributed_transaction\">分布式事务</a>（Distributed Transactioin，也叫XA事务或者全局事务）；</li>\n<li>在不同系统之间产生强耦合。</li>\n</ul>\n<p>通过引入领域事件，我们可以很好地解决上述问题。 总的来说，领域事件给我们带来以下好处：</p>\n<ul>\n<li>解耦微服务（限界上下文）；</li>\n<li>帮助我们深入理解领域模型；</li>\n<li>提供审计和报告的数据来源；</li>\n<li>迈向<a href=\"https://martinfowler.com/eaaDev/EventSourcing.html\">事件溯源</a>（Event Sourcing）和<a href=\"https://martinfowler.com/bliki/CQRS.html\">CQRS</a>等。</li>\n</ul>\n<p>还是以上面的电商网站为例，当用户下单之后，订单系统将发出一个“用户已下单”的领域事件，并发布到消息系统中，此时下单便完成了。账户系统订阅了消息系统中的“用户已下单”事件，当事件到达时进行处理，提取事件中的订单信息，再调用自身的积分引擎（也有可能是另一个微服务）计算积分，最后更新用户积分。可以看到，此时的订单系统在发送了事件之后，整个用例操作便结束了，根本不用关心是谁收到了事件或者对事件做了什么处理。事件的消费方可以是账户系统，也可以是任何一个对事件感兴趣的第三方，比如物流系统。由此，各个微服务之间的耦合关系便解开了。<strong>值得注意的一点是，此时各个微服务之间不再是强一致性，而是基于事件的最终一致性。</strong></p>\n<h3>事件风暴（Event Storming）</h3>\n<p><strong>事件风暴是一项团队活动，旨在通过领域事件识别出聚合根，进而划分微服务的限界上下文。</strong>在活动中，团队先通过头脑风暴的形式罗列出领域中所有的领域事件，整合之后形成最终的领域事件集合，然后对于每一个事件，标注出导致该事件的命令（Command），再然后为每个事件标注出命令发起方的角色，命令可以是用户发起，也可以是第三方系统调用或者是定时器触发等。最后对事件进行分类整理出聚合根以及限界上下文。事件风暴还有一个额外的好处是可以加深参与人员对领域的认识。需要注意的是，在事件风暴活动中，领域专家是必须在场的。更多有关事件风暴的内容，请参考<a href=\"https://techbeacon.com/introduction-event-storming-easy-way-achieve-domain-driven-design\">这里</a>。</p>\n<h3>创建领域事件</h3>\n<p>领域事件应该回答“什么人什么时候做了什么事情”这样的问题，在实际编码中，可以考虑采用<a href=\"https://martinfowler.com/eaaCatalog/layerSupertype.html\">层超类型</a>(Layer Supertype)来包含事件的某些共有属性：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f8480a7a8d7963026101\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic abstract class Event {\r\n    private final UUID id;\r\n    private final DateTime createdTime;\r\n\r\n    public Event() {\r\n        this.id = UUID.randomUUID();\r\n        this.createdTime = new DateTime();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8d7963026101-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8d7963026101-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8d7963026101-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8d7963026101-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8d7963026101-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8d7963026101-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8d7963026101-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8d7963026101-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8d7963026101-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f8480a7a8d7963026101-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Event</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8d7963026101-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UUID </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8d7963026101-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DateTime </span><span class=\"crayon-v\">createdTime</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8d7963026101-4\"> </div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8d7963026101-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Event</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8d7963026101-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UUID</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">randomUUID</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8d7963026101-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">createdTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DateTime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8d7963026101-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8d7963026101-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>可以看到，领域事件还包含了ID，但是该ID并不是实体（Entity）层面的ID概念，而是主要用于事件追溯和日志。另外，由于领域事件描述的是过去发生的事情，我们应该将领域事件建模成<a href=\"https://en.wikipedia.org/wiki/Immutable_object\">不可变的</a>（Immutable）。从DDD概念上讲，领域事件更像一种特殊的值对象（Value Object）。对于上文中提到的咖啡厅例子，创建“客户已到达”事件如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f8480a7a8e5673937464\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic final class CustomerArrivedEvent extends Event {\r\n    private final int customerNumber;\r\n\r\n    public CustomerArrivedEvent(int customerNumber) {\r\n        super();\r\n        this.customerNumber = customerNumber;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8e5673937464-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8e5673937464-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8e5673937464-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8e5673937464-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8e5673937464-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8e5673937464-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8e5673937464-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8e5673937464-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f8480a7a8e5673937464-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CustomerArrivedEvent</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Event</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8e5673937464-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">customerNumber</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8e5673937464-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8e5673937464-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CustomerArrivedEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">customerNumber</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8e5673937464-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8e5673937464-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">customerNumber</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">customerNumber</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8e5673937464-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8e5673937464-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>在这个CustomerArrivedEvent事件中，除了继承自Event的属性外，还自定义了一个与该事件密切关联的业务属性——客户人数（customerNumber）——这样后续操作便可预留相应数目的座位了。另外，我们将所有属性以及CustomerArrivedEvent本身都声明成了final，并且不向外暴露任何可能修改这些属性的方法，这样便保证了事件的不变性。</p>\n<h3>发布领域事件</h3>\n<p>在使用领域事件时，我们通常采用“发布-订阅”的方式来集成不同的模块或系统。在单个微服务内部，我们可以使用领域事件来集成不同的功能组件，比如在上文中提到的“用户注册之后向用户发送欢迎邮件”的例子中，注册组件发出一个事件，邮件发送组件接收到该事件后向用户发送邮件。</p>\n<p>在微服务内部使用领域事件时，我们不一定非得引入消息中间件（比如ActiveMQ等）。还是以上面的“注册后发送欢迎邮件”为例，注册行为和发送邮件行为虽然通过领域事件集成，但是他们依然发生在同一个线程中，并且是同步的。另外需要注意的是，在限界上下文之内使用领域事件时，我们依然需要遵循“一个事务只更新一个聚合根”的原则，违反之往往意味着我们对聚合根的拆分是错的。即便确实存在这样的情况，也应该通过异步的方式（此时需要引入消息中间件）对不同的聚合根采用不同的事务，此时可以考虑使用后台任务。</p>\n<p>除了用于微服务的内部，领域事件更多的是被用于集成不同的微服务，如上文中的“电商订单”例子。</p>\n<p>通常，领域事件产生于领域对象中，或者更准确的说是产生于聚合根中。在具体编码实现时，有多种方式可用于发布领域事件。</p>\n<p>一种直接的方式是在聚合根中直接调用发布事件的Service对象。以上文中的“电商订单”为例，当创建订单时，发布“订单已创建”领域事件。此时可以考虑在订单对象的构造函数中发布事件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f8480a7a8eb279694301\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Order {\r\n    public Order(EventPublisher eventPublisher) {\r\n        //create order        \r\n        //…        \r\n        eventPublisher.publish(new OrderPlacedEvent());    \r\n        }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8eb279694301-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8eb279694301-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8eb279694301-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8eb279694301-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8eb279694301-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8eb279694301-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8eb279694301-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f8480a7a8eb279694301-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Order</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8eb279694301-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Order</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">EventPublisher </span><span class=\"crayon-v\">eventPublisher</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8eb279694301-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//create order        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8eb279694301-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//…        </span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8eb279694301-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">eventPublisher</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">publish</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OrderPlacedEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8eb279694301-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8eb279694301-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>注：为了把焦点集中在事件发布上，我们对Order对象做了简化，Order对象本身在实际编码中不具备参考性。</p>\n<p>可以看到，为了发布OrderPlacedEvent事件，我们需要将Service对象EventPublisher传入，这显然是一种API污染，即Order作为一个领域对象只需要关注和业务相关的数据，而不是诸如EventPublisher这样的基础设施对象。<a href=\"http://udidahan.com/2009/06/14/domain-events-salvation/\">另一种方法</a>是由NServiceBus的创始人<a href=\"http://udidahan.com/\">Udi Dahan</a>提出来的，即在领域对象中通过调用EventPublisher上的静态方法发布领域事件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f8480a7a8ef039844111\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n public class Order {\r\n    public Order() {\r\n        //create order\r\n        //...\r\n        EventPublisher.publish(new OrderPlacedEvent());\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8ef039844111-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8ef039844111-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8ef039844111-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8ef039844111-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8ef039844111-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8ef039844111-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8ef039844111-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f8480a7a8ef039844111-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Order</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8ef039844111-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Order</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8ef039844111-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//create order</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8ef039844111-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//...</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8ef039844111-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">EventPublisher</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">publish</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OrderPlacedEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8ef039844111-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8ef039844111-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>这种方法虽然避免了API污染，但是这里的publish()静态方法将产生副作用，对Order对象的测试带来了难处。此时，我们可以采用“<a href=\"https://lostechies.com/jimmybogard/2014/05/13/a-better-domain-events-pattern/\">在聚合根中临时保存领域事件</a>”的方式予以改进：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f8480a7a8f5006694824\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Order {\r\n\r\n    private List events;\r\n\r\n    public Order() {\r\n        //create order\r\n        //...\r\n        events.add(new OrderPlacedEvent());\r\n    }\r\n\r\n    public List getEvents() {\r\n        return events;\r\n    }\r\n\r\n    public void clearEvents() {\r\n        events.clear();\r\n\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f5006694824-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f5006694824-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f5006694824-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f5006694824-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f5006694824-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f5006694824-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f5006694824-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f5006694824-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f5006694824-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f5006694824-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f5006694824-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f5006694824-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f5006694824-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f5006694824-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f5006694824-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f5006694824-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f5006694824-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f5006694824-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f5006694824-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f5006694824-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Order</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f5006694824-2\"> </div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f5006694824-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">List </span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f5006694824-4\"> </div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f5006694824-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Order</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f5006694824-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//create order</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f5006694824-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f5006694824-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OrderPlacedEvent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f5006694824-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f5006694824-10\"> </div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f5006694824-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">getEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f5006694824-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f5006694824-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f5006694824-14\"> </div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f5006694824-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">clearEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f5006694824-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f5006694824-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f5006694824-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f5006694824-19\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>在测试Order对象时，我们便你可以通过验证events集合保证Order对象在创建时的确发布了OrderPlacedEvent事件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f8480a7a8f9438505931\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@ Test\r\npublic void shouldPublishEventWhenCreateOrder() {\r\n    Order order = new Order();\r\n    List events = order.getEvents();\r\n    assertEquals(1, events.size());\r\n    Event event = events.get(0);\r\n    assertTrue(event instanceof OrderPlacedEvent);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f9438505931-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f9438505931-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f9438505931-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f9438505931-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f9438505931-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f9438505931-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8f9438505931-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8f9438505931-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f9438505931-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f9438505931-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shouldPublishEventWhenCreateOrder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f9438505931-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Order </span><span class=\"crayon-v\">order</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Order</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f9438505931-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">List </span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">order</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f9438505931-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">assertEquals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f9438505931-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Event </span><span class=\"crayon-v\">event</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8f9438505931-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">assertTrue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">event </span><span class=\"crayon-r\">instanceof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OrderPlacedEvent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8f9438505931-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>在这种方式中，聚合根对领域事件的保存只能是临时的，在对该聚合根操作完成之后，我们应该将领域事件发布出去并及时清空events集合。可以考虑在持久化聚合根时进行这样的操作，在DDD中即为资源库（Repository）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f8480a7a8fc097357587\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class OrderRepository {\r\n    private EventPublisher eventPublisher;\r\n\r\n    public void save(Order order) {\r\n        List events = order.getEvents();\r\n        events.forEach(event -&gt; eventPublisher.publish(event));\r\n        order.clearEvents();\r\n\r\n        //save the order\r\n        //...\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8fc097357587-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8fc097357587-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8fc097357587-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8fc097357587-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8fc097357587-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8fc097357587-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8fc097357587-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8fc097357587-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8fc097357587-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8fc097357587-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f8480a7a8fc097357587-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f8480a7a8fc097357587-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f8480a7a8fc097357587-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OrderRepository</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8fc097357587-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EventPublisher </span><span class=\"crayon-v\">eventPublisher</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8fc097357587-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8fc097357587-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Order </span><span class=\"crayon-v\">order</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8fc097357587-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">List </span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">order</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8fc097357587-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">event</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventPublisher</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">publish</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8fc097357587-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">order</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clearEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8fc097357587-8\"> </div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8fc097357587-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//save the order</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8fc097357587-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//...</span></div><div class=\"crayon-line\" id=\"crayon-58f8480a7a8fc097357587-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f8480a7a8fc097357587-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>除此之外，还有一种与“临时保存领域事件”相似的做法是“<a href=\"https://blog.jayway.com/2013/06/20/dont-publish-domain-events-return-them/\">在聚合根方法中直接返回领域事件</a>”，然后在Repository中进行发布。这种方式依然有很好的可测性，并且开发人员不用手动清空先前的事件集合，不过还是得记住在Repository中将事件发布出去。另外，这种方式不适合创建聚合根的场景，因为此时的创建过程既要返回聚合根本身，又要返回领域事件。</p>\n<p>这种方式也有不好的地方，比如它要求开发人员在每次更新聚合根时都必须记得清空events集合，忘记这么做将为程序带来严重的bug。不过虽然如此，这依然是笔者比较推荐的方式。</p>\n<h3>业务操作和事件发布的原子性</h3>\n<p>虽然在不同聚合根之间我们采用了基于领域事件的最终一致性，但是在业务操作和事件发布之间我们依然需要采用强一致性，也即这两者的发生应该是原子的，要么全部成功，要么全部失败，否则最终一致性根本无从谈起。以上文中“订单积分”为例，如果客户下单成功，但是事件发送失败，下游的账户系统便拿不到事件，导致最终客户的积分并不增加。</p>\n<p>要保证业务操作和事件发布之间的原子性，最直接的方法便是采用XA事务，比如Java中的<a href=\"https://en.wikipedia.org/wiki/Java_Transaction_API\">JTA</a>，这种方式由于其重量级并不被人们所看好。但是，对于一些对性能要求不那么高的系统，这种方式未尝不是一个选择。一些开发框架已经能够支持独立于应用服务器的XA事务管理器（如<a href=\"https://www.atomikos.com/\">Atomikos</a>和<a href=\"https://github.com/bitronix/btm\">Bitronix</a>），比如Spring Boot作为一个微服务框架便提供了对Atomikos和Bitronix的<a href=\"http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-jta.html\">支持</a>。</p>\n<p>如果JTA不是你的选项，那么可以考虑采用事件表的方式。这种方式首先将事件保存到聚合根所在的数据库中，由于事件表和聚合根表同属一个数据库，整个过程只需要一个本地事务就能完成。然后，在一个单独的后台任务中读取事件表中未发布的事件，再将事件发布到消息中间件中。</p>\n<p>这种方式需要注意两个问题，第一个是由于发布了事件之后需要将表中的事件标记成“已发布”状态，即依然涉及到对数据库的操作，因此发布事件和标记“已发布”之间需要原子性。当然，此时依旧可以采用XA事务，但是这违背了采用事件表的初衷。<strong>一种解决方法是将事件的消费方创建成<a href=\"http://www.enterpriseintegrationpatterns.com/patterns/messaging/IdempotentReceiver.html\">幂等</a>的，即消费方可以多次消费同一个事件而不污染系统数据。</strong>这个过程大致为：整个过程中事件发送和数据库更新采用各自的事务管理，此时有可能发生的情况是事件发送成功而数据库更新失败，这样在下一次事件发布操作中，由于先前发布过的事件在数据库中依然是“未发布”状态，该事件将被重新发布到消息系统中，导致事件重复，但由于事件的消费方是幂等的，因此事件重复不会存在问题。</p>\n<p>另外一个需要注意的问题是持久化机制的选择。其实对于DDD中的聚合根来说，NoSQL是相比于关系型数据库更合适的选择，比如用MongoDB的Document保存聚合根便是种很自然的方式。但是多数NoSQL是不支持ACID的，也就是说不能保证聚合更新和事件发布之间的原子性。还好，关系型数据库也在向NoSQL方向发展，比如新版本的PostgreSQL(<a href=\"https://www.postgresql.org/docs/9.4/static/datatype-json.html\">版本9.4</a>)和MySQL（<a href=\"https://dev.mysql.com/doc/refman/5.7/en/json.html\">版本5.7</a>）已经能够提供具备NoSQL特征的JSON存储和基于JSON的查询。此时，我们可以考虑将聚合根序列化成JSON格式的数据进行保存，从而避免了使用重量级的ORM工具，又可以在多个数据之间保证ACID，何乐而不为？</p>\n<h3>总结</h3>\n<p>领域事件主要用于解耦微服务，此时各个微服务之间将形成最终一致性。事件风暴活动有助于我们对微服务进行拆分，并且有助于我们深入了解某个领域。领域事件作为已经发生过的历史数据，在建模时应该将其创建为不可变的特殊值对象。存在多种方式用于发布领域事件，其中“在聚合中临时保存领域事件”的方式是值得推崇的。另外，我们需要考虑到聚合更新和事件发布之间的原子性，可以考虑使用XA事务或者采用单独的事件表。为了避免事件重复带来的问题，最好的方式是将事件的消费方创建为幂等的。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110931\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110931votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110931\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 56</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "01e2085d78dab10aac7637b4de4fdbcb", "title": "程序员的“认知失调”", "url": "http://blog.jobbole.com/110872/", "create_date": "2017/04/15", "front_image_url": ["http://wx4.sinaimg.cn/large/63918611gy1fengce8779j20hg0d40vn.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 0, "tags": "职场,程序员", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.liuguangli.win/archives/337\">liuguangli</a>   </div><p>“不可能啊”、“一定是服务器的原因”、“我的程序不应该有问题啊”，这些年工作听到的最多的就是这些话了，程序员都是比较自信的，总是觉得自己的程序肯定没问题。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/large/63918611gy1fengce8779j20hg0d40vn.jpg\" width=\"482\" height=\"362\"></p>\n<p>程序就是程序员的自我延伸，花了几个小时甚至几天时间构建的结果，最后它以“正确”的形象印入你的意识里，你自然不希望别人找出什么纰漏，即便找出什么纰漏了，自己也意识到了“不足”，感情上很难接受，所以大部分人都会习惯性的“辩护”，甚至试图找一些迂回手段证明自己是对的。实际上很多时候，只要我们稍微回归一下，跳出自我守护的那一亩田地，也许我门就会很轻易的发现：我们的确错了。</p>\n<p>心理学上有一个学术名词叫做“认知失调”，所谓认知失调就是指在一个人的认知系统里即将出现新的认知与就旧认知（旧的信念，自我建立的理论）产生冲突引起的心理上的不适，为了调节这种不适感，一方面为旧的认知辩护，另一方面希望在新的认知和旧的认知上找到共存的平衡。例如，你告诉吸烟者吸烟有害健康，应该要戒烟；吸烟者就会出现认知失调，但是他们很快就会从中解脱出来，因为他们会以“吸烟能减轻压力，令他们轻松”的理由来说服自己。</p>\n<p>认知失调是一种很常见的心理现象。在我们设计到实现我们的程序的过程中，我们在心理上已经慢慢的建立了自己对程序的相信。再到代码审查阶段或测试阶段，总会有人指出其中不完美之处，于是出现了认知失调，所以我们会习惯性的“辩护”。一个开发团队中，要形成良好的氛围，首先要克服认知失调现象，提高程序员的认知是比较重要的。</p>\n<p>我们的前辈们很早就意识到这个问题了，并且有些程序开发组已经克服了这种认知的局限。远在计算机刚刚成为可能之初，我们的前辈冯.诺依曼很早就意识到了，自己在检查自己的工作方面的能力的确不足，他或许是第一位能够认识到这一点的程序员。而在他的朋友中，有人回忆，冯.诺依曼总是和别人说他自己是一名蹩脚的程序员，并且总是不厌其烦的请人帮他读程序，希望能发现一些错误和纰漏。在今天我们看来，冯.诺依曼无疑是一个天才，就是这样一位天才的程序员都能有会不足之处。我们又有什么不能面对自己的错误呢？</p>\n<p>再来转述一个故事。比尔是早期空间跟踪系统的一名成员。他负责写一个模拟器，对整个网络中的空间跟踪站以及实时输入进行模拟。这个模拟器的核心是一个非常紧凑的循环。实际上，它只有13条指令。比尔研究了很多个小时以后，觉得自己终于又些信心了，但是他还是希望找到一些要求比较苛刻的人来帮他检查程序。</p>\n<p>比尔找到了马里琳，她愿意细读她的程序，他也读她的程序，这是他们工作组里再平常不过的事了。这种相互批评的方式能让当事人不会感到自己在接受别人的批评。而比尔认为自己这方面训练有素，没必要通过这种交换来保护自己的自尊心。在他的程序开发价值观里，那种隐秘的、保守的开发方式很不好，只有开放的、分享的开发方式是好的。在他的程序中可能发现错误是人人可见的简单事实，暴露这些错误，不过是为了将来更好的改进，所以并非是对他个人的攻击。</p>\n<p>在这个例子中，比尔经历了他程序开发生涯中最“糟糕”的一天。经历反复的检查，马里琳发现了很多错误，随着错误一个一个的被发现，比尔反而变得越来越开心。要是比尔和我们大多数程序员一样，肯定是开始在为自己辩解了。最后，在他们的一次学术会议上，他向全世界公布了一个惊为天人的事实：13行代码中，马里琳成功发现了17个错误。他认定那天并非他写程序的“良辰吉日”。在那天剩下的时间里，他干脆把程序放到一边，然后向周围的人讲诉这一小插曲中的每一个宁人捧腹的细节。</p>\n<p>同时，马里琳并没有觉的自己发现这么多错误而窃喜，而是清醒的认识到：她发现17个错误，那么是不是还有可能有更多的错误。她经过长时间的修改之后，和比尔一样，同样找来另一位阅读者。那天下班前，一边是比尔继续向周围同事讲述这件快事，另一边是马里琳和其他人一起又发现了3个错误。</p>\n<p>故事的最后，当这段程序加载到计算机后，哪怕是经历任何“魔鬼似的”测试也没有发现任何错误。实际上，这个模拟器已经被至少十个以上的计算机中心使用，至少九年之内没有发现其他错误。对于每个发现的错误，比尔并不认为是对自己自尊的伤害，事实上，这种自尊恰恰体现了一个人的愚蠢；否则试想一下这个故事的结局会是怎样？</p>\n<p>两个故事说明认知的重要，最后总结几条观点：</p>\n<p>1 每个程序员的会出现认知失调的现象。应该正常对待。</p>\n<p>2 再牛逼的人都会有自己的认知盲区，需要别人去发现。</p>\n<p>3 理性对待别人发现的错误。</p>\n<div></div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110872\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110872votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110872\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "6c42de58dcfcc736a46a425e16373e5f", "title": "Bloom Filter 概念和原理", "url": "http://blog.jobbole.com/110886/", "create_date": "2017/04/15", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/df304fea61c3b5d6695f6fe1aa80b6a6.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 3, "tags": "IT技术,Bloom Filter,数据结构", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/jiaomeng/article/details/1495500\">焦萌</a>   </div><p>Bloom Filter是一种空间效率很高的随机数据结构，它利用位数组很简洁地表示一个集合，并能判断一个元素是否属于这个集合。<span lang=\"EN-US\">Bloom Filter</span>的这种高效是有一定代价的：在判断一个元素是否属于某个集合时，有可能会把不属于这个集合的元素误认为属于这个集合（<span lang=\"EN-US\">false positive</span>）。因此，<span lang=\"EN-US\">Bloom Filter</span>不适合那些“零错误”的应用场合。而在能容忍低错误率的应用场合下，<span lang=\"EN-US\">Bloom Filter</span>通过极少的错误换取了存储空间的极大节省。</p>\n<h3>集合表示和元素查询</h3>\n<p>下面我们具体来看<span lang=\"EN-US\">Bloom Filter</span>是如何用位数组表示集合的。初始状态时，<span lang=\"EN-US\">Bloom Filter</span>是一个包含<span lang=\"EN-US\">m</span>位的位数组，每一位都置为<span lang=\"EN-US\">0</span>。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/df304fea61c3b5d6695f6fe1aa80b6a6.jpg\" alt=\"\"></p>\n<p>为了表达<span lang=\"EN-US\">S={x<sub>1</sub>, x<sub>2</sub>,…,x<sub>n</sub>}</span>这样一个<span lang=\"EN-US\">n</span>个元素的集合，<span lang=\"EN-US\">Bloom Filter</span>使用<span lang=\"EN-US\">k</span>个相互独立的哈希函数（<span lang=\"EN-US\">Hash Function</span>），它们分别将集合中的每个元素映射到<span lang=\"EN-US\">{1,…,m}</span>的范围中。对任意一个元素<span lang=\"EN-US\">x</span>，第<span lang=\"EN-US\">i</span>个哈希函数映射的位置<span lang=\"EN-US\">h<sub>i</sub>(x)</span>就会被置为<span lang=\"EN-US\">1</span>（<span lang=\"EN-US\">1</span>≤<span lang=\"EN-US\">i</span>≤<span lang=\"EN-US\">k</span>）。注意，如果一个位置多次被置为<span lang=\"EN-US\">1</span>，那么只有第一次会起作用，后面几次将没有任何效果。在下图中，<span lang=\"EN-US\">k=3</span>，且有两个哈希函数选中同一个位置（从左边数第五位）。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/576cdf8d1bb842dd2f191fa8cfd5c84b.jpg\" alt=\"\"></p>\n<p>在判断<span lang=\"EN-US\">y</span>是否属于这个集合时，我们对<span lang=\"EN-US\">y</span>应用<span lang=\"EN-US\">k</span>次哈希函数，如果所有<span lang=\"EN-US\">h<sub>i</sub>(y)</span>的位置都是<span lang=\"EN-US\">1</span>（<span lang=\"EN-US\">1</span>≤<span lang=\"EN-US\">i</span>≤<span lang=\"EN-US\">k</span>），那么我们就认为<span lang=\"EN-US\">y</span>是集合中的元素，否则就认为<span lang=\"EN-US\">y</span>不是集合中的元素。下图中<span lang=\"EN-US\">y<sub>1</sub></span>就不是集合中的元素。<span lang=\"EN-US\">y<sub>2</sub></span>或者属于这个集合，或者刚好是一个<span lang=\"EN-US\">false positive</span>。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/b36dd280b578f7e40277193bd69652ea.jpg\" alt=\"\"></p>\n<h3>错误率估计</h3>\n<p>前面我们已经提到了，<span lang=\"EN-US\">Bloom Filter</span>在判断一个元素是否属于它表示的集合时会有一定的错误率（<span lang=\"EN-US\">false positive rate</span>），下面我们就来估计错误率的大小。在估计之前为了简化模型，我们假设<span lang=\"EN-US\">kn&lt;m</span>且各个哈希函数是完全随机的。当集合<span lang=\"EN-US\">S={x<sub>1</sub>, x<sub>2</sub>,…,x<sub>n</sub>}</span>的所有元素都被<span lang=\"EN-US\">k</span>个哈希函数映射到<span lang=\"EN-US\">m</span>位的位数组中时，这个位数组中某一位还是<span lang=\"EN-US\">0</span>的概率是：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/ba63811a1d14eb242e05616cd89e8630.jpg\" alt=\"\"></p>\n<p>其中<span lang=\"EN-US\">1/m</span>表示任意一个哈希函数选中这一位的概率（前提是哈希函数是完全随机的），<span lang=\"EN-US\">(1-1/m)</span>表示哈希一次没有选中这一位的概率。要把<span lang=\"EN-US\">S</span>完全映射到位数组中，需要做<span lang=\"EN-US\">kn</span>次哈希。某一位还是<span lang=\"EN-US\">0</span>意味着<span lang=\"EN-US\">kn</span>次哈希都没有选中它，因此这个概率就是（<span lang=\"EN-US\">1-1/m</span>）的<span lang=\"EN-US\">kn</span>次方。令<span lang=\"EN-US\">p = e<sup>-kn/m</sup></span>是为了简化运算，这里用到了计算e时常用的近似：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/acca68cdeb553266d63f262a98f71cab.jpg\" alt=\"\"></p>\n<p>令ρ为位数组中<span lang=\"EN-US\">0</span>的比例，则ρ的数学期望<span lang=\"EN-US\">E(</span>ρ<span lang=\"EN-US\">)=</span><span lang=\"EN-US\"> p’</span>。在ρ已知的情况下，要求的错误率（<span lang=\"EN-US\">false positive rate</span>）为：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/2ba76c90df167feb84a69e0c37a3b021.jpg\" alt=\"\"></p>\n<p><span lang=\"EN-US\">(1-</span>ρ<span lang=\"EN-US\">)</span>为位数组中<span lang=\"EN-US\">1</span>的比例，<span lang=\"EN-US\">(1-</span>ρ<span lang=\"EN-US\">)<sup>k</sup></span>就表示<span lang=\"EN-US\">k</span>次哈希都刚好选中<span lang=\"EN-US\">1</span>的区域，即<span lang=\"EN-US\">false positive rate</span>。上式中第二步近似在前面已经提到了，现在来看第一步近似。<span lang=\"EN-US\">p’</span>只是ρ的数学期望，在实际中ρ的值有可能偏离它的数学期望值。<span lang=\"EN-US\">M. Mitzenmacher</span>已经证明<sup><span lang=\"EN-US\">[2]</span></sup> ，位数组中<span lang=\"EN-US\">0</span>的比例非常集中地分布在它的数学期望值的附近。因此，第一步的近似得以成立。分别将<span lang=\"EN-US\">p</span>和<span lang=\"EN-US\">p’</span>代入上式中，得：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/a85786344c9896b09b8f55de41219475.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/743a463026971d59acf340d43d30662a.jpg\" alt=\"\"></p>\n<p>相比<span lang=\"EN-US\">p’</span>和<span lang=\"EN-US\">f’</span>，使用<span lang=\"EN-US\">p</span>和<span lang=\"EN-US\">f</span>通常在分析中更为方便。</p>\n<h3>最优的哈希函数个数</h3>\n<p>既然<span lang=\"EN-US\">Bloom Filter</span>要靠多个哈希函数将集合映射到位数组中，那么应该选择几个哈希函数才能使元素查询时的错误率降到最低呢？这里有两个互斥的理由：如果哈希函数的个数多，那么在对一个不属于集合的元素进行查询时得到<span lang=\"EN-US\">0</span>的概率就大；但另一方面，如果哈希函数的个数少，那么位数组中的<span lang=\"EN-US\">0</span>就多。为了得到最优的哈希函数个数，我们需要根据上一小节中的错误率公式进行计算。</p>\n<p>先用<span lang=\"EN-US\">p</span>和<span lang=\"EN-US\">f</span>进行计算。注意到<span lang=\"EN-US\">f = exp(k ln(1 − e<sup>−kn/m</sup>))</span>，我们令<span lang=\"EN-US\">g = k ln(1 − e<sup>−kn/m</sup>)</span>，只要让<span lang=\"EN-US\">g</span>取到最小，<span lang=\"EN-US\">f</span>自然也取到最小。由于<span lang=\"EN-US\">p = e<sup>-kn/m</sup></span>，我们可以将<span lang=\"EN-US\">g</span>写成</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/b4c327955a1209c450e32eca4cc31d2a.jpg\" alt=\"\"></p>\n<p>根据对称性法则可以很容易看出当<span lang=\"EN-US\">p = 1/2</span>，也就是<span lang=\"EN-US\">k = ln2· (m/n)</span>时，<span lang=\"EN-US\">g</span>取得最小值。在这种情况下，最小错误率<span lang=\"EN-US\">f</span>等于<span lang=\"EN-US\">(1/2)<sup>k </sup></span>≈ <span lang=\"EN-US\">(0.6185)<sup>m/n</sup></span>。另外，注意到p是位数组中某一位仍是0的概率，所以<span lang=\"EN-US\">p = 1/2</span>对应着位数组中0和1各一半。换句话说，要想保持错误率低，最好让位数组有一半还空着。</p>\n<p>需要强调的一点是，<span lang=\"EN-US\">p = 1/2</span>时错误率最小这个结果并不依赖于近似值<span lang=\"EN-US\">p</span>和<span lang=\"EN-US\">f</span>。同样对于<span lang=\"EN-US\">f’ = exp(k ln(1 − (1 − 1/m)<sup>kn</sup>))</span>，<span lang=\"EN-US\">g’ = k ln(1 − (1 − 1/m)<sup>kn</sup>)</span>，<span lang=\"EN-US\">p’ = (1 − 1/m)<sup>kn</sup></span>，我们可以将<span lang=\"EN-US\">g’</span>写成</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/ba98db7948f86151acec88b4fa1892fc.jpg\" alt=\"\"></p>\n<p>同样根据对称性法则可以得到当<span lang=\"EN-US\">p’ = 1/2</span>时，<span lang=\"EN-US\">g’</span>取得最小值。</p>\n<h3>位数组的大小</h3>\n<p>下面我们来看看，在不超过一定错误率的情况下，<span lang=\"EN-US\">Bloom Filter</span>至少需要多少位才能表示全集中任意<span lang=\"EN-US\">n</span>个元素的集合。假设全集中共有<span lang=\"EN-US\">u</span>个元素，允许的最大错误率为<span lang=\"EN-US\">є</span>，下面我们来求位数组的位数<span lang=\"EN-US\">m</span>。</p>\n<p>假设<span lang=\"EN-US\">X</span>为全集中任取<span lang=\"EN-US\">n</span>个元素的集合，<span lang=\"EN-US\">F(X)</span>是表示<span lang=\"EN-US\">X</span>的位数组。那么对于集合<span lang=\"EN-US\">X</span>中任意一个元素<span lang=\"EN-US\">x</span>，在<span lang=\"EN-US\">s = F(X)</span>中查询<span lang=\"EN-US\">x</span>都能得到肯定的结果，即<span lang=\"EN-US\">s</span>能够接受<span lang=\"EN-US\">x</span>。显然，由于<span lang=\"EN-US\">Bloom Filter</span>引入了错误，<span lang=\"EN-US\">s</span>能够接受的不仅仅是<span lang=\"EN-US\">X</span>中的元素，它还能够<span lang=\"EN-US\">є (u – n)</span>个<span lang=\"EN-US\">false positive</span>。因此，对于一个确定的位数组来说，它能够接受总共<span lang=\"EN-US\">n + є (u – n)</span>个元素。在<span lang=\"EN-US\">n + є (u – n)</span>个元素中，<span lang=\"EN-US\">s</span>真正表示的只有其中<span lang=\"EN-US\">n</span>个，所以一个确定的位数组可以表示</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/cacb219871c420e8f69ccfe06585a2a9.jpg\" alt=\"\"></p>\n<p>个集合。<span lang=\"EN-US\">m</span>位的位数组共有<span lang=\"EN-US\">2<sup>m</sup></span>个不同的组合，进而可以推出，<span lang=\"EN-US\">m</span>位的位数组可以表示</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/39105af245e3ed44f0524bd61a6560fb.jpg\" alt=\"\"></p>\n<p>个集合。全集中<span lang=\"EN-US\">n</span>个元素的集合总共有</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/f311421a3ec9ccdd14be1b44874f89b4.jpg\" alt=\"\"></p>\n<p>个，因此要让<span lang=\"EN-US\">m</span>位的位数组能够表示所有<span lang=\"EN-US\">n</span>个元素的集合，必须有</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/4c8fb0df127848cc2d1d84830749e1bc.jpg\" alt=\"\"></p>\n<p>即：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/5b0c407daafccf149f27f48e0abc7084.jpg\" alt=\"\"></p>\n<p>上式中的近似前提是<span lang=\"EN-US\">n</span>和<span lang=\"EN-US\">єu</span>相比很小，这也是实际情况中常常发生的。根据上式，我们得出结论：在错误率不大于<span lang=\"EN-US\">є</span>的情况下，<span lang=\"EN-US\">m</span>至少要等于<span lang=\"EN-US\">n log<sub>2</sub>(1/є)</span>才能表示任意<span lang=\"EN-US\">n</span>个元素的集合。</p>\n<p>上一小节中我们曾算出当<span lang=\"EN-US\">k = ln2· (m/n)</span>时错误率<span lang=\"EN-US\">f</span>最小，这时<span lang=\"EN-US\">f = (1/2)<sup>k </sup>= (1/2)<sup>mln2 / n</sup></span>。现在令<span lang=\"EN-US\">f</span>≤<span lang=\"EN-US\">є</span>，可以推出</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/3b4e99092bd063d5492f91adf8aac6a9.jpg\" alt=\"\"></p>\n<p>这个结果比前面我们算得的下界<span lang=\"EN-US\">n log<sub>2</sub>(1/є)</span>大了<span lang=\"EN-US\">log<sub>2 </sub>e </span>≈ <span lang=\"EN-US\">1.44</span>倍。这说明在哈希函数的个数取到最优时，要让错误率不超过<span lang=\"EN-US\">є</span>，<span lang=\"EN-US\">m</span>至少需要取到最小值的<span lang=\"EN-US\">1.44</span>倍。</p>\n<h3>总结</h3>\n<p>在计算机科学中，我们常常会碰到时间换空间或者空间换时间的情况，即为了达到某一个方面的最优而牺牲另一个方面。<span lang=\"EN-US\">Bloom Filter</span>在时间空间这两个因素之外又引入了另一个因素：错误率。在使用<span lang=\"EN-US\">Bloom Filter</span>判断一个元素是否属于某个集合时，会有一定的错误率。也就是说，有可能把不属于这个集合的元素误认为属于这个集合（<span lang=\"EN-US\">False Positive</span>），但不会把属于这个集合的元素误认为不属于这个集合（<span lang=\"EN-US\">False Negative</span>）。在增加了错误率这个因素之后，<span lang=\"EN-US\">Bloom Filter</span>通过允许少量的错误来节省大量的存储空间。</p>\n<p>自从<span lang=\"EN-US\">Burton Bloom</span>在<span lang=\"EN-US\">70</span>年代提出<span lang=\"EN-US\">Bloom Filter</span>之后，<span lang=\"EN-US\">Bloom Filter</span>就被广泛用于拼写检查和数据库系统中。近一二十年，伴随着网络的普及和发展，<span lang=\"EN-US\">Bloom Filter</span>在网络领域获得了新生，各种<span lang=\"EN-US\">Bloom Filter</span>变种和新的应用不断出现。可以预见，随着网络应用的不断深入，新的变种和应用将会继续出现，<span lang=\"EN-US\">Bloom Filter</span>必将获得更大的发展。</p>\n<h3>参考资料</h3>\n<p><span lang=\"EN-US\">[1] A. Broder and M. Mitzenmacher. <a href=\"http://www.eecs.harvard.edu/~michaelm/postscripts/im2005b.pdf\">Network applications of bloom filters: A survey</a>. Internet Mathematics, 1(4):485–509, 2005.</span></p>\n<p><span lang=\"EN-US\">[2] M. Mitzenmacher. <a href=\"http://www.eecs.harvard.edu/~michaelm/postscripts/ton2002.pdf\">Compressed Bloom Filters</a>. IEEE/ACM Transactions on Networking 10:5 (2002), 604—612.</span></p>\n<p><span lang=\"EN-US\">[3] <a href=\"http://www.cs.jhu.edu/~fabian/courses/CS600.624/slides/bloomslides.pdf\">www.cs.jhu.edu/~fabian/courses/CS600.624/slides/bloomslides.pdf</a></span></p>\n<p><span lang=\"EN-US\">[4] <a href=\"http://166.111.248.20/seminar/2006_11_23/hash_2_yaxuan.ppt\">http://166.111.248.20/seminar/2006_11_23/hash_2_yaxuan.ppt</a></span></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110886\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110886votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110886\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "403f504de0849f9cb3195946ab3c7d9a", "title": "马拉松式学习与技术人员的成长性", "url": "http://blog.jobbole.com/110853/", "create_date": "2017/04/15", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/cd529ebd5eb174b2847e9128628472ab.jpg"], "praise_nums": 3, "comment_nums": 2, "fav_nums": 2, "tags": "职场,学习", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://zhangtielei.com/posts/blog-marathon-learning-growth.html\">张铁蕾</a>   </div><p>你的朋友圈里总有一些人具有某种特殊的技能点。比如我的一位铁哥们波仔，就是这样的人。</p>\n<p>波仔，江湖人送外号波哥，是我认识的程序员里面最能跑的。国内的马拉松赛事，他几乎一次不落地参加。只要哪个城市举办马拉松比赛，不管多远，他都一路飞奔过去。这不，前两天刚冒雨跑完了无锡的马拉松。虽然淋得跟落汤鸡似的，但感觉就一个字——爽！</p>\n<p>波仔年轻的时候曾是专业运动员，有着令无数少女尖叫的健康体魄。后来做了程序员，虽然跑步从此成了业余爱好，但仍然威风不减当年，很随意地就跑能个半马，紧接着再跑个全马，都是小菜一碟。我们搞程序的，谁没经历过没日没夜加班的日子。常言道，身体是革命的本钱。这说起来，好的身体也是程序员的核心竞争力之一呢。</p>\n<p>意大利「文艺复兴之父」彼特拉克曾经说过：「肉体和心智的能力必须大到足以满足文学活动和妻子两方面的需要。」如果换做程序员的角度，这句话应该修正一下：肉体和心智的能力必须大到足以满足熬夜写代码和女朋友两方面的需要。当然啦，这个说法也还远没有表达出生活真实的复杂性和严峻性。</p>\n<p>所以，跑步是锻炼身体很好的手段。但是马拉松，除了锻炼身体，同时也是对人性的考验。一件接近身心极限的事情，你的身体能否承受，你的精神能否坚持下来。</p>\n<p>波仔多次邀请我一起去跑个马拉松，都被我毫不犹豫地拒绝了。这身体条件，咱不能强求。没有准备的极限运动还是比较危险的。但是，对于有能力跑下来的朋友，我在精神上表示羡慕和支持。</p>\n<p>有时候我会把学习比作跑步。对于类似程序员这样的职业，新技术更新换代的速度确实比较快，这需要你总是保持在学习的状态。</p>\n<p>应该说，在一般情况下，程序员们对新知识进行学习的能力都还是比较强的。工作中碰到以前没做过的东西，只要能在网上找到对应的开发文档，仔细读一读，再看几个 Demo，就基本能解决问题了。这种规模的学习过程，一般几天就搞定了，可以看做是一次「短跑」。</p>\n<p>当然，这种「短跑式」的学习过程，也只对于「一般性」的情况有效。而对于一些「专业性」的领域，我们就需要「马拉松式」的学习姿态了，做好充分的准备，并且长时间投入，半年，一年，甚至更长。</p>\n<p>实际上，编程这门工作，门槛说低也不低，说高也不高。很多学历不高或者非科班毕业的同学，也都能把这份工作从事得很出色。但是按技术领域来区分的话，编程还是可以分为「一般性」和「专业性」两大类的。对于「一般性」的技术领域，你只要具备一点计算机基础，懂得一门编程语言，能理解业务逻辑，就能胜任了。但是「专业性」的技术领域就不一样了，除了计算机基础知识之外，你更需要掌握一整套知识体系，可能对数学知识还有特殊的要求。这样的领域有哪些呢？比如说，分布式系统，数据库理论，音视频处理，3D游戏引擎，操作系统和虚拟化技术，大数据处理，还有最近火爆的人工智能技术，等等。</p>\n<p>对于「专业性」的这些知识，如果你打算涉足其中，就得需要拿出跑马拉松的精神了。据说马拉松跑到一半，很多人就会产生强烈的「想放弃」的想法，后半段就靠毅力支撑了。「马拉松式」的学习过程也是一样。可能一门「专业性」领域的知识，最开始吸引你的是兴趣，它非常有意思，可能听起来还很酷，但随着研究的深入，你就不可避免地遭遇很多沮丧时刻。你会发现，你学得越多，未知就越多。这时候你肯定会产生放弃的想法，甚至对自己是否适合做技术产生一丝怀疑，但是没有关系，每一个在某一领域走得足够远的人都会碰到这样的情况。只要你咬牙坚持下去，随后你得到的奖赏必然是恍然大悟或醍醐灌顶的感受。我相信 ，这与一场马拉松终于跑到终点的胜利喜悦是一样的。</p>\n<p>有长跑经验的人都知道，真正能在马拉松上取得好成绩的人，基本上都是匀速跑者。开始跑得多快并不关键，关键在于「后劲」足不足。我们的职业生涯也是一样，不管是程序员还是其他职业，这个道理都适用。</p>\n<p>我时常在想，不同技术人员之间的区别到底在哪。是在于工作经验，还是在于他们的聪明程度，或者是在于他们是否有名校的教育背景？为什么本来基础差不多的人，多年之后会产生巨大的差异？与此相关的一个很实际的问题是，我们在招聘新员工时，到底应该看重他们的哪些特点？我最后想到的答案是，决定不同技术人员之间的真正分野，在于「成长性」，也就是持续学习和提高自身的能力。换句话说，「后劲」足不足。一个人的成长过程，什么都可能随时变化，但成长性本身不应该有丝毫减弱。</p>\n<p>设想一个稍微极端一点的情况，假设你要自己创业，现在要物色合伙人的角色。你会怎么选？你必须考虑他们的成长性。你放眼四周，也许你周围的很多朋友都能帮你解决当前的问题。但你物色的人选，他们能否随着公司一起成长？他们身上有没有自我超越的基因？都说找合伙人比找对象还难，的确如此。跟不上公司发展节奏的合伙人，注定将是一场灾难。</p>\n<p>而创业公司的 CEO，作为掌舵人，他自身的成长性其实要求更高，因为这决定了公司和团队的未来，责任极其重大。Facebook 的 CEO 马克·扎克伯格，每周都坚持读一本新书，就是为了保持自己的成长性。有些自私的老板，他们忽略了这份责任，可能认为「我给你发工资你给我干活」是理所当然的事情。但是，确保团队成长的责任，和公司发展的责任，同样重要。</p>\n<p>实际上，凡是带团队的人，都有这份责任。如果你自己混日子，不能一步步成长，那你的团队成员又怎能获得突破自己的机会呢？职位越高，责任越大。当你的 leader 或某个机遇把你推到那个位置的时候，你为进一步的成长做好准备了吗？估计很多人是想不到这一点的。还听说有些极端的团队 leader，甚至整日担心下属会超过自己，不但不给团队成员创造成长的机会，还打压下属。真是不理解这些人是怎么想的。所以，跟对人很重要。</p>\n<p>投资人是否会投资一家公司，看重的是公司的成长性；我们买股票也是一样，都会选择成长性好的股票。甚至女孩子找老公，也希望找个「潜力股」。所有这些选择，都是在追求「成长性」带来的升值。</p>\n<p>只要想明白这一点，我们就不再会为一些不必要的担忧而烦恼。比如，很多人担心年龄大了就再也做不好技术，或者担心年龄大了之后的职业发展问题。显然，年龄并不是决定成长性的关键因素，这顶多是一个心理因素。成长性更应该是一个人的本质特征，是他所具备的基因。人与人的不同究竟在哪里？具体技能总是会变化的，但基因是不变的，也不应该随着年龄的变化而变化。</p>\n<p>人的可贵之处就在于学习和塑造能力，这是造物主赋予我们的可贵品质。</p>\n<p>甚至现在的人工智能模型也要以学习的方式来训练，才能产生它需要的职能。一个复杂的模型，需要大规模的训练，喂给它很多数据和模式，才能让它获得新的知识，不断提高「智能」。</p>\n<p>我们可以想象，人脑其实也是一个智能模型，只不过这个模型更庞大，参数更多，容量更大；训练它需要的数据更多，时间也更长。如果你想成为某方面的专家，就需要花费很多年的精力来进行专业训练。</p>\n<p>一个人，要想在某方面获得睿智，唯一的办法就是持续地学习、调整、提高、成长。这个过程需要耐力和坚持，而最终你会收获成功和乐趣。</p>\n<p>一句话，保持学习，保持「后劲」，保持成长。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110853\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110853votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110853\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "9d6b13b944fe9e2473dbe198c0568e22", "title": "Linux DNS 服务器安装、配置和维护", "url": "http://blog.jobbole.com/110903/", "create_date": "2017/04/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/8fb10f47603b46da8bdf9d933cbdc291.png"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,DNS,Linux,服务器", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/linux-dns-server-installation-amp-configuration-am\">dzone</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/linux-dns-server-installation-amp-configuration-am?print\">开源中国</a>   </div><p>每个 IP 地址都可以有一个主机名，主机名由一个或多个字符串组成，字符串之间用小数点隔开。有了主机名，就不要死记硬背每台 IP 设备的 IP 地址，只要记住相对直观有意义的主机名就行了。这就是 DNS 协议所要完成的功能。</p>\n<p>今天我们将讨论DNS服务器，特别是Linux DNS服务器，及其如何安装、配置和维护它。</p>\n<h2>/etc/hosts文件</h2>\n<p>在没有DNS服务器的情况下，每个系统在本地网络上保留其主机名和相应IP地址列表的副本是合理的——特别是在没有互联网连接的小型站点上。</p>\n<p>在Linux系统中，这个列表就是/etc/hosts文件。 即使你没有DNS服务器或DNS服务器不可用，该文件也可以使用/etc/hosts文件将IP地址转换为名称。</p>\n<p>也许你已经有DNS服务器了，但你也会因为其它原因而想保留这个文件。例如，系统可能需要在向外部查询之前在本地查找DNS服务器的IP地址；这意味着系统在查询DNS服务器之前先检索该文件，如果查找到对应的域则无须查询任何DNS服务器直接将其转换为IP地址。</p>\n<p>试试编辑下/etc/hosts文件，并添加以下信息：<em>127.0.0.1 google.com</em>.</p>\n<p>然后，返回你的浏览器，输入<em>google.com</em>，看看结果如何。如果你的系统上安装了Apache并且本地主机正在运行，浏览器会显示localhost的索引页，而不是Google页面。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/8fb10f47603b46da8bdf9d933cbdc291.png\"></p>\n<p>作为确认，你可以将google.com映射到任何网站的任何其他IP地址并查看结果。</p>\n<p>因此这个文件所做的是将IP地址转换成名字，但这仅仅是在同一互相连接的网络下。 那么外部网络和众多系统的所有记录是如何维护的呢？</p>\n<p>每个人都需要维护自己的/etc/hosts文件并自己更新吗？</p>\n<p>更为稳健的域名服务是DNS服务器。</p>\n<h2>域名</h2>\n<p>当你访问网站时，你可以输入FQDN（Fully Qualified Domain Name，完全限定域名）或类似likegeeks.com或www.google.com的域名。在域名中从右到左的两个点之间的每个文本依次是顶级域组件、二级域组件和三级域组件。</p>\n<p>所以，com是顶级域名组件; google是二级域组件; 而www是三级域名组件。</p>\n<p>实际上，当你访问任何网站时，浏览器会默认在域的末尾添加一个不可见的点，因此该域将像www.google.com.一样。 该点被称为根域。</p>\n<p>该点是由一大堆称为根域名服务器的特殊服务器管理的。截止这篇文章发表前，世界上有13个根域名服务器。 你可以把他们当成互联网的大脑 – 如果他们失效了，世界上就没有互联网了。</p>\n<p>为什么是13呢？ 因为如果世界的某处地震可能会破坏一个根服务器，所以其他的服务器可以继续提供服务直到受影响的服务器重新上线。</p>\n<p>这些根名称服务器按字母顺序命名，名称如a.root-server.net、b.root-server.net等。</p>\n<h2>顶级域名 (或称作一级域名 TLDs)</h2>\n<p>我们已经见过顶级域名的组成部分，如 com。可以认为，顶级域名为 DNS 命名空间提供分类组织。</p>\n<p>顶级域名（TLD）根据地理或功能方面分为几类。</p>\n<p>截止本文撰写时，网上有 800 多个顶级域名。</p>\n<p>顶级域名类别有：</p>\n<ul>\n<li>通用的顶级域名如：<em>org</em>, <em>.com</em>, <em>.net</em>, <em>.gov</em>, <em>.edu 等等</em></li>\n<li>国家代码顶级域名如<em>：.us</em>,<em> .ca</em> <em>等，</em>分别对应美国和加拿大的国家代码</li>\n<li>新的品牌顶级域名，允许组织创建最多 64 个字符的TLD，如：<em>.linux</em>, <em>.microsoft</em>, <em>.companyname 等</em></li>\n<li>基础架构顶级域名如： <em>.arpa</em></li>\n</ul>\n<h2>子域名</h2>\n<p>当你访问一个类似 <em>mail.google.com </em>这样的网站, 这里的<em>mail</em> 就是 <em>google.com</em>的子域名.</p>\n<p>只有<em>mail.google.com</em> 的名称服务器知道他下面存在的所有主机，所以Google会回复是否有一个叫<em>mail</em> 的子域名。根名称服务器对此并不知情。</p>\n<h2>DNS服务器的类型</h2>\n<p>一共有三种DNS服务器。</p>\n<h3>主DNS服务器</h3>\n<p>这些服务器上存放了特定域名的配置文件，并且基于此权威地规定了特定域名的地址。主DNS服务器知道全部在它管辖范围的主机和子域名的地址。</p>\n<h3>辅助DNS服务器</h3>\n<p>这些服务器作为主DNS服务器的备份，也承担一定负载。主服务器知道辅助DNS服务器的存在，并且会向他们推送更新。</p>\n<h3>缓存DNS服务器</h3>\n<p>这些服务器上不存放特定域名的配置文件。当客户端请求缓存服务器来解析域名时，该服务器将首先检查其本地缓存。如果找不到匹配项便会询问主服务器。接着这条响应将被缓存起来。您也可以轻松地将自己的系统用作缓存服务器。</p>\n<h2>搭建 Linux DNS 服务器</h2>\n<p>Linux 下有很多实现了 DNS 功能的包，不过我们只关注 BIND DNS 服务器。它用于世界上大多数 DNS 服务器。</p>\n<p>如果你在使用基于 Red Hat 发行版的 Linux，比如 CentOS，可以像这样安装：<code>$ dnf -y install bind</code></p>\n<p>如果你使用基于 Debian 的操作系统，比如 Ubuntu：<code>$ apt-get install bind9</code></p>\n<p>安装完成之后就可以启动它并让它在计算机启动的时候一并启动起来。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639c8199776010\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl start named\r\n$ systemctl enable named</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639c8199776010-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639c8199776010-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639c8199776010-1\"><span class=\"crayon-sy\">$</span> <span class=\"crayon-i\">systemctl</span> <span class=\"crayon-i\">start</span> <span class=\"crayon-i\">named</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639c8199776010-2\"><span class=\"crayon-sy\">$</span> <span class=\"crayon-i\">systemctl</span> <span class=\"crayon-i\">enable</span> <span class=\"crayon-v\">named</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h2>配置 BIND</h2>\n<p>这个服务使用 <code>/etc/named.conf</code> 作为配置文件。</p>\n<p>BIND 在那个文件中使用像下面这样的一些语句：</p>\n<ul>\n<li><strong>options</strong>: 用于全局 BIND 配置。</li>\n<li><strong>logging</strong>: 配置哪些需要记录，哪些需要忽略。我推荐你看看 <a href=\"https://likegeeks.com/linux-syslog-server-log-management/\" target=\"_blank\" rel=\"nofollow\">Linux syslog server</a>。</li>\n<li><strong>zone</strong>: 定义 DNS 区域。</li>\n<li><strong>include</strong>: 在 <code>named.conf</code> 中包含另一个文件。</li>\n</ul>\n<p>在 options 语句中可以看到 BIND 的工作目录在 <code>/var/named</code>。</p>\n<p>zone 语句可用于定义 DNS 区域，比如域名 <em>google.com</em>，它包含子域名 <em>mail.google.com</em> 和 <em>analytics.google.com</em>。</p>\n<p>上述三个域名(主域名和子域名) 都有一个由 zone 语句定义的区域。</p>\n<h2>定义一个主域服务器</h2>\n<p>我们知道 DNS 服务器类型有主域名服务器、辅助域名服务器和缓存域名服务器。不同于缓存域名服务器，主域名服务器和辅助域名服务器在应答过程中是处于同等地位的。</p>\n<p>在 <code>/etc/named.conf</code> 的配置文件中，你可以使用如下语法定义一个主域服务器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639d6851806491\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzone    \"likegeeks.com\" {\r\ntype master;\r\nfile likegeeks.com.db\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639d6851806491-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639d6851806491-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639d6851806491-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639d6851806491-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639d6851806491-1\"><span class=\"crayon-i\">zone</span>    <span class=\"crayon-s\">\"likegeeks.com\"</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639d6851806491-2\"><span class=\"crayon-i\">type</span> <span class=\"crayon-v\">master</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639d6851806491-3\"><span class=\"crayon-i\">file</span> <span class=\"crayon-v\">likegeeks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">db</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639d6851806491-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>包含主要区域信息的文件存放在 <code>/var/named</code> 目录下，从 options 可知，这是一个工作目录。</p>\n<p>注意：软件服务器或者托管面板会根据你的域名自动为你创建主域服务器信息的文件名，因此如果你的域名是 <em>example.org</em>，那么你主域服务器信息的文件就为 <code>/var/named/example.org.db</code>。</p>\n<p>类型为 <code>master</code>，也就是说这是一个主域服务器。</p>\n<h1>定义一个辅助域服务器</h1>\n<p>同定义一个主域服务器一样，辅助域服务器的定义稍微有些变化：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639da175339716\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzone    \"likegeeks.com\" {\r\ntype slave;\r\nmasters IP Address list; ;\r\nfile likegeeks.com.db\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639da175339716-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639da175339716-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639da175339716-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639da175339716-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639da175339716-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639da175339716-1\"><span class=\"crayon-i\">zone</span>    <span class=\"crayon-s\">\"likegeeks.com\"</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639da175339716-2\"><span class=\"crayon-i\">type</span> <span class=\"crayon-v\">slave</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639da175339716-3\"><span class=\"crayon-i\">masters</span> <span class=\"crayon-i\">IP</span> <span class=\"crayon-i\">Address</span> <span class=\"crayon-v\">list</span><span class=\"crayon-sy\">;</span> <span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639da175339716-4\"><span class=\"crayon-i\">file</span> <span class=\"crayon-v\">likegeeks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">db</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639da175339716-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>对于辅助域服务器来说，它的域名和主域服务器是一样的。上述语法里的的slave类型表示这是一个辅助域服务器，“masters IP Address list”表示辅助域服务器中区域文件内的信息都是通过主域服务器中区域文件内的信息复制过来的。</p>\n<h1>定义一个缓存服务器</h1>\n<p>即使你已经配置了主域或者辅助域服务器，你仍有必要（不是必须）定义一个缓存服务器，因为这样你可以减少DNS服务器的查询次数。</p>\n<p>在定义缓存服务器之前，你需要先定义三个区域选择器，第一个：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639de017526797\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzone      \".\" IN {\r\ntype hint;\r\nfile \"root.hint\";\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639de017526797-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639de017526797-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639de017526797-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639de017526797-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639de017526797-1\"><span class=\"crayon-i\">zone</span>      <span class=\"crayon-s\">\".\"</span> <span class=\"crayon-st\">IN</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639de017526797-2\"><span class=\"crayon-i\">type</span> <span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639de017526797-3\"><span class=\"crayon-i\">file</span> <span class=\"crayon-s\">\"root.hint\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639de017526797-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639e4493750071\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzone      \".\" IN {\r\ntype hint;\r\nfile \"root.hint\";\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639e4493750071-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639e4493750071-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639e4493750071-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639e4493750071-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639e4493750071-1\"><span class=\"crayon-i\">zone</span>      <span class=\"crayon-s\">\".\"</span> <span class=\"crayon-st\">IN</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639e4493750071-2\"><span class=\"crayon-i\">type</span> <span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639e4493750071-3\"><span class=\"crayon-i\">file</span> <span class=\"crayon-s\">\"root.hint\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639e4493750071-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639e7529616376\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzone      \".\" IN {\r\ntype hint;\r\nfile \"root.hint\";\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639e7529616376-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639e7529616376-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639e7529616376-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639e7529616376-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639e7529616376-1\"><span class=\"crayon-i\">zone</span>      <span class=\"crayon-s\">\".\"</span> <span class=\"crayon-st\">IN</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639e7529616376-2\"><span class=\"crayon-i\">type</span> <span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639e7529616376-3\"><span class=\"crayon-i\">file</span> <span class=\"crayon-s\">\"root.hint\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639e7529616376-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639ea562279426\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzone      \"localhost\" IN {\r\ntype master;\r\nfile \"localhost.db\";\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639ea562279426-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639ea562279426-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639ea562279426-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639ea562279426-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639ea562279426-1\"><span class=\"crayon-i\">zone</span>      <span class=\"crayon-s\">\"localhost\"</span> <span class=\"crayon-st\">IN</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639ea562279426-2\"><span class=\"crayon-i\">type</span> <span class=\"crayon-v\">master</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639ea562279426-3\"><span class=\"crayon-i\">file</span> <span class=\"crayon-s\">\"localhost.db\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639ea562279426-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>定义第三个区域是为了反向查找到本地主机。这种反向查找是把本地的IP地址执向本地主机。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639ee318362414\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzone      \"0.0.127.in-addr.arpa\" IN {\r\ntype master;\r\nfile \"127.0.0.rev\";\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639ee318362414-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639ee318362414-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639ee318362414-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639ee318362414-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639ee318362414-1\"><span class=\"crayon-i\">zone</span>      <span class=\"crayon-s\">\"0.0.127.in-addr.arpa\"</span> <span class=\"crayon-st\">IN</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639ee318362414-2\"><span class=\"crayon-i\">type</span> <span class=\"crayon-v\">master</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639ee318362414-3\"><span class=\"crayon-i\">file</span> <span class=\"crayon-s\">\"127.0.0.rev\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639ee318362414-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>把这三个区域信息放到/etc/named.conf文件里，你的系统就可以以缓存服务器来工作了。但是如何引用类似<em>likegeeks.com.db</em>, <em>localhost.db</em>, 和 <em>127.0.0.rev</em>这些文件中的内容呢？</p>\n<p>这些文件包含具有某些选项的每个区域的DNS记录类型。 那么，这些DNS记录类型是什么以及它们是如何写的？</p>\n<p><strong>DNS记录类型</strong></p>\n<p>数据库文件包含诸如SOA、NS、A、PTR、MX、CNAME和TXT在内的记录类型。</p>\n<p>我们看看每一种类型都是如何记录的吧。</p>\n<p><strong>SOA：起始授权机构记录</strong></p>\n<p>SOA记录按如下形式开始描述一个站点的DNS条目：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639f1359138517\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nexample.com.      86400      IN      SOA      ns1.example.com.   mail.example.com.      (\r\n2017012604 ;serial\r\n86400 ;refresh, seconds\r\n7200 ;retry, seconds\r\n3600000 ;expire, seconds\r\n86400 ;minimum, seconds\r\n)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639f1359138517-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639f1359138517-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639f1359138517-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639f1359138517-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639f1359138517-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639f1359138517-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639f1359138517-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639f1359138517-1\"><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span>      <span class=\"crayon-cn\">86400</span>      <span class=\"crayon-st\">IN</span>      <span class=\"crayon-i\">SOA</span>      <span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span>   <span class=\"crayon-v\">mail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span>      <span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639f1359138517-2\"><span class=\"crayon-cn\">2017012604</span> <span class=\"crayon-sy\">;</span><span class=\"crayon-i\">serial</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639f1359138517-3\"><span class=\"crayon-cn\">86400</span> <span class=\"crayon-sy\">;</span><span class=\"crayon-v\">refresh</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">seconds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639f1359138517-4\"><span class=\"crayon-cn\">7200</span> <span class=\"crayon-sy\">;</span><span class=\"crayon-v\">retry</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">seconds</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639f1359138517-5\"><span class=\"crayon-cn\">3600000</span> <span class=\"crayon-sy\">;</span><span class=\"crayon-v\">expire</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">seconds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639f1359138517-6\"><span class=\"crayon-cn\">86400</span> <span class=\"crayon-sy\">;</span><span class=\"crayon-v\">minimum</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">seconds</span></div><div class=\"crayon-line\" id=\"crayon-58f7df6a639f1359138517-7\"><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>第一行以域名example.com开始，以句号结束——该语句和/etc/named.conf文件中的区域定义是一致的。我们要始终记得，DNS配置文件是极其挑剔的。</p>\n<p>IN 告诉域名服务器：这是一条网络记录。</p>\n<p>SOA 告诉域名服务器：这是一条起始授权机构记录。</p>\n<p>ns1.example.com. 是该文件所在域的域名服务器的完全合格域名（FQDN: Fully Qualified Domain Name)。</p>\n<p>mail.host.com. 是域管理员的邮箱地址。你会发现这个邮箱地址没有“@”标志，而是被句号所取代，并且末尾还有一个句号。</p>\n<p>第2行是一个序列码，它被用来告诉域名服务器文件是什么时候升级的。因此，如果你对区域码做了变更，你必须对这个序列码进行递增。这个序列码的格式是 YYYYMMDDxx ，其中的 xx 是从 00 开始的。</p>\n<p>第3行是每秒刷新率。这个值被用来告诉第二个域名服务器查询主服务器中的记录是否已经被更新的频率。</p>\n<p>第4行是每秒重试的频率。如果第二个服务器多次尝试连接主域名服务器来进行更新检测，但无法连接上的时候，第二个服务器就会在每秒内重试指定的数值次数。</p>\n<p>第5行是超时指示。其目的是为了第二个服务器能将区域数据缓存下来。这个值告诉这些服务器如果它们不能连接到主服务器来进行更新，那么它们就会在这个指定数值秒数之后抛弃这个值。</p>\n<p>第6行告诉缓存服务器，如果它们不能连接到主域名服务器时，它们应该在超时前等待多久。</p>\n<h3>NS: Name Server Records(名称服务器记录)</h3>\n<p>NS记录用于指定哪个名称服务器维护该域的记录。</p>\n<p>你可以这样编写的NS记录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639f5910261280\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nIN           NS         ns1.example.com.\r\nIN           NS         ns2.example.com.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639f5910261280-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639f5910261280-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639f5910261280-1\"><span class=\"crayon-st\">IN</span>           <span class=\"crayon-i\">NS</span>         <span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639f5910261280-2\"><span class=\"crayon-st\">IN</span>           <span class=\"crayon-i\">NS</span>         <span class=\"crayon-v\">ns2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>并不需要有2个NS记录，但是通常偏好有备份名称服务器。</p>\n<h3>A和AAAA: Address Records（地址记录）</h3>\n<p>A记录用于提供从主机名到IP地址的映射<em>support IN A 192.168.1.5</em>。</p>\n<p>如果你在地址为192.168.1.5上的support.example.com上有一个主机，你可以像上面的例子那样输入。</p>\n<p>请注意，我们所写的主机并没有句号。</p>\n<h3>PTR: Pointer Records（指针记录）</h3>\n<p>PTR记录用于执行反向名称解析，允许某人指定IP地址然后找出对应的主机名。</p>\n<p>这与A记录的功能相反：192.168.1.5 IN PTR <em>support.example.com</em>.</p>\n<p>在这里，我们键入具有点号的完整主机名。</p>\n<h3>MX: Mail Exchange Records（邮件交换记录）</h3>\n<p>MX记录告诉其他站点关于你所在域的邮件服务器地址：example.com. IN MX 10 mail.</p>\n<p>当然这个域以句号结束。数字10是邮件服务器的重要性标志，如果你拥有多个邮件服务器，其中较小的数字不太重要。</p>\n<h3>CNAME: Canonical Name Records（权威名称记录）</h3>\n<p>CNAME记录允许你为主机名创建别名。当你想提供一个易于记住的名称时，这很有用。</p>\n<p>假设某个站点具有一个主机名为<em>whatever-bignameis.example.com</em>的Web服务器，并且由于系统是Web服务器，因此可以为主机创建一个名为www的CNAME记录或者别名。</p>\n<p>你可以创建名为www.example.com的域名创建CNAME记录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7df6a639fc509672407\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwhatever-bignameis      IN           A                    192.168.1.5\r\nwww                     IN           CNAME                whatever-bignameis</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7df6a639fc509672407-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7df6a639fc509672407-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7df6a639fc509672407-1\"><span class=\"crayon-v\">whatever</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">bignameis</span>      <span class=\"crayon-st\">IN</span>           <span class=\"crayon-i\">A</span>                    <span class=\"crayon-cn\">192.168.1.5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7df6a639fc509672407-2\"><span class=\"crayon-i\">www</span>                     <span class=\"crayon-st\">IN</span>           <span class=\"crayon-i\">CNAME</span>                <span class=\"crayon-v\">whatever</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bignameis</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>第一行通知DNS服务器关于别名的位置。第二行创建一个指向www的别名。</p>\n<h2>TXT记录</h2>\n<p>您可以将任何信息存储到TXT记录中，例如你的联系方式或者你希望人们在查询DNS服务器时可获得的任意其他信息。</p>\n<p>你可以这样保存TXT记录：example.com. IN TXT ” YOUR INFO GOES HERE”.</p>\n<p>此外，RP记录被创建为对host联系信息的显式容器：example.com. IN RP mail.example.com. example.com。</p>\n<h2>DNS TTL值</h2>\n<p>在/etc/named.conf文件的顶部，这里有一个$TTL条目<strong>。</strong></p>\n<p>该条目告诉BIND每个单独记录的TTL值（time to live，生存时间值）。</p>\n<p>它是以秒为单位的数值，比如14,400秒（4个小时），因此DNS服务器最多缓存你的域文件4个小时，之后就会向你的DNS服务器重新查询。</p>\n<p>你可以降低这个值，但是默认值通常是合理的。除非你知道你正在做什么。</p>\n<h2>捕获配置错误</h2>\n<p>当您写入域文件时，也许您忘记了一个句号或空格或其他任意错误。</p>\n<p>你可以从日志诊断Linux DNS服务器错误。BIND服务通过/var/log/messages上的错误，可以使用tail命令来查看实时错误日志，须使用-f选项：$ tail -f /var /log/messages。</p>\n<p>因此，当你编写域文件或修改/etc/named.config并重新启动服务时，显示错误之后，你可以从日志中轻松识别错误类型。</p>\n<h2>Host命令</h2>\n<p>在你成功添加或修改记录后，可以使用host命令查看主机是否正确解析。</p>\n<p>host命令允许你将主机名解析为IP地址：$ host example.com。</p>\n<p>此外，你可以执行反向查找：$ host 192.168.1.5。</p>\n<p>你可以<a href=\"https://likegeeks.com/linux-network-commands/\" target=\"_blank\" rel=\"nofollow\">this在此篇文章中查看更多关于host和dig命令</a>的信息。</p>\n<h2>Whois命令</h2>\n<p>whois命令用于确定域名的所有权及其拥有者的e-mail地址和联系电话：$ whois example.com.</p>\n<h2>Rndc命令</h2>\n<p>rndc工具可用于安全地管理名称服务器，因为与服务器的所有通信均通过数字签名进行身份验证。</p>\n<p>此工具用于控制名称服务器和调试问题。 你可以通过以下方式检查Linux DNS服务器的状态：$ rndc status。</p>\n<p>此外，如果你更改任何域(zone)文件，您可以重新加载服务，而无须重启命名服务：$ rndc reload example.com。</p>\n<p>在这里，我们重新加载example.com域文件。 你可以重新加载所有域：$ rndc reload。</p>\n<p>或者你可以添加新的域或更改服务的配置。 你可以重新加载配置，如下所示：$ rndc reconfig。</p>\n<h2>Linux DNS解析器</h2>\n<p>我们已经知道Linux DNS服务器的工作原理以及如何配置它。另一部分当然是与DNS服务器交互的（正在与DNS服务器通信以将主机名解析为IP地址的）客户端。</p>\n<p>在Linux上，解析器位于DNS的客户端。要配置解析器，可以检查/etc/resolv.conf这个配置文件。</p>\n<p>在基于Debian的发行版上，可以查看/etc/resolvconf/resolv.conf.d/目录。</p>\n<p>/etc/resolv.conf文件中包含客户端用于获取其本地DNS服务器地址所需的信息。</p>\n<p>第一个表示默认搜索域，第二个表示主机名称服务器(nameserver)的IP地址。</p>\n<p>名称服务器行告诉解析器哪个名称服务器可使用。 只要你的BIND服务正在运行，你就可以使用自己的DNS服务器。</p>\n<p>使用Linux DNS服务器非常简单。 我希望你发现这篇文章很有用，并且很容易理解。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110903\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110903votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110903\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "14e3ea4362ad3dc99531f2fabe2e130d", "title": "软件的复杂性：命名的艺术", "url": "http://blog.jobbole.com/110900/", "create_date": "2017/04/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/2f4c76ec33cc609b31015a48f6e88a7c.png"], "praise_nums": 1, "comment_nums": 1, "fav_nums": 1, "tags": "开发,命名", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://hackernoon.com/software-complexity-naming-6e02e7e6c8cb\">hackernoon</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/the-art-of-software-naming?print\">开源中国</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/2f4c76ec33cc609b31015a48f6e88a7c.png\" width=\"1280\" height=\"800\"></p>\n<p>想把一个东西写好很难。为什么呢？因为只要写好了，才会有很好的阅读体验。我们往往关注了前者而忽略了后者。我们忘记了代码只写一次，但要读很多次。</p>\n<p>写得好是指写出来的东西读起来容易，而不是指写作本身，这一过程会产生大量的共鸣。它是指，退后一步，从读者的角度来理解所写的东西。人们必须以人的思维来理解问题，然后用其它人能够理解的方式表达出来。在我看来，软件属于社会科学的一部分。我们要搞清楚代码写出来是给谁看的，不是给人看的吗？</p>\n<p>因此，理解如何将思想和过程传达给我们的同行甚至我们自己，这就是编程的核心。</p>\n<h3>为组件命名</h3>\n<p>为了说清楚第一个概念，我们来玩一个叫“我们在哪个房间？”的游戏。我会给出一张图，然后你告诉我这是哪个房间。</p>\n<p><strong>3个问题中的第1个</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/075439c132b349079e30c57417386444.png\" width=\"1280\" height=\"800\"></p>\n<p>从这个图很容易判断出来是在<em>客厅</em>。我们从一个组件就能知道所处的房间。这非常容易，我们继续。</p>\n<p><strong>3个问题中的第2个</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/b687fa8aa99e0794acd2793935e962da.png\" width=\"1280\" height=\"800\"></p>\n<p>从这个物体很清楚的知道这是在<em>卫生间</em>。</p>\n<p>发现什么规律了吗？房间的名称是一个<strong>标签</strong>，它定义了这个房间里有什么。有了这个标签，我们不知道进去看也知道里面有些什么东西。这足以建立我们的第一个推论：</p>\n<p><strong>推论 1: 容器的名称包含了其功能元素</strong></p>\n<p>注意这是最基本的“鸭子类型”[译者注：如果它的动作像一只鸭子，那它就是鸭子]。如果有一张床，那这里就是卧室。</p>\n<p>反过来也是如此：基于容器的名称，我们可以推断出它的组成部分。如果我们谈论一个<em>卧室</em>，很可能它有一张床。这样产生了我们的第二个推论：</p>\n<p><strong>推论 2: 可以根据容器的名称推断其中的组件</strong></p>\n<p>显然我们已经有了一些规则，让我们把这些规则应用到下一个房间。</p>\n<p><strong><strong>3个问题中的最后一个</strong></strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/76b771fb5913ee8922ce4373a5c416bb.png\" width=\"1280\" height=\"800\"></p>\n<p>哇，床和马桶怎么会在<em>同一个房间</em>？这个房间的定义很模糊，朦朦胧胧，如果一定要用前面的两个推论来为这个房间命名，它只能称为<strong>怪物房间</strong>。</p>\n<p>这里的问题不在于房间里物体的数量，而在于完全无关的事物被看作有同样的功能。在家里，我们会把相关的有类似作用或意图的物品放在一起。如果把作用不同的东西胡乱放在一起，就让人搞不明白架构师到底想怎么来使用这些东西。由于混乱，我们在这里不知所措。</p>\n<p><strong>推论 3: 容器定义的明确程度与其内部组件的紧密程度成正比。</strong></p>\n<p>这似乎不容易理解，那来看看图示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/44ca81f919a81367fa19af60cada6c0b.png\" width=\"1280\" height=\"800\"></p>\n<p>如果组件相关，就很容易找到一个好名字[译者注：指容器的名字]。如果事务各不相干，找个合适的名字就会变得困难。这里提到的关系，可能是指它们的功能、目的、策略、类型等。在我们谈到标准之前，关系本身并不包含太多意思。现在先不要急，我们很快就会讲到。</p>\n<p>这对于软件同样适用。我们有组件、类、函数、服务、应用程序和其它一些东西。Robert Delaunay 曾经说过“我们的理解与我们的感知相关。”在当前的技术背景下，我们的代码是否能让读者以最简单的方式感知到业务需求呢？</p>\n<p><strong>示例 1: HTTP 领域和汽车 domain and a car</strong></p>\n<p>HTTP 是一个领域，它有请求和响应。如果我们我们在其中放入一个汽车组件，那就不能再称这为 HTTP。这种情况下它就已经变得混乱了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e21ce7427710638064\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic interface WhatIsAGoodNameForThis {\r\n  /* methods for a car */\r\n  public void gas();  public void brake();  /* methods for an HTTP client */\r\n  public Response makeGetRequest(String param); \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7427710638064-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7427710638064-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7427710638064-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7427710638064-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7427710638064-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e21ce7427710638064-1\"><span class=\"crayon-m\">public</span> <span class=\"crayon-t\">interface</span> <span class=\"crayon-e\">WhatIsAGoodNameForThis</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7427710638064-2\">  <span class=\"crayon-c\">/* methods for a car */</span></div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7427710638064-3\">  <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">gas</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span>  <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">brake</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span>  <span class=\"crayon-c\">/* methods for an HTTP client */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7427710638064-4\">  <span class=\"crayon-m\">public</span> <span class=\"crayon-i\">Response</span> <span class=\"crayon-e\">makeGetRequest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span> <span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span> </div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7427710638064-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/1fc7b4437e8d5aa60a0dcc1c2f0184eb.png\" width=\"1280\" height=\"800\"></p>\n<p><strong>示例 2: 通过词语来耦合</strong></p>\n<p>在类名中添加 Builder 或者其它以 er 结尾的单词是种常见的模式。SomethingBuilder、UserBuilder、AccountBuilder、AccountCreator、UserHelper、JobPerformer。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/37532eed4c837b0e69b5c61ef354cc3a.png\" width=\"620\" height=\"509\"></p>\n<p>通过名称，我们可以了解三件事情。首先，在类名中使用 Build 这个动词意味着它是穿着类这件外衣的程序。第二，它有两个隐藏在内部的元素，User 和 Builder，这意味着可能违反了封闭性原则。第三，这意味着 Builder 可以访问到 User 的内部工作，毕竟它们彼此纠缠。</p>\n<p>这类似于工厂模块。我们的示例代码在整个代码库中滥用时，它就会成为一个问题。此外，我得提醒你，在工厂模式中不需要什么类。应用程序的 createUser() 就能完成工厂的工作。</p>\n<p>[译者注：Builder 也是一种模式，所以关于作者的这个观点，请慎思]</p>\n<p><strong>示例 3: Base</strong></p>\n<p>来看一点实际项目中的例子。第一个例子是 <a href=\"https://github.com/svenfuchs/i18n/blob/master/lib/i18n.rb\" target=\"_blank\" rel=\"nofollow\">I18n</a>(国际化)的 Ruby Gem (为了简便起见，只列出了类和方法的名称)：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e21ce7432461980642\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Base\r\n def config\r\n def translate\r\n def locale_available?(locale)\r\n def transliterate\r\nend</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7432461980642-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7432461980642-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7432461980642-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7432461980642-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7432461980642-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7432461980642-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e21ce7432461980642-1\"><span class=\"crayon-t\">class</span> <span class=\"crayon-i\">Base</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7432461980642-2\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-i\">config</span></div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7432461980642-3\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-i\">translate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7432461980642-4\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">locale_available</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">locale</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7432461980642-5\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-e\">transliterate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7432461980642-6\"><span class=\"crayon-st\">end</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这里的 <em>Base</em> 并不能表达什么意思。它可以进行配置和翻译，也可以描述一个位置是否可用。它做了一些各不相同，毫不相干的事情。</p>\n<p><strong>示例 4: 名称引导设计</strong></p>\n<p>我们在谈论名称如何引导我们的设计时，提到了好几个例子，让我们感兴趣的例子中，有一个如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e21ce7436037704139\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass PostAlerter\r\n def notify_post_users\r\n def notify_group_summary\r\n def notify_non_pm_users\r\n def create_notification\r\n def unread_posts\r\n def unread_count\r\n def group_stats\r\nend</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7436037704139-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7436037704139-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7436037704139-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7436037704139-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7436037704139-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7436037704139-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7436037704139-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7436037704139-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7436037704139-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e21ce7436037704139-1\"><span class=\"crayon-t\">class</span> <span class=\"crayon-i\">PostAlerter</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7436037704139-2\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">notify_post</span><span class=\"crayon-sy\">_</span>users</div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7436037704139-3\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">notify_group</span><span class=\"crayon-sy\">_</span>summary</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7436037704139-4\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">notify_non_pm</span><span class=\"crayon-sy\">_</span>users</div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7436037704139-5\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">create</span><span class=\"crayon-sy\">_</span>notification</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7436037704139-6\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">unread</span><span class=\"crayon-sy\">_</span>posts</div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7436037704139-7\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">unread</span><span class=\"crayon-sy\">_</span>count</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7436037704139-8\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-e\">group_stats</span></div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7436037704139-9\"><span class=\"crayon-st\">end</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p><em>PostAlerter</em> 这个名称暗示我们它的功能是在提交的时候<em>提醒</em>某人。然而，<em>unread_posts</em>、<em>unread_count</em> 和 <em>group_stats </em>却很明显在干别的事情，这就使得类名称不太理想。如果把这三个方法改到名为 <em>PostsStatistics</em> 的类中，表达出来就更清晰，让新接触的人一看就能明白。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e21ce743a538908301\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass PostAlerter\r\n def notify_post_users\r\n def notify_group_summary\r\n def notify_non_pm_users\r\n def create_notification\r\nend\r\nclass PostsStatistics\r\n def unread_posts\r\n def unread_count\r\n def group_stats\r\nend</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce743a538908301-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce743a538908301-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce743a538908301-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce743a538908301-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce743a538908301-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce743a538908301-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce743a538908301-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce743a538908301-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce743a538908301-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce743a538908301-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce743a538908301-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e21ce743a538908301-1\"><span class=\"crayon-t\">class</span> <span class=\"crayon-i\">PostAlerter</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce743a538908301-2\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">notify_post</span><span class=\"crayon-sy\">_</span>users</div><div class=\"crayon-line\" id=\"crayon-58f7e21ce743a538908301-3\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">notify_group</span><span class=\"crayon-sy\">_</span>summary</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce743a538908301-4\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">notify_non_pm</span><span class=\"crayon-sy\">_</span>users</div><div class=\"crayon-line\" id=\"crayon-58f7e21ce743a538908301-5\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-e\">create_notification</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce743a538908301-6\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-58f7e21ce743a538908301-7\"><span class=\"crayon-t\">class</span> <span class=\"crayon-i\">PostsStatistics</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce743a538908301-8\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">unread</span><span class=\"crayon-sy\">_</span>posts</div><div class=\"crayon-line\" id=\"crayon-58f7e21ce743a538908301-9\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-v\">unread</span><span class=\"crayon-sy\">_</span>count</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce743a538908301-10\"> <span class=\"crayon-i\">def</span> <span class=\"crayon-e\">group_stats</span></div><div class=\"crayon-line\" id=\"crayon-58f7e21ce743a538908301-11\"><span class=\"crayon-st\">end</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><strong>示例 5: 奇怪的名称</strong></p>\n<p>Spring 框架中有一些例子说明组件做的事情太多，其名称类似于我们的<strong>怪物房间</strong>。这里就有<a href=\"http://docs.spring.io/spring/docs/2.5.x/javadoc-api/org/springframework/aop/config/SimpleBeanFactoryAwareAspectInstanceFactory.html\" target=\"_blank\" rel=\"nofollow\">一个</a> (因为<a href=\"http://www.javafind.net/gate.jsp?q=%2Flibrary%2F36%2Fjava6_full_apidocs%2Fcom%2Fsun%2Fjava%2Fswing%2Fplaf%2Fnimbus%2FInternalFrameInternalFrameTitlePaneInternalFrameTitlePaneMaximizeButtonWindowNotFocusedState.html\" target=\"_blank\" rel=\"nofollow\">这个</a>就太多了点)：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e21ce743e420874388\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass SimpleBeanFactoryAwareAspectInstanceFactory { public ClassLoader getAspectClassLoader() public Object getAspectInstance() public int getOrder() \r\n public void setAspectBeanName(String aspectBeanName) \r\n public void setBeanFactory(BeanFactory beanFactory)\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce743e420874388-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce743e420874388-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce743e420874388-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce743e420874388-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e21ce743e420874388-1\"><span class=\"crayon-t\">class</span> <span class=\"crayon-e\">SimpleBeanFactoryAwareAspectInstanceFactory</span> <span class=\"crayon-sy\">{</span> <span class=\"crayon-m\">public</span> <span class=\"crayon-i\">ClassLoader</span> <span class=\"crayon-e\">getAspectClassLoader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">Object</span> <span class=\"crayon-e\">getAspectInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-e\">getOrder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce743e420874388-2\"> <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">setAspectBeanName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span> <span class=\"crayon-v\">aspectBeanName</span><span class=\"crayon-sy\">)</span> </div><div class=\"crayon-line\" id=\"crayon-58f7e21ce743e420874388-3\"> <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">setBeanFactory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">BeanFactory</span> <span class=\"crayon-v\">beanFactory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce743e420874388-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p><strong>示例 6: 改变一下，说说好名称</strong></p>\n<p>我们讲了太多不好的名称。D3 的 <a href=\"https://github.com/d3/d3-shape/blob/master/src/arc.js\" target=\"_blank\" rel=\"nofollow\">arc</a> 中就定义了不错的名称，比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e21ce7441964392113\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nexport default function() {  /* ... */\r\n  arc.centroid     = function() { /* ... */ }\r\n  arc.innerRadius  = function() { /* ... */ }\r\n  arc.outerRadius  = function() { /* ... */ }\r\n  arc.cornerRadius = function() { /* ... */ }\r\n  arc.padRadius    = function() { /* ... */ }\r\n  arc.startAngle   = function() { /* ... */ }\r\n  arc.endAngle     = function() { /* ... */ }\r\n  arc.padAngle     = function() { /* ... */ }  return arc;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7441964392113-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7441964392113-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7441964392113-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7441964392113-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7441964392113-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7441964392113-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7441964392113-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7441964392113-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f7e21ce7441964392113-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e21ce7441964392113-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e21ce7441964392113-1\"><span class=\"crayon-i\">export</span> <span class=\"crayon-st\">default</span> <span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span>  <span class=\"crayon-c\">/* ... */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7441964392113-2\">  <span class=\"crayon-v\">arc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">centroid</span>     <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span> <span class=\"crayon-c\">/* ... */</span> <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7441964392113-3\">  <span class=\"crayon-v\">arc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">innerRadius</span>  <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span> <span class=\"crayon-c\">/* ... */</span> <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7441964392113-4\">  <span class=\"crayon-v\">arc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">outerRadius</span>  <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span> <span class=\"crayon-c\">/* ... */</span> <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7441964392113-5\">  <span class=\"crayon-v\">arc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cornerRadius</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span> <span class=\"crayon-c\">/* ... */</span> <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7441964392113-6\">  <span class=\"crayon-v\">arc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">padRadius</span>    <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span> <span class=\"crayon-c\">/* ... */</span> <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7441964392113-7\">  <span class=\"crayon-v\">arc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">startAngle</span>   <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span> <span class=\"crayon-c\">/* ... */</span> <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7441964392113-8\">  <span class=\"crayon-v\">arc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">endAngle</span>     <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span> <span class=\"crayon-c\">/* ... */</span> <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f7e21ce7441964392113-9\">  <span class=\"crayon-v\">arc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">padAngle</span>     <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span> <span class=\"crayon-c\">/* ... */</span> <span class=\"crayon-sy\">}</span>  <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">arc</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e21ce7441964392113-10\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>这些方法每一个意义都很有完整的意义：它们都是基于弧所拥有的属性来命名的。下图中我非常喜欢的一点在于它真的很简单。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/be41b84f8106a8831331014e4125e45d.png\" width=\"1280\" height=\"800\"></p>\n<h4>方法 1: 拆解</h4>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/b63cae0d8038f340ee5aaed186930e46.png\" width=\"1280\" height=\"800\"></p>\n<p><strong>应用场景：</strong>你不能为类或组件找到好名称，但你知道如何拆解它们，而且期望给它们的组合找到一个好名称。</p>\n<p>这包含两个步骤：</p>\n<p>1. 确认我们拥有的概念<br>\n2. 拆解它们</p>\n<p>在马桶 + 床的情况下，我们把不同的事物拉开，床在左，马桶在中。好了，我们终于把事物拆分成两个部分，使它们不再那么别扭了。</p>\n<p>如果你不能为某个事物找到好名称的时候，也许是因为你面前不只一件事物。不过你现在已经知道对多个事物命名是件困难的事情。当遇到麻烦的时候，不妨确认一下构成这个事物的部分和动作。</p>\n<p><strong>示例</strong></p>\n<p>我们有一个尚未命名的类，包含 <em>request</em>、<em>response</em>、<em>headers</em>、<em>URLs</em>、<em>body</em>、<em>caching</em> 和 <em>timeout</em>。把所有这些从主类中拉出来，我们剩下了这样一些组件：Request、Response、Headers、URLs、ResponseBody、Cache、Timeout 等。如果我们已知这些类的名称，就会相当确定我们正在处理一个 Web 请求。HTTPClient 会是个不错的 Web 请求组件名称。</p>\n<p>遇到困难的代码时，不要一开始就想着整体。考虑一下部分。</p>\n<h4>方法 2: 发现新概念</h4>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/71f33fb93653d6b90d78f3b3f4c2c190.png\" width=\"1280\" height=\"800\"></p>\n<p><strong>应用场景：</strong>某个类并不简单或者不清晰时</p>\n<p>发现新的概念需要业务领域的知识。如果在软件中使用业务术语，因为专业语言已经建立了而且到处都在使用(Evans, 2003)，不同专业领域的专业人士就会使用同样的习语。</p>\n<p><strong>示例 1: 将组件封装到新的概念中</strong></p>\n<p>几年前，一家公司即将失去一份大合同。为什么呢？因为该团队发布新功能和修复错误的速度太慢。</p>\n<p>这个市场电子商务为不同国家的学生提供不同规则的多个支付网关，要求相当复杂。当我看到付款代码– PaymentGateway 时，我对其复杂性感到震惊，其中包括：User、UserAddress、CreditCard、BillingAddress、SellerAddress、LineItems、Discounts 等等。它的构造函数是巨大的，这种复杂性使得很难添加新的规则，因为改动一处会破坏其他规则，同时要求我们改动所有网关适配器。</p>\n<p>问题延伸到付款之外的事情。电子邮件会发送给学生，通过 messaging 类再次聚合所有这些数据。技术支持也有自己的显示端，这个数据第三次发生聚合，除了在这个特定的地方使用一个叫做 Aggregator（没有上下文的单词）的类。我们不得不做一些更改以修复这个架构阻碍。</p>\n<p>为了解决这个问题，我开始了一个头脑练习。这是一个如何去做的想法：</p>\n<blockquote><p>在这里，我用于关于此事的这些细节，我需要你（PaymentGateway）对我负责。如果这是一张桌子，我会组织这些文案，我可能会把它们称为 Invoice（发票）。那么如果我创建了一个名为“Invoice”的类，这只不过是所有这些其他细节的汇总，这样网关就不需要知道这些规则是如何完成的，因为 Invoice 是知道的？不是插入一百万件物品，我只是把它交给你？</p></blockquote>\n<p>术语 Invoice 未在任何其他地方使用过。我们花了一个月时间在此重构，一旦完成，我们就能够更快更新软件。<br>\nInvoice 是概念的一个很好的示例，它是来自许多源的数据汇总，并且大多数人都知道它是什么。 最终的解决方案增加了 Invoice 类，把它单独注入到网关中，使用门面模式并隐藏其他类。</p>\n<p>良好的命名不仅仅是写出美丽的语句，还要更准确地描述以前无法表达的内容。</p>\n<p><strong>示例 2: 基于业务域的名称变动</strong></p>\n<p>在一个绿地拼车项目中，我们从新设计了该系统，在研究其他交通运输解决方案时发现，在某一天从起点到目的地描述某人旅程的最适当的词是旅行(trip)，而这群人被称为乘客(ride)。 我们发布了一个词汇表，所以公司的其余人员可以讨论和分享相同的通用语言。</p>\n<p>推出之后，我们的客户总是把 trips 称为 rides 。 不久之后，我们在将客户要求转换为必须完成的任务遇到麻烦，痛定思痛之后，我们决定是时间将 trips 重构为 rides ，将 rides 重构为 carpools 了。这就解决了在一家公司讲两种不同语言的问题。</p>\n<p><strong>示例 3: 抽象的等级</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/1a2b8a4cc8d75430bcbe34e9bcaaf461.png\" width=\"1202\" height=\"800\"></p>\n<p>一个人说，移动右腿然后左腿然后右腿，另一个说走路。两者都是一样的，但后者据说更抽象。</p>\n<p>理想情况下，随着代码越来越接近其公开 API ，它越接近于企业术语。随着它越接近数据库和底层，它使用与其上下文相关的机器术语。在这之间，存在一个从多到少抽象渐变过程。</p>\n<p>在一家公司，一个商人会说 post Tweet，所以一个如 postTweet() 的名字将会比一个公开的 API（比如makeHttpRequest())更有意义。在一家拥有更多技术服务的公司中，后者将更为充实。</p>\n<p>第二，考虑特异性。postTweet() 非常具体，而 makeHttpRequest() 是如此通用，它可以用于 Facebook 或基本上涉及 HTTP 的任何内容。一个通用名称可以轻易地重用，代价是不确定性。 这就解释了为什么框架代码与商业软件代码的有如此大的区别。</p>\n<p><strong>示例 4: generalization 泛化</strong></p>\n<p>很久以前，CMS 中有数据库表 news、history、videos、articles、pages、other。他们中大多数具有相同的列：title、summary、text。videos 表具有额外的属性，例如 url（嵌入YouTube）； history 表具有日期属性，以便页面可以按年份显示历史事件列表。所有这些表格看起来像是副本，在这里和那里仅有一些差异，而且添加新的功能需要重写大量的样板。</p>\n<p>我将所有这些表折叠成一个称为 contents 的外键，指向一个名为 sections 的表，其中包含 news、history、videos、others 的列表。现在，contents 的一个编码就足够了。多年以后，一个朋友不得不写一个小的 CMS，我推荐使用同样的做法。一旦管理内容的表单完成，它一般花费了1/N时间来实现任何功能，因为对于同一类型的每个新的部分，它都已经完成了。</p>\n<p>通过赋予它另一个名字极大得提高生产力。news 是一类内容，Article 也是一类内容，history 又是一类内容。所有这些都可以共享相同的属性吗？是的。</p>\n<h4>方法 3: 分组的标准</h4>\n<p><strong>什么时候使用</strong>：当名字很好但是他们不能很好地配合时。</p>\n<p>组件可以按照各种标准进行分组，包括物理性质、经济性、感情色彩、社会性和软件中最常用的功能。Photo 框架根据感情色彩方面分组，而产品则根据经济动机分组。 沙发和电视留在同一个房间，根据功能标准分组在一起，因为它们具有相同的功能或目的，均用于休闲。</p>\n<p>在软件中，我们倾向于按功能对组件进行分组。列出你的项目文件，你可能会看到像 controller/、models/、adapters/、templates/ 等等。 然而，有些时候，这些分组可能不太合理，这将是重新评估模块结构的最佳时间。</p>\n<p><strong>示例: 使用策略进行分组</strong></p>\n<p>用于自动化文档操作的库根据代码、lints 描述文件（保证格式正确）生成规范文档（比如 API 蓝图）并上传到云中（比如 S3 ）。</p>\n<p>根据文件格式，将自动进行各种后续决定。选择 API 蓝图将会选择不同的 linter，不同的测试器和不同的 API 元素转换器。 这里基于一个输入来组合所有这些不同的功能的关键词是策略(strategy)。此后，该库中包含一个将文件格式、linter、文档测试器和存储提供程序组合在一起的模块或者命名空间，被称为Strategy（策略）。这使得库可以将业务核心策略中的普通文件操作（如上传者、解析器和命令行等）分开。</p>\n<h3>利用上下文</h3>\n<p>每个应用程序都有不同的上下文，包括其中的每个模块，它们中的每个类，每个函数都有。单独的 User 一词可以表示系统的用户，但也可能是数据库表或第三方服务凭证。 lib/billing/user 与 lib/booking/user 是不同的，但仍然属于用户范畴。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/2fba593a08f521ca4a9edf9f7db58733.png\" width=\"956\" height=\"702\"></p>\n<p>设想一下，每个诸如模块的容器，都是一个桶。 在其中，组件与外界绝缘。 你可以自由地命名这些类，无论你想要什么样的名字。这使得不必为常见事物寻找深奥的名字而绞尽脑汁。</p>\n<p>针对微服务（许多独立的桶）胜过整体式架构（一个内嵌小桶的大桶）的一个强有力的论据是它加强了对每个服务中的责任的限制，因为现在你不能轻易地将完全不相关的事情互相整合在一起。 Billing 位于 BillingApp 内部，booking 位于 BookingApp 内等等。但在整体架构中，这些相应的服务名称可以是简单的模块名称，但并不是每个人都有责任来保持整洁。</p>\n<p><strong>示例: Namespaces （命名空间）</strong></p>\n<p>马克正在建立一个需要生成数十万个广告的 ads 平台，然后将其发送到 AdWords、Facebook 和 Bing ，所有这些都通过图形用户界面（GUI）进行管理。</p>\n<p>马克从一个称为 Ad 的实体开始，很快就变得膨胀。AdWords 的广告有 headline_part1 和 headline_part2 ，但 Facebook 里面不是这样，而 Bing 只有一个 headline（标题）。 他需要想办法分开他的实体。他考虑到不同的语境，以及他如何利用语言的命名空间来表达这一点。 他想出了以下结构：</p>\n<ul>\n<li>Adwords::Ad：这表示 Adwords 中一个 ad 对象。它用于专属于 Adwords 的属性以及可包含在该类的逻辑处理。</li>\n<li>Facebook::Ad：和上一个类似，但是它拥有 Facebook 专有的要求和逻辑处理。</li>\n<li>Bing::Ad：和上面的类似。</li>\n<li>RemoteAdService::Ad：这个作为 Adwords::Ad、Facebook::Ad、Bing::Ad 与系统的其他部分交互的接口。这意味着这三个类将会拥有同样的公共 API，允许系统使用多态。</li>\n<li>Database::Ad：这是 ads 表的 ORM。它使用 ActiveRecord、DataMapper 或者其他自定义方案。</li>\n<li>GUI::Ad：这表示在 UI 上用于显示广告的属性。它可能包含展示和国际化的功能。</li>\n<li>API::Ad：针对那些用于自定义属性的广告的 HTTP 终端，因此序列化的逻辑保存在这里是有道理的。</li>\n</ul>\n<p>单词在不同的上下文中可以表示不同的东西，当我们考虑上下文时，我们可以为组件选择更简单的单词。 在这个示例中，我们没有必要做任何复杂动作来找到这些组件名称，因为它们是一回事，ad（广告）。</p>\n<h3>无意义和新词</h3>\n<p>多年来，名字变革并获得新的含义。其他人来补充新的意义。</p>\n<p><strong>小助手 Helper</strong>：Helper 是那些支持应用程序的主要目标的函数。但是，那么用来定义应用程序的主要目标的标准是什么呢？应用程序中的所有东西都是用于支持应用程序主要目标的。</p>\n<p>在实践中，它们被集中在一个非自然的分组中，为一些其他常用的操作提供可重用模块。他们倾向于遇到<a href=\"https://sourcemaking.com/refactoring/smells/feature-envy\" target=\"_blank\" rel=\"nofollow\">依赖情结Feature Envy</a>，他们需要访问另一个组件的内部数据来工作。他们也是那些找不到合适名字的东西的缘由。</p>\n<p><strong>Base</strong>：名为 Base 的类是很久以前在 C＃ 中在缺少一个更好的名字时用于指定继承的惯例。例如，汽车和自行车的父类将是 Base 而不是 Vehicle。尽管微软的编码规范中建议避免了这个名字（Cwalina，2009），但它影响了 Ruby 世界，其中最著名的是 ActiveRecord。到目前为止，我们依然可以看到在开发者找不到合适名字时使用 Base 作为类名的情况。</p>\n<p><em>Base </em>的变体包括 <em>Common </em>和 <em>Utils 。</em>例如，<a href=\"https://github.com/flori/json/blob/65297fbae1e92e26fdde886fe156bac322977db2/lib/json/common.rb\" target=\"_blank\" rel=\"nofollow\">JSON</a> Ruby gem Common 类具有解析、生成、加载和 jj 的方法，但是这里的 Common 究竟是什么意思呢？</p>\n<p><strong>Tasks</strong>：在 Javascript 社区有一个指示来调用异步函数，tasks。 它起源于 task.js ，即使原始库不存在，该术语也依然被使用。</p>\n<p>团队中的每个人都能理解这个吗？ 那就好了。但是，当一个新人加入该团队，遇到被抛弃在垃圾堆中的 60年代以来就存在的命名法，又会是怎样呢？</p>\n<p>我在一个项目中工作，其中一个类的名字，猜猜看，<strong>Atlanta</strong>。 是的，亚特兰大， 操蛋的亚特兰大。没有人知道或可以告诉我为什么使用这种叫法。</p>\n<h3>沟通</h3>\n<blockquote><p>“Reality exists in the human mind and nowhere else.（事实存在于人的思想中，而不是其他任何地方）” George Orwell</p></blockquote>\n<p>我认为沟通交流的做法是一个利他主义的行为，我们提高技能的努力与我们对他人的关心程度有关。我们希望人们更容易理解，我们想要消除冲突和障碍。</p>\n<p>其次，我们希望别人能理解我们。通过承认投递消息给接收者是发件人的责任，我们建立一个移情的环境。 这是一个双赢的局面。 没有任何借口不去练习我们的沟通技巧 – 除非你住在丛林中。</p>\n<p>随着写作，我们优化阅读，移情的练习可能是枯燥的。但是，正如生活中的一切，熟练度只会出现在那些常练习的人身上。</p>\n<p><strong>参考书目</strong></p>\n<p>Cwalina，Krzysztof.2009，框架设计指南：可重用 .NET 库的约定、惯用语和模式，第二版。 Boston: Pearson Education, Inc. 206。<br>\nEvans, Eric. 2003。域驱动设计：解决软件核心复杂性。Boston: Addison-Wesley Professional。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110900\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110900votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110900\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "e1dc17434dc808cb8407c50ff0190b53", "title": "编程语言的叛逃路线，猜猜 PHP 转投最多的是？", "url": "http://blog.jobbole.com/110862/", "create_date": "2017/04/13", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/79c8844dfda551a7021b1d13a2a38ba9.jpg"], "praise_nums": 3, "comment_nums": 0, "fav_nums": 3, "tags": "开发,编程语言", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://erikbern.com/2017/03/15/the-eigenvector-of-why-we-moved-from-language-x-to-language-y.html\">Erik Bernhardsson</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>我看了一篇博客，标题是《为什么我们要从 X 语言转到 Y 语言》，具体是哪种编程语言，我忘了。于是我开始想，是不是可以把这些文章归纳起来，生成一个关于从 X 语言转到 Y 语言的 N*N 的联列表（contingency table）？</p>\n<p>所以我写了个小脚本，可以用脚本在 Google 上查询，再加上一小段代码就能得到搜索结果的数目。我尝试了用几个不同的关键词来搜索，像“<em>move from &lt;language 1&gt; to &lt;language 2&gt;”</em>，“<em>switch to &lt;language 2&gt; from &lt;language 1&gt;</em> ”等等。最终得到了一个所有语言的 N*N 的联列表。</p>\n<p>本文图表尺寸很大，先来解释如何读图：</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/63918611gy1fel7q2i8xmj20et0bogob.jpg\"></p>\n<ul>\n<li>左侧纵向语言是「<strong>叛逃的源语言」</strong>；</li>\n<li>上方横向的语言是「<strong>叛逃的目标语言」</strong>；</li>\n<li>例如：从 C 语言转到 C# 的数量为 3619，从 C# 转到 C 的有 37229；</li>\n</ul>\n<p> </p>\n<p><a href=\"http://wx2.sinaimg.cn/large/63918611gy1fel6jddgfij21kw1kwwxy.jpg\" target=\"_blank\"><img class=\"alignnone aligncenter\" src=\"http://wx2.sinaimg.cn/large/63918611gy1fel6jddgfij21kw1kwwxy.jpg\" width=\"2048\" height=\"2048\"></a></p>\n<p style=\"text-align: center;\">（<a href=\"http://wx2.sinaimg.cn/large/63918611gy1fel6jddgfij21kw1kwwxy.jpg\" target=\"_blank\">点击查看大图</a>）</p>\n<p>有意思的部分来了。实际上我们可以把搜索结果数看作是编程语言之间转换的概率，从而得出一些关于未来编程语言的流行趋势的结论。一个关键点是，这个（编程语言转换过程）的平稳分布并不取决于它们的初始分布。事实证明，这只是矩阵的第一特征向量（first eigenvector）而已。所以没必要去假设现在哪种编程语言很流行，我们推测出的未来的平稳分布状态和初始状态是独立的。</p>\n<p>我们需要把上述的联列表转化成转移矩阵（<a href=\"https://en.wikipedia.org/wiki/Stochastic_matrix\">stochastic matrix</a>）的形式，用来描述从状态 ii 到状态 jj 的概率。非常简单——想要把联列矩阵解释为转移概率的话，可以将联列矩阵的每一行正则化。这样就能得到从 X 语言到 Y 语言的粗略近似概率。</p>\n<p>找出第一特征向量并不重要，我们只要把一个向量多次乘上这个转移矩阵，最终会向第一特征向量收敛。顺便说下，可以看看下面的注意事项，有关于我如何操作的更多讨论。</p>\n<h3>Go 是编程语言的未来（？）</h3>\n<p>闲话少说，下表是平稳分布下排名前几的语言：</p>\n<table width=\"557\">\n<tbody>\n<tr>\n<td width=\"255\">16.41%</td>\n<td width=\"302\">Go</td>\n</tr>\n<tr>\n<td width=\"255\">14.26%</td>\n<td width=\"302\">C</td>\n</tr>\n<tr>\n<td width=\"255\">13.21%</td>\n<td width=\"302\">Java</td>\n</tr>\n<tr>\n<td width=\"255\">11.51%</td>\n<td width=\"302\">C++</td>\n</tr>\n<tr>\n<td width=\"255\">9.45%</td>\n<td width=\"302\">Python</td>\n</tr>\n</tbody>\n</table>\n<p>根据未来流行度，我把转移矩阵按照编程语言做了排序（根据第一特征向量所做的预测）</p>\n<p><a href=\"http://wx1.sinaimg.cn/large/63918611gy1fel6jj92wcj21kw1kwnet.jpg\" target=\"_blank\"><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/large/63918611gy1fel6jj92wcj21kw1kwnet.jpg\" width=\"2048\" height=\"2048\"></a></p>\n<p style=\"text-align: center;\">（<a href=\"http://wx1.sinaimg.cn/large/63918611gy1fel6jj92wcj21kw1kwnet.jpg\" target=\"_blank\">点击查看大图</a>）</p>\n<p>令人惊讶的是（至少对我来说），Go 成为最大赢家。有超多的搜索结果显示大家由其他语言转向 Go。我都不能确定我对此是什么感受了（我对 Go 的感情很复杂）。但是我的绝对分析指出了一个必然结论，那就是 Go 值得关注。</p>\n<p>C 语言到今年就有 45 岁了，仍然表现良好。我手动做了一些搜索，有很多都是人们真的在写他们通过从另一种编程语言迁移到 C，对特定的紧密循环（tight loops）做了优化。这个结果是错的吗？我不这么认为。C 语言是计算机工作的通用语言（lingua franca），如果人们还会积极地将其他语言的片段转换为 C 语言，那么这个结论也就可想而知了。说真的，我认为 C 语言会在它 100 岁生日，也就是 2072 年以前，变得更强大。有我在 LinkedIn 上对 C 的支持，我希望招聘人员能在 21 世纪 50 年代的时候给我一些关于 C 语言的工作机会（我收回上面那句话——希望 C 会比 LinkedIn 活得久）。</p>\n<p>除了上面提到的以外，这些分析也很符合我的预期。<span style=\"color: #ff0000;\"><strong>Java 还在，Perl 灭亡了，Rust 做的相当不错</strong></span>。</p>\n<p>顺便一提，这个分析让我想起了下面这条推</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fel6jniahdj20ee0omqc3.jpg\" width=\"518\" height=\"886\"></p>\n<p>这图非常有意思，展示了在数据分析中 R 和 Python 之间的转化率。</p>\n<h3>JavaScript 框架</h3>\n<p>我对前端框架也做了同样的分析：</p>\n<p><a href=\"http://wx3.sinaimg.cn/large/63918611gy1fel6jra25fj21eu1eu0yd.jpg\" target=\"_blank\"><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/large/63918611gy1fel6jra25fj21eu1eu0yd.jpg\" width=\"1830\" height=\"1830\"></a></p>\n<p>我预期 React 会脱颖而出成为第一，但有趣的是，Vue 也表现得非常好。我很惊讶于 Angular 的表现——传闻大批的人似乎在逃离 Angular。</p>\n<h3>数据库</h3>\n<p><a href=\"http://wx1.sinaimg.cn/large/63918611gy1fel6jv0v67j21hc1hcn3l.jpg\" target=\"_blank\"><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/large/63918611gy1fel6jv0v67j21hc1hcn3l.jpg\" width=\"1920\" height=\"1920\"></a></p>\n<p>我开始留意共享单车 App，深度学习框架还有其他一些东西，但是数据太稀疏了，也不太可靠。有结果的话，会及时向大家公布的！<strong>   </strong></p>\n<h3>注意事项</h3>\n<ul>\n<li>关于我这篇文章，看看网友们在 <a href=\"https://news.ycombinator.com/item?id=13882601\">Hacker News</a> 和 <a href=\"https://www.reddit.com/r/programming/comments/5zonf2/the_eigenvector_of_why_we_moved_from_language_x/\">/r/programming</a> 上的讨论；</li>\n</ul>\n<ul>\n<li><a href=\"https://dev.to/tra/why-i-switch-from-language1-to-language2\">为什么我从编程语言 1 转向编程语言 2</a>，这篇博文给我启发；</li>\n</ul>\n<ul>\n<li>下面是如何抓取 Google 并获取搜索结果数的代码：</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f84925a4ffa729930755\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef get_n_results_dumb(q):\r\n    r = requests.get('http://www.google.com/search',\r\n                     params={'q': q,\r\n                             \"tbs\": \"li:1\"})\r\n    r.raise_for_status()\r\n    soup = bs4.BeautifulSoup(r.text)\r\n    s = soup.find('div', {'id': 'resultStats'}).text\r\n    if not s:\r\n        return 0\r\n    m = re.search(r'([0-9,]+)', s)\r\n    return int(m.groups()[0].replace(',', ''))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f84925a4ffa729930755-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84925a4ffa729930755-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f84925a4ffa729930755-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84925a4ffa729930755-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f84925a4ffa729930755-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84925a4ffa729930755-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f84925a4ffa729930755-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84925a4ffa729930755-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f84925a4ffa729930755-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84925a4ffa729930755-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f84925a4ffa729930755-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f84925a4ffa729930755-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_n_results_dumb</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84925a4ffa729930755-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'http://www.google.com/search'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58f84925a4ffa729930755-3\"><span class=\"crayon-h\">                     </span><span class=\"crayon-v\">params</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'q'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84925a4ffa729930755-4\"><span class=\"crayon-h\">                             </span><span class=\"crayon-s\">\"tbs\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"li:1\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f84925a4ffa729930755-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">raise_for_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84925a4ffa729930755-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bs4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f84925a4ffa729930755-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'id'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'resultStats'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84925a4ffa729930755-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58f84925a4ffa729930755-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84925a4ffa729930755-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">search</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'([0-9,]+)'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f84925a4ffa729930755-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">groups</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">','</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p></p>\n<ul>\n<li>很不幸，Google 对查询的 IP 有速率限制，但是我最终用 <a href=\"https://proxymesh.com/\">Proxymesh</a> 抓取到了这 N*N 组合所需的所有数据。</li>\n</ul>\n<ul>\n<li>注意：我在搜索的时候将确切的查询语句放在双引号中了，比如：<em>“switch from go to c++”</em></li>\n</ul>\n<ul>\n<li>细心的读者可能会问为什么 JavaScript 没有包含在分析中。原因是：（a）如果你在前端开发中使用它，那么你会一直坚持用下去，并没有转移的这个过程，除非你疯了，要做转译（transpiling，从一种编程语言到另一种编程语言的编译），这种情况太不常见了；（b）大家会把后端的 JavaScript 认作是 “Node”。</li>\n</ul>\n<ul>\n<li>对角线的元素又是怎么回事呢？当然了，有些人会只坚持使用一种编程语言，这也是有很大的可能性的。但是我选择忽略它，因为：（a）事实证明，像“stay with Swift”（坚守 Swift）的搜索结果 99% 都是和女明星 Taylor Swift 相关的；（b）平稳分布与添加一个常数对角（单位）矩阵是无关的（即添加一个常数对角矩阵结果不变）；（c）这是我的博客，所以我想怎样就怎样 [坏笑]</li>\n</ul>\n<ul>\n<li>对于上一条的（b），e(αS+(1−α)I) = e(S) 这个结论是对的，其中，e(…) 是第一特征向量，I 是单位矩阵。这个结论可能不完全符合现实，对于不同的编程语言，你坚持用它的概率可能是不相等的。</li>\n</ul>\n<ul>\n<li>重复相乘以得到第一特征向量的方法叫做幂迭代（<a href=\"https://en.wikipedia.org/wiki/Power_iteration\">Power iteration</a>）。</li>\n</ul>\n<ul>\n<li>这个用特征向量表示的模型能不能对实际情况做超准确地描述呢？大概不能。我的脑海中浮现出了一句来自 George Box 的名言：“所有模型都有错，不过有些还是有用的”（<em>All models are wrong, some are useful</em>，意为没有模型能够完全准确地描述实际情况，但是可以用一些模型来解决问题。George Box 是英国著名的统计学家）。</li>\n</ul>\n<ul>\n<li>我也知道还有一些其他的约束条件需要一一考虑，但是实际情况基本都是这样的。</li>\n</ul>\n<ul>\n<li>代码可以在 <a href=\"https://github.com/erikbern/eigenstuff\">Github 上找到。</a></li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/acb658caeaa7401d5d7d20f28a1eab52.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110862\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110862votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110862\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">刘唱</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/5f17a18404975a50e3a341f2f8e27d59.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据挖掘研究生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/liuchang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/liuchang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 22</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://blog.csdn.net/github_36299736\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2577872237\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：learningDM\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "15fe5fa8b6340c7e3cb769be7f7d9e00", "title": "大白话讲解遗传算法", "url": "http://blog.jobbole.com/110913/", "create_date": "2017/04/17", "front_image_url": ["http://pic002.cnblogs.com/images/2011/63234/2011010315313516.png"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 4, "tags": "IT技术,算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/heaad/archive/2010/12/23/1914725.html\">苍梧</a>   </div><p>优化算法入门系列文章目录（更新中）：</p>\n<p>1. <a href=\"http://blog.jobbole.com/110916/\" target=\"_blank\">模拟退火算法</a></p>\n<p>2. <a href=\"http://blog.jobbole.com/110913/\" target=\"_blank\">遗传算法</a></p>\n<p>遗传算法 ( GA , Genetic Algorithm ) ，也称进化算法 。 遗传算法是受达尔文的进化论的启发，借鉴生物进化过程而提出的一种启发式搜索算法。因此在介绍遗传算法前有必要简单的介绍生物进化知识。</p>\n<h1>一.进化论知识</h1>\n<p>作为遗传算法生物背景的介绍，下面内容了解即可：</p>\n<p><strong>　　种群</strong><strong>(Population)</strong><strong>：</strong>生物的进化以群体的形式进行，这样的一个群体称为种群。</p>\n<p><strong>　　个体</strong>：组成种群的单个生物。</p>\n<p><strong>　　基因</strong><strong> ( Gene ) </strong><strong>：</strong>一个遗传因子。<strong> </strong></p>\n<p><strong>　　染色体</strong><strong> ( Chromosome )</strong> ：包含一组的基因。</p>\n<p><strong>　　生存竞争，适者生存</strong>：对环境适应度高的、牛B的个体参与繁殖的机会比较多，后代就会越来越多。适应度低的个体参与繁殖的机会比较少，后代就会越来越少。</p>\n<p><strong>　　遗传与变异</strong>：新个体会遗传父母双方各一部分的基因，同时有一定的概率发生基因变异。</p>\n<p>简单说来就是：繁殖过程，会发生基因交叉( Crossover ) ，基因突变 ( Mutation ) ，适应度( Fitness )低的个体会被逐步淘汰，而适应度高的个体会越来越多。那么经过N代的自然选择后，保存下来的个体都是适应度很高的，其中很可能包含史上产生的适应度最高的那个个体。</p>\n<h1>二.遗传算法思想</h1>\n<p>借鉴生物进化论，遗传算法将要解决的问题模拟成一个生物进化的过程，通过复制、交叉、突变等操作产生下一代的解，并逐步淘汰掉适应度函数值低的解，增加适应度函数值高的解。这样进化N代后就很有可能会进化出适应度函数值很高的个体。</p>\n<p>举个例子，使用遗传算法解决“0-1背包问题”的思路：0-1背包的解可以编码为一串0-1字符串（0：不取，1：取） ；首先，随机产生M个0-1字符串，然后评价这些0-1字符串作为0-1背包问题的解的优劣；然后，随机选择一些字符串通过交叉、突变等操作产生下一代的M个字符串，而且较优的解被选中的概率要比较高。这样经过G代的进化后就可能会产生出0-1背包问题的一个“近似最优解”。</p>\n<p><strong>　　编码</strong>：需要将问题的解编码成字符串的形式才能使用遗传算法。最简单的一种编码方式是二进制编码，即将问题的解编码成二进制位数组的形式。例如，问题的解是整数，那么可以将其编码成二进制位数组的形式。将0-1字符串作为0-1背包问题的解就属于二进制编码。</p>\n<p>遗传算法有3个最基本的操作：选择，交叉，变异。</p>\n<p><strong>　　选择</strong>：选择一些染色体来产生下一代。一种常用的选择策略是 <strong>“比例选择”</strong>，也就是个体被选中的概率与其适应度函数值成正比。假设群体的个体总数是M，那么那么一个体Xi被选中的概率为f(Xi)/( f(X1) + f(X2) + …….. + f(Xn) ) 。比例选择实现算法就是所谓的“轮盘赌算法”( Roulette Wheel Selection ) ，轮盘赌算法的一个简单的实现如下：</p>\n<div></div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d2358cc80850759903\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Objective-C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n轮盘赌算法\r\n/*\r\n* 按设定的概率，随机选中一个个体\r\n* P[i]表示第i个个体被选中的概率\r\n*/\r\nint RWS()\r\n{\r\nm =0;\r\nr =Random(0,1); //r为0至1的随机数\r\nfor(i=1;i&lt;=N; i++)\r\n{\r\n/* 产生的随机数在m~m+P[i]间则认为选中了i\r\n* 因此i被选中的概率是P[i]\r\n*/\r\nm = m + P[i];\r\nif(r&lt;=m) return i;\r\n}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc80850759903-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc80850759903-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc80850759903-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc80850759903-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc80850759903-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc80850759903-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc80850759903-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc80850759903-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc80850759903-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc80850759903-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc80850759903-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc80850759903-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc80850759903-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc80850759903-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc80850759903-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc80850759903-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc80850759903-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc80850759903-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d2358cc80850759903-1\">轮盘赌算法</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc80850759903-2\"><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc80850759903-3\"><span class=\"crayon-c\">* 按设定的概率，随机选中一个个体</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc80850759903-4\"><span class=\"crayon-c\">* P[i]表示第i个个体被选中的概率</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc80850759903-5\"><span class=\"crayon-c\">*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc80850759903-6\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">RWS</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc80850759903-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc80850759903-8\"><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc80850759903-9\"><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">Random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//r为0至1的随机数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc80850759903-10\"><span class=\"crayon-e\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc80850759903-11\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc80850759903-12\"><span class=\"crayon-c\">/* 产生的随机数在m~m+P[i]间则认为选中了i</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc80850759903-13\"><span class=\"crayon-c\">* 因此i被选中的概率是P[i]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc80850759903-14\"><span class=\"crayon-c\">*/</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc80850759903-15\"><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">P</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc80850759903-16\"><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc80850759903-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc80850759903-18\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p><strong>交叉</strong><strong>(Crossover)</strong>：2条染色体交换部分基因，来构造下一代的2条新的染色体。例如：</p>\n<p>交叉前：</p>\n<p>00000|<span style=\"color: #ff0000\">011100000000</span>|10000</p>\n<p>11100|<span style=\"color: #ff0000\">000001111110</span>|00101</p>\n<p>交叉后：</p>\n<p>00000|000001111110|10000</p>\n<p>11100|<span style=\"color: #ff0000\">011100000000</span>|00101</p>\n<p>染色体交叉是以一定的概率发生的，这个概率记为Pc 。</p>\n<p><strong>变异</strong><strong>(Mutation)</strong>：在繁殖过程，新产生的染色体中的基因会以一定的概率出错，称为变异。变异发生的概率记为Pm 。例如：</p>\n<p>变异前：</p>\n<p>000001110000<span style=\"color: #ff0000\">0</span>00010000</p>\n<p>变异后：</p>\n<p>000001110000<span style=\"color: #ff0000\">1</span>00010000</p>\n<p><strong>适应度函数</strong><strong> ( Fitness Function )</strong>：用于评价某个染色体的适应度，用f(x)表示。有时需要区分染色体的适应度函数与问题的目标函数。例如：0-1背包问题的目标函数是所取得物品价值，但将物品价值作为染色体的适应度函数可能并不一定适合。适应度函数与目标函数是正相关的，可对目标函数作一些变形来得到适应度函数。</p>\n<h1>三.基本遗传算法的伪代码</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d2358cc8d938780026\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Objective-C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n基本遗传算法伪代码\r\n/*\r\n* Pc：交叉发生的概率\r\n* Pm：变异发生的概率\r\n* M：种群规模\r\n* G：终止进化的代数\r\n* Tf：进化产生的任何一个个体的适应度函数超过Tf，则可以终止进化过程\r\n*/\r\n初始化Pm，Pc，M，G，Tf等参数。随机产生第一代种群Pop\r\n\r\ndo\r\n{ \r\n　　计算种群Pop中每一个体的适应度F(i)。\r\n　　初始化空种群newPop\r\n　　do\r\n　　{\r\n　　　　根据适应度以比例选择算法从种群Pop中选出2个个体\r\n　　　　if ( random ( 0 , 1 ) &lt; Pc )\r\n　　　　{\r\n　　　　　　对2个个体按交叉概率Pc执行交叉操作\r\n　　　　}\r\n　　　　if ( random ( 0 , 1 ) &lt; Pm )\r\n　　　　{\r\n　　　　　　对2个个体按变异概率Pm执行变异操作\r\n　　　　}\r\n将2个新个体加入种群newPop中\r\n} until ( M个子代被创建 )\r\n用newPop取代Pop\r\n}until ( 任何染色体得分超过Tf， 或繁殖代数超过G )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc8d938780026-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc8d938780026-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-1\">基本遗传算法伪代码</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-2\"><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-3\"><span class=\"crayon-c\">* Pc：交叉发生的概率</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-4\"><span class=\"crayon-c\">* Pm：变异发生的概率</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-5\"><span class=\"crayon-c\">* M：种群规模</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-6\"><span class=\"crayon-c\">* G：终止进化的代数</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-7\"><span class=\"crayon-c\">* Tf：进化产生的任何一个个体的适应度函数超过Tf，则可以终止进化过程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-8\"><span class=\"crayon-c\">*/</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-9\">初始化<span class=\"crayon-t\">Pm</span>，<span class=\"crayon-t\">Pc</span>，<span class=\"crayon-v\">M</span>，<span class=\"crayon-v\">G</span>，<span class=\"crayon-t\">Tf</span>等参数。随机产生第一代种群<span class=\"crayon-t\">Pop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-10\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-11\"><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-12\"><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-13\">　　计算种群<span class=\"crayon-t\">Pop</span>中每一个体的适应度<span class=\"crayon-e\">F</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span>。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-14\">　　初始化空种群<span class=\"crayon-v\">newPop</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-15\">　　<span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-16\">　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-17\">　　　　根据适应度以比例选择算法从种群<span class=\"crayon-t\">Pop</span>中选出<span class=\"crayon-cn\">2</span>个个体</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-18\">　　　　<span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">random</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Pc</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-19\">　　　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-20\">　　　　　　对<span class=\"crayon-cn\">2</span>个个体按交叉概率<span class=\"crayon-t\">Pc</span>执行交叉操作</div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-21\">　　　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-22\">　　　　<span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">random</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Pm</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-23\">　　　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-24\">　　　　　　对<span class=\"crayon-cn\">2</span>个个体按变异概率<span class=\"crayon-t\">Pm</span>执行变异操作</div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-25\">　　　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-26\">将<span class=\"crayon-cn\">2</span>个新个体加入种群<span class=\"crayon-v\">newPop</span>中</div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-27\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">until</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">M</span>个子代被创建<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc8d938780026-28\">用<span class=\"crayon-v\">newPop</span>取代<span class=\"crayon-t\">Pop</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc8d938780026-29\"><span class=\"crayon-sy\">}</span><span class=\"crayon-e\">until</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span>任何染色体得分超过<span class=\"crayon-t\">Tf</span>，<span class=\"crayon-h\"> </span>或繁殖代数超过<span class=\"crayon-v\">G</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p></p>\n<div></div>\n<h1>四.基本遗传算法优化</h1>\n<p>下面的方法可优化遗传算法的性能。</p>\n<p><strong>　　精英主义(Elitist Strategy)选择</strong>：是基本遗传算法的一种优化。为了防止进化过程中产生的最优解被交叉和变异所破坏，可以将每一代中的最优解原封不动的复制到下一代中。</p>\n<p><strong>　　插入操作</strong>：可在3个基本操作的基础上增加一个插入操作。插入操作将染色体中的某个随机的片段移位到另一个随机的位置。</p>\n<h1>五. 使用AForge.Genetic解决TSP问题</h1>\n<p>AForge.NET是一个C#实现的面向人工智能、计算机视觉等领域的开源架构。AForge.NET中包含有一个遗传算法的类库。</p>\n<p>AForge.NET主页：<a href=\"http://www.aforgenet.com/\">http://www.aforgenet.com/</a></p>\n<p>AForge.NET代码下载：<a href=\"http://code.google.com/p/aforge/\">http://code.google.com/p/aforge/</a></p>\n<p>介绍一下AForge的遗传算法用法吧。AForge.Genetic的类结构如下：<br>\n<img class=\"aligncenter\" src=\"http://pic002.cnblogs.com/images/2011/63234/2011010315313516.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图1. AForge.Genetic的类图</p>\n<p>   下面用AForge.Genetic写个解决TSP问题的最简单实例。测试数据集采用网上流传的中国31个省会城市的坐标:</p>\n<div>\n<blockquote>\n<div>13042312<br>\n36391315<br>\n41772244<br>\n37121399<br>\n34881535<br>\n33261556<br>\n32381229<br>\n41961004<br>\n4312790<br>\n4386570<br>\n30071970<br>\n25621756<br>\n27881491<br>\n23811676<br>\n1332695<br>\n37151678<br>\n39182179<br>\n40612370<br>\n37802212<br>\n36762578<br>\n40292838<br>\n42632931<br>\n34291908<br>\n35072367<br>\n33942643<br>\n34393201<br>\n29353240<br>\n31403550<br>\n25452357<br>\n27782826<br>\n23702975</div>\n</blockquote>\n</div>\n<p><strong>操作过程：</strong></p>\n<p>(1) 下载AForge.NET类库，网址：<a href=\"http://code.google.com/p/aforge/downloads/list\">http://code.google.com/p/aforge/downloads/list</a></p>\n<p>(2) 创建C#空项目GenticTSP。然后在AForge目录下找到AForge.dll和AForge.Genetic.dll，将其拷贝到TestTSP项目的bin/Debug目录下。再通过“Add Reference…”将这两个DLL添加到工程。</p>\n<p>(3) 将31个城市坐标数据保存为bin/Debug/Data.txt 。</p>\n<p>(4) 添加TSPFitnessFunction.cs，加入如下代码：</p>\n<div></div>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d2358cc95993082576\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Objective-C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nTSPFitnessFunction类\r\nusing System;\r\nusing AForge.Genetic;\r\n\r\nnamespace GenticTSP\r\n{\r\n///\r\n/// Fitness function for TSP task (Travaling Salasman Problem)\r\n///\r\npublicclass TSPFitnessFunction : IFitnessFunction\r\n{\r\n// map\r\nprivateint[,] map =null;\r\n\r\n// Constructor\r\npublic TSPFitnessFunction(int[,] map)\r\n{\r\nthis.map = map;\r\n}\r\n\r\n///\r\n/// Evaluate chromosome - calculates its fitness value\r\n///\r\npublicdouble Evaluate(IChromosome chromosome)\r\n{\r\nreturn1/ (PathLength(chromosome) +1);\r\n}\r\n\r\n///\r\n/// Translate genotype to phenotype \r\n///\r\npublicobject Translate(IChromosome chromosome)\r\n{\r\nreturn chromosome.ToString();\r\n}\r\n\r\n///\r\n/// Calculate path length represented by the specified chromosome \r\n///\r\npublicdouble PathLength(IChromosome chromosome)\r\n{\r\n// salesman path\r\nushort[] path = ((PermutationChromosome)chromosome).Value;\r\n\r\n// check path size\r\nif (path.Length != map.GetLength(0))\r\n{\r\nthrownew ArgumentException(\"Invalid path specified - not all cities are visited\");\r\n}\r\n\r\n// path length\r\nint prev = path[0];\r\nint curr = path[path.Length -1];\r\n\r\n// calculate distance between the last and the first city\r\ndouble dx = map[curr, 0] - map[prev, 0];\r\ndouble dy = map[curr, 1] - map[prev, 1];\r\ndouble pathLength = Math.Sqrt(dx * dx + dy * dy);\r\n\r\n// calculate the path length from the first city to the last\r\nfor (int i =1, n = path.Length; i &lt; n; i++)\r\n{\r\n// get current city\r\ncurr = path[i];\r\n\r\n// calculate distance\r\ndx = map[curr, 0] - map[prev, 0];\r\ndy = map[curr, 1] - map[prev, 1];\r\npathLength += Math.Sqrt(dx * dx + dy * dy);\r\n\r\n// put current city as previous\r\nprev = curr;\r\n}\r\n\r\nreturn pathLength;\r\n}\r\n}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc95993082576-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc95993082576-78\">78</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-1\"><span class=\"crayon-t\">TSPFitnessFunction</span>类</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-2\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">System</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-3\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">AForge</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Genetic</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-4\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-5\"><span class=\"crayon-e\">namespace </span><span class=\"crayon-t\">GenticTSP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-6\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-7\"><span class=\"crayon-c\">///</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-8\"><span class=\"crayon-c\">/// Fitness function for TSP task (Travaling Salasman Problem)</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-9\"><span class=\"crayon-c\">///</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-10\"><span class=\"crayon-v\">publicclass</span><span class=\"crayon-e \"> TSPFitnessFunction </span><span class=\"crayon-v\">: IFitnessFunction</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-11\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-12\"><span class=\"crayon-c\">// map</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-13\"><span class=\"crayon-v\">privateint</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">]</span><span class=\"crayon-e \"> map</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-14\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-15\"><span class=\"crayon-c\">// Constructor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-16\"><span class=\"crayon-e\">public </span><span class=\"crayon-t\">TSPFitnessFunction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">]</span><span class=\"crayon-e \"> map</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-17\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-18\"><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">map</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-19\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-20\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-21\"><span class=\"crayon-c\">///</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-22\"><span class=\"crayon-c\">/// Evaluate chromosome - calculates its fitness value</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-23\"><span class=\"crayon-c\">///</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-24\"><span class=\"crayon-e\">publicdouble </span><span class=\"crayon-t\">Evaluate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">IChromosome</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chromosome</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-25\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-26\"><span class=\"crayon-v\">return1</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">PathLength</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">chromosome</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-27\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-28\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-29\"><span class=\"crayon-c\">///</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-30\"><span class=\"crayon-c\">/// Translate genotype to phenotype </span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-31\"><span class=\"crayon-c\">///</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-32\"><span class=\"crayon-e\">publicobject </span><span class=\"crayon-t\">Translate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">IChromosome</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chromosome</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-33\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-34\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chromosome</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">ToString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-35\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-36\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-37\"><span class=\"crayon-c\">///</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-38\"><span class=\"crayon-c\">/// Calculate path length represented by the specified chromosome </span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-39\"><span class=\"crayon-c\">///</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-40\"><span class=\"crayon-e\">publicdouble </span><span class=\"crayon-t\">PathLength</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">IChromosome</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chromosome</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-41\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-42\"><span class=\"crayon-c\">// salesman path</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-43\"><span class=\"crayon-v\">ushort</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-e \"> path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">PermutationChromosome</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">chromosome</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Value</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-44\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-45\"><span class=\"crayon-c\">// check path size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-46\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">GetLength</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-47\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-48\"><span class=\"crayon-e\">thrownew </span><span class=\"crayon-t\">ArgumentException</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Invalid path specified - not all cities are visited\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-49\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-50\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-51\"><span class=\"crayon-c\">// path length</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-52\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prev</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-53\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-54\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-55\"><span class=\"crayon-c\">// calculate distance between the last and the first city</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-56\"><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">curr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">prev</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-57\"><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">curr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">prev</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-58\"><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pathLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Sqrt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t \">dx </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-t \">dy </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-59\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-60\"><span class=\"crayon-c\">// calculate the path length from the first city to the last</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-61\"><span class=\"crayon-e\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Length</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-62\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-63\"><span class=\"crayon-c\">// get current city</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-64\"><span class=\"crayon-v\">curr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-65\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-66\"><span class=\"crayon-c\">// calculate distance</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-67\"><span class=\"crayon-v\">dx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">curr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">prev</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-68\"><span class=\"crayon-v\">dy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">curr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">prev</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-69\"><span class=\"crayon-v\">pathLength</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Sqrt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t \">dx </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-t \">dy </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-70\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-71\"><span class=\"crayon-c\">// put current city as previous</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-72\"><span class=\"crayon-v\">prev</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curr</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-73\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-74\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-75\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pathLength</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-76\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc95993082576-77\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc95993082576-78\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0076 seconds] -->\r\n\n</div>\n<p>(5) 添加GenticTSP.cs，加入如下代码：</p>\n<div></div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d2358cc9b700808423\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Objective-C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGenticTSP类\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing System.Text;\r\nusing System.IO;\r\n\r\nusing AForge;\r\nusing AForge.Genetic;\r\n\r\n\r\nnamespace GenticTSP\r\n{\r\nclass GenticTSP\r\n{\r\n\r\nstaticvoid Main()\r\n{\r\nStreamReader reader =new StreamReader(\"Data.txt\");\r\n\r\nint citiesCount =31; //城市数\r\n\r\nint[,] map =newint[citiesCount, 2];\r\n\r\nfor (int i =0; i &lt; citiesCount; i++)\r\n{\r\nstring value = reader.ReadLine();\r\nstring[] temp = value.Split('');\r\nmap[i, 0] =int.Parse(temp[0]); //读取城市坐标\r\nmap[i, 1] =int.Parse(temp[1]);\r\n}\r\n\r\n// create fitness function\r\nTSPFitnessFunction fitnessFunction =new TSPFitnessFunction(map);\r\n\r\nint populationSize = 1000; //种群最大规模\r\n\r\n/* \r\n* 0：EliteSelection算法 \r\n* 1：RankSelection算法 \r\n* 其他：RouletteWheelSelection 算法\r\n* */\r\nint selectionMethod =0;\r\n\r\n// create population\r\nPopulation population =new Population(populationSize,\r\nnew PermutationChromosome(citiesCount),\r\nfitnessFunction,\r\n(selectionMethod ==0) ? (ISelectionMethod)new EliteSelection() :\r\n(selectionMethod ==1) ? (ISelectionMethod)new RankSelection() :\r\n(ISelectionMethod)new RouletteWheelSelection()\r\n);\r\n\r\n// iterations\r\nint iter =1;\r\nint iterations =5000; //迭代最大周期\r\n\r\n// loop\r\nwhile (iter &lt; iterations)\r\n{\r\n// run one epoch of genetic algorithm\r\npopulation.RunEpoch();\r\n\r\n// increase current iteration\r\niter++;\r\n}\r\n\r\nSystem.Console.WriteLine(\"遍历路径是： {0}\", ((PermutationChromosome)population.BestChromosome).ToString());\r\nSystem.Console.WriteLine(\"总路程是：{0}\", fitnessFunction.PathLength(population.BestChromosome));\r\nSystem.Console.Read();\r\n\r\n}\r\n}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-58f7d2358cc9b700808423-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d2358cc9b700808423-74\">74</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-1\"><span class=\"crayon-t\">GenticTSP</span>类</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-2\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">System</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-3\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Collections</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Generic</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-4\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Linq</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-5\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Text</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-6\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">IO</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-8\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">AForge</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-9\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">AForge</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Genetic</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-10\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-12\"><span class=\"crayon-e\">namespace </span><span class=\"crayon-t\">GenticTSP</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-13\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-14\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">GenticTSP</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-15\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-16\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-17\"><span class=\"crayon-e\">staticvoid </span><span class=\"crayon-t\">Main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-19\"><span class=\"crayon-t\">StreamReader</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reader</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">new </span><span class=\"crayon-t\">StreamReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Data.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-20\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-21\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">citiesCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">31</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//城市数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-22\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-23\"><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">]</span><span class=\"crayon-e \"> map</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">newint</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">citiesCount</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-24\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-25\"><span class=\"crayon-e\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">citiesCount</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-26\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-27\"><span class=\"crayon-e\">string </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reader</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">ReadLine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-28\"><span class=\"crayon-v\">string</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-e \"> temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-29\"><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//读取城市坐标</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-30\"><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-31\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-32\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-33\"><span class=\"crayon-c\">// create fitness function</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-34\"><span class=\"crayon-t\">TSPFitnessFunction</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fitnessFunction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">new </span><span class=\"crayon-t\">TSPFitnessFunction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-36\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">populationSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//种群最大规模</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-38\"><span class=\"crayon-c\">/* </span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-39\"><span class=\"crayon-c\">* 0：EliteSelection算法 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-40\"><span class=\"crayon-c\">* 1：RankSelection算法 </span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-41\"><span class=\"crayon-c\">* 其他：RouletteWheelSelection 算法</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-42\"><span class=\"crayon-c\">* */</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-43\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectionMethod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-44\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-45\"><span class=\"crayon-c\">// create population</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-46\"><span class=\"crayon-t\">Population</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">new </span><span class=\"crayon-t\">Population</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">populationSize</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-47\"><span class=\"crayon-e\">new </span><span class=\"crayon-t\">PermutationChromosome</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">citiesCount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-48\"><span class=\"crayon-v\">fitnessFunction</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-49\"><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">selectionMethod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">ISelectionMethod</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">new </span><span class=\"crayon-t\">EliteSelection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-50\"><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">selectionMethod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">ISelectionMethod</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">new </span><span class=\"crayon-t\">RankSelection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-51\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">ISelectionMethod</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">new </span><span class=\"crayon-t\">RouletteWheelSelection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-52\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-53\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-54\"><span class=\"crayon-c\">// iterations</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-55\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-56\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//迭代最大周期</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-57\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-58\"><span class=\"crayon-c\">// loop</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-59\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-60\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-61\"><span class=\"crayon-c\">// run one epoch of genetic algorithm</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-62\"><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">RunEpoch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-64\"><span class=\"crayon-c\">// increase current iteration</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-65\"><span class=\"crayon-v\">iter</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-66\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-68\"><span class=\"crayon-t\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">WriteLine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"遍历路径是： {0}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">PermutationChromosome</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">BestChromosome</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">ToString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-69\"><span class=\"crayon-t\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">WriteLine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"总路程是：{0}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fitnessFunction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">PathLength</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">BestChromosome</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-70\"><span class=\"crayon-t\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-71\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-72\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f7d2358cc9b700808423-73\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d2358cc9b700808423-74\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0073 seconds] -->\r\n<p>网上据称这组TSP数据的最好的结果是 15404 ，上面的程序我刚才试了几次最好一次算出了15402.341，但是最差的时候也跑出了大于16000的结果。</p>\n<p>我这还有一个版本，设置种群规模为1000，迭代5000次可以算出15408.508这个结果。源代码在文章最后可以下载。</p>\n<p>总结一下使用AForge.Genetic解决问题的一般步骤：</p>\n<p>(1) 定义适应函数类，需要实现IFitnessFunction接口</p>\n<p>(2) 选定种群规模、使用的选择算法、染色体种类等参数，创建种群population</p>\n<p>(3)设定迭代的最大次数，使用RunEpoch开始计算</p>\n<p><a href=\"http://files.cnblogs.com/heaad/GenticTSPcode.rar\" target=\"_blank\">本文源代码下载</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110913\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110913votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110913\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "19962a739ccee45ad2024c1c48848d15", "title": "大白话解析模拟退火算法", "url": "http://blog.jobbole.com/110916/", "create_date": "2017/04/17", "front_image_url": ["http://pic002.cnblogs.com/images/2010/63234/2010122016525713.png"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 3, "tags": "IT技术,算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/heaad/archive/2010/12/20/1911614.html\">苍梧</a>   </div><p>优化算法入门系列文章目录（更新中）：</p>\n<p>1. <a href=\"http://blog.jobbole.com/110916/\" target=\"_blank\">模拟退火算法</a></p>\n<p>2. <a href=\"http://blog.jobbole.com/110913/\" target=\"_blank\">遗传算法</a></p>\n<p><strong>一. 爬山算法 ( Hill Climbing )</strong></p>\n<p>介绍模拟退火前，先介绍爬山算法。爬山算法是一种简单的贪心搜索算法，该算法每次从当前解的临近解空间中选择一个最优解作为当前解，直到达到一个局部最优解。</p>\n<p>爬山算法实现很简单，其主要缺点是会陷入局部最优解，而不一定能搜索到全局最优解。如图1所示：假设C点为当前解，爬山算法搜索到A点这个局部最优解就会停止搜索，因为在A点无论向那个方向小幅度移动都不能得到更优的解。</p>\n<p><img class=\"aligncenter\" src=\"http://pic002.cnblogs.com/images/2010/63234/2010122016525713.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图1</p>\n<p><strong>二. 模拟退火(SA,Simulated Annealing)思想</strong></p>\n<p>爬山法是完完全全的贪心法，每次都鼠目寸光的选择一个当前最优解，因此只能搜索到局部的最优值。模拟退火其实也是一种贪心算法，但是它的搜索过程引入了随机因素。模拟退火算法<strong>以一定的概率</strong>来接受一个比当前解要差的解，因此<strong>有可能</strong>会跳出这个局部的最优解，达到全局的最优解。以图1为例，模拟退火算法在搜索到局部最优解A后，会<strong>以一定的概率</strong>接受到E的移动。也许经过几次这样的不是局部最优的移动后会到达D点，于是就跳出了局部最大值A。</p>\n<p>模拟退火算法描述：</p>\n<p>若J( Y(i+1) )&gt;= J( Y(i) )  (即移动后得到更优解)，则总是接受该移动</p>\n<p>若J( Y(i+1) )&lt; J( Y(i) )  (即移动后的解比当前解要差)，则<strong>以一定的概率接受移动，而且这个概率随着时间推移逐渐降低（逐渐降低才能趋向稳定）</strong></p>\n<p>这里的“一定的概率”的计算参考了金属冶炼的退火过程，这也是模拟退火算法名称的由来。</p>\n<p>根据热力学的原理，在温度为T时，出现能量差为dE的降温的概率为P(dE)，表示为：</p>\n<p><strong>　　　　P(dE) = exp( dE/(kT) )</strong></p>\n<p>其中k是一个常数，exp表示自然指数，且dE&lt;0。这条公式说白了就是：温度越高，出现一次能量差为dE的降温的概率就越大；温度越低，则出现降温的概率就越小。又由于dE总是小于0（否则就不叫退火了），因此dE/kT &lt; 0 ，所以P(dE)的函数取值范围是(0,1) 。</p>\n<p>随着温度T的降低，P(dE)会逐渐降低。</p>\n<p>我们将一次向较差解的移动看做一次温度跳变过程，我们以概率P(dE)来接受这样的移动。</p>\n<p>关于爬山算法与模拟退火，有一个有趣的比喻：</p>\n<p>爬山算法：兔子朝着比现在高的地方跳去。它找到了不远处的最高山峰。但是这座山不一定是珠穆朗玛峰。这就是爬山算法，它不能保证局部最优值就是全局最优值。</p>\n<p>模拟退火：兔子喝醉了。它随机地跳了很长时间。这期间，它可能走向高处，也可能踏入平地。但是，它渐渐清醒了并朝最高方向跳去。这就是模拟退火。</p>\n<p> </p>\n<p>下面给出模拟退火的伪代码表示。</p>\n<p><strong> </strong></p>\n<p><strong>三. 模拟退火算法伪代码</strong></p>\n<div></div>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f85452a75b7025334968\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Objective-C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n代码\r\n/*\r\n* J(y)：在状态y时的评价函数值\r\n* Y(i)：表示当前状态\r\n* Y(i+1)：表示新的状态\r\n* r： 用于控制降温的快慢\r\n* T： 系统的温度，系统初始应该要处于一个高温的状态\r\n* T_min ：温度的下限，若温度T达到T_min，则停止搜索\r\n*/\r\nwhile( T &gt; T_min )\r\n{\r\n　　dE = J( Y(i+1) ) - J( Y(i) ) ; \r\n\r\n　　if ( dE &gt;=0 ) //表达移动后得到更优解，则总是接受移动\r\nY(i+1) = Y(i) ; //接受从Y(i)到Y(i+1)的移动\r\n　　else\r\n　　{\r\n// 函数exp( dE/T )的取值范围是(0,1) ，dE/T越大，则exp( dE/T )也\r\nif ( exp( dE/T ) &gt; random( 0 , 1 ) )\r\nY(i+1) = Y(i) ; //接受从Y(i)到Y(i+1)的移动\r\n　　}\r\n　　T = r * T ; //降温退火 ，0&lt;r\r\n　　/*\r\n　　* 若r过大，则搜索到全局最优解的可能会较高，但搜索的过程也就较长。若r过小，则搜索的过程会很快，但最终可能会达到一个局部最优值\r\n　　*/\r\n　　i ++ ;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f85452a75b7025334968-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-58f85452a75b7025334968-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-1\">代码</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-2\"><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-3\"><span class=\"crayon-c\">* J(y)：在状态y时的评价函数值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-4\"><span class=\"crayon-c\">* Y(i)：表示当前状态</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-5\"><span class=\"crayon-c\">* Y(i+1)：表示新的状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-6\"><span class=\"crayon-c\">* r： 用于控制降温的快慢</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-7\"><span class=\"crayon-c\">* T： 系统的温度，系统初始应该要处于一个高温的状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-8\"><span class=\"crayon-c\">* T_min ：温度的下限，若温度T达到T_min，则停止搜索</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-9\"><span class=\"crayon-c\">*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-10\"><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">T_min</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-11\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-12\">　　<span class=\"crayon-v\">dE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">J</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Y</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">J</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Y</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-14\">　　<span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//表达移动后得到更优解，则总是接受移动</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-15\"><span class=\"crayon-e\">Y</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Y</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//接受从Y(i)到Y(i+1)的移动</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-16\">　　<span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-17\">　　<span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-18\"><span class=\"crayon-c\">// 函数exp( dE/T )的取值范围是(0,1) ，dE/T越大，则exp( dE/T )也</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-19\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">exp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dE</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-20\"><span class=\"crayon-e\">Y</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Y</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//接受从Y(i)到Y(i+1)的移动</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-21\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-22\">　　<span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t \">r </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//降温退火 ，0&lt;r</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-23\">　　<span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-24\"><span class=\"crayon-c\">　　* 若r过大，则搜索到全局最优解的可能会较高，但搜索的过程也就较长。若r过小，则搜索的过程会很快，但最终可能会达到一个局部最优值</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-25\"><span class=\"crayon-c\">　　*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f85452a75b7025334968-26\">　　<span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f85452a75b7025334968-27\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n\n</div>\n<p><strong>四. 使用模拟退火算法解决旅行商问题</strong></p>\n<p>旅行商问题 ( TSP , Traveling Salesman Problem ) ：有N个城市，要求从其中某个问题出发，唯一遍历所有城市，再回到出发的城市，求最短的路线。</p>\n<p>旅行商问题属于所谓的NP完全问题，精确的解决TSP只能通过穷举所有的路径组合，其时间复杂度是O(N!) 。</p>\n<p>使用模拟退火算法可以比较快的求出TSP的一条近似最优路径。（使用遗传算法也是可以的，我将在下一篇文章中介绍）模拟退火解决TSP的思路：</p>\n<p>1. 产生一条新的遍历路径P(i+1)，计算路径P(i+1)的长度L( P(i+1) )</p>\n<p>2. 若L(P(i+1)) &lt; L(P(i))，则接受P(i+1)为新的路径，否则以模拟退火的那个概率接受P(i+1) ，然后降温</p>\n<p>3. 重复步骤1，2直到满足退出条件</p>\n<p>产生新的遍历路径的方法有很多，下面列举其中3种：</p>\n<p>1. 随机选择2个节点，交换路径中的这2个节点的顺序。</p>\n<p>2. 随机选择2个节点，将路径中这2个节点间的节点顺序逆转。</p>\n<p>3. 随机选择3个节点m，n，k，然后将节点m与n间的节点移位到节点k后面。</p>\n<p><strong>五. 算法评价</strong></p>\n<p>模拟退火算法是一种随机算法，并不一定能找到全局的最优解，可以比较快的找到问题的近似最优解。 如果参数设置得当，模拟退火算法搜索效率比穷举法要高。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110916\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110916votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110916\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "fe411234979f02ce0b3d6ae6aa05860a", "title": "初级开发者面试中的不合理问题", "url": "http://blog.jobbole.com/110906/", "create_date": "2017/04/17", "front_image_url": ["http://wx3.sinaimg.cn/mw690/63918611gy1feprfrtjw7j20je0b4h0w.jpg"], "praise_nums": 2, "comment_nums": 0, "fav_nums": 1, "tags": "开发,技术面试", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2032047197\">Ivyw</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.com/@samphippen/on-the-unreasonable-reality-of-junior-developer-interviews-946498c0ad57\">samphippen</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>我有很多初出茅庐做开发的朋友，其中一位给我讲了他在应聘 Ruby 初级开发工程师时的事。下面就说说我和我的一个朋友是如何解决这个面试题的，两个高级工程师来解决这个初级工程师的面试题，显得有点大材小用，但结果令人出乎意外。在这个领域我还是有点见解的，我会详细描述一下我的解题思路。</p>\n<h3>面试题</h3>\n<p>那个面试的朋友需要在 30 分钟内用 Java 实现一个链表，他的第一反应是小菜一碟，我也一样。即使是对没有 CS 学位的人来说，链表也是一种很通俗易懂的数据结构。</p>\n<p>链表是含有一串节点的链表，每个节点带有一个指向下一个节点的指针，这样你就大概能清楚它的工作过程了：插入节点时前后节点的信息和引用前后关系的指针都会发生改变；删除节点时移除这个节点和它的指针即可；查找节点时按顺序查看指针信息直到找到你需要的那个节点。如果你大学是 CS 专业的，那么这可能是你最初接触到的非嵌入式数据结构。链表的用处很大，C 语言的标准库为接下来的编程工作提供了必要的支持。</p>\n<p>对初级开发人员来说这是一个很好的面试题。这个试题涉及了算法技巧，但没有 CS 专业学的那么深奥。其次，这也是非常<strong>切合实际</strong>的编程测试，因为工作后你肯定要写代码、调试、输出并运行代码。你不会被点名去白板上写点什么来展现自己的能力，<strong>这不是白板编程。</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1feprfrtjw7j20je0b4h0w.jpg\" width=\"521\" height=\"298\"></p>\n<p>我很好奇，为什么那个朋友对这样的面试感到困扰，随后他说出了这道题目的附加条件：面试官希望这个链表能符合 List &lt;T&gt; 的特性。我立马被这道题的复杂性吓到了，完全不像一开始的毫不在意。</p>\n<h3>救命</h3>\n<p>可能有人对 Java 标准库接口了解不多，所以让我来普及一下 List &lt;T&gt;。List &lt;T&gt; 是 Java 的泛型接口，可以用来实现包含很多相同数值的有序集合。这是一个<a href=\"https://docs.oracle.com/javase/7/docs/api/java/util/List.html\">功能强大</a>的接口，提供我们可能会用到所有的定位列表数据类型。它有 25 个公共方法，其中两个方法返回另外的接口含有12 个公共方法，也就是说，你在实现过程中需要构建和测试 37 个公共方法。其中 t 意味着这是一个泛型接口，<strong>数据类型没有限制</strong>。这简直太荒谬了，而我的朋友仅有 30 分钟的时间来解答。</p>\n<p>那么，这个问题是否适合那些经验不足两年的新人呢？当然不适合，而且相当不合理，我就“严肃认真地分析下”（我可以好好施展一番了，我对自己还是很有信心的）。我可以很轻易地完成这项任务，毕竟我是一个“资深”的开发人员，我这半辈子都在和 Java 编程打交道，虽然对工具有些生疏，但领悟很强。只是我不值得为这个任务花费太长时间。</p>\n<p>然而这还不够，我们还要精益求精。Pair programming （结对编程）是我最喜欢的一种工作方式，可以协助我们更快地完成工作。你需要向同伴解释自己的思路，当你累了还可以得到同伴的帮助。所以，我找到 Stephen Best 来一起解决这个问题。前20分钟我们没有安装工具，而是做出问题草图、搭建测试环境等等。我们假装是在面试环境中解决这个问题。</p>\n<p>很快我们就开始了。Stephen 曾和我一起工作了6个月，其中有三分之一的时间都是这种模式。我们使用 TDD 工作流程协同工作。</p>\n<p>首先我们用 Eclipse 自动生成完整的界面框架，然后准备开始实施了。不幸的是，我们没有意识到这个任务的艰巨程度。</p>\n<p>这个过程的艰难险阻，简直难以形容。List &lt;T&gt; 接口有个好处，你可以在一些方法之上实现另外一些方法，但 List &lt;T&gt; 接口的复杂度太高。大约 6 小时后，我们放弃了，我们失败了。我们非但没能在 30 分钟内完成实施，<strong>我们根本没法解决这个问题。</strong></p>\n<p>我们使用了 listIterator() 方法，它必须返回一个 ListIterator &lt;T&gt; 对象并声明注销时间，但是当你几乎快要完成一个复杂接口时，不知道又从哪冒出另外一个。</p>\n<p>我们所有的基本操作都已完成，并具有良好的测试覆盖率。我可以指出实现 List &lt;T&gt; 所必须的但 Java 类型系统无法支持的部分，这些部分留给实施者去实现就好。我们没有做范围检查的接入，当你查询任意位置的元素时会报空指针异常，而不是提示范围错误。我们跳过这部分是因为这不是必要的而且我们时间有限。</p>\n<p>我想象不出那些初级开发人员在遇到这样的问题时脑袋里会想什么。这是一个 <strong>Ruby </strong>的开发岗位，我搞不懂为什么让一个新人去实现如此复杂的接口。当然，很多面向对象的想法可以从 Java 移植到 Ruby，也许这才是面试的侧重点。我和 Stephen 能够承担这项任务的唯一原因是我很熟悉如何构建 Java 通用系统。当你写出如下代码时：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f848cd259a8792336377\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprivate &lt;A&gt; A reduceNodes(A accumulator, NodeCallback&lt;A, T&gt; callback) {</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f848cd259a8792336377-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f848cd259a8792336377-1\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">A</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reduceNodes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">accumulator</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NodeCallback</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">callback</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>其中涉及一个类类型参数、一个方法类型参数和一个匿名回调接口，好像并没有用到 Java 语言。这个命令可以让后面的实现更简单直接，在面试中这样做的话，我很确定面试官一定会很困惑。如果 Stephen 和我这样解答的话，可能无法通过这次面试，这是个危险信号。</p>\n<p>继续上面的话题，这究竟说明了什么。这是一个压力面试，面试官给出一个问题，而很显然求职者无法在规定的时间内解决。<strong>再次重申一下，我很肯定没人能在 30 分钟内实现 List &lt;T&gt; 链表。</strong>这很不公平，那些擅长某种思维的人才会被过滤掉，因为平常很少有程序员会遇到这样的测试。更糟的是，这会打击很多人的信心。下一节中，我们将探讨一下这样给初级开发人员带来的影响。</p>\n<h3>常春藤 CS Shibboleth</h3>\n<p>如果一个面试题无法筛选出合适的应聘者，那它还有什么意义，难道是要看应聘者面对无法解答的问题时的反应么？与其这样，还不如选一些合适的面试题，可以让面试官判断出应聘者是否成功解决了问题。</p>\n<p>人类很奇怪，喜欢建立部落群居生活。部落是史前最接近现代社会（在地理意义上）的人类群体。这意味着他们是很接近我们的人，我们都喜欢进行筛选。给面试官主观决定的权利意味着他们会选择最接近他们的人。这就是为什么很多公司用白板编程的方式筛选应聘者，那些从名校毕业有 CS 学位的求职者在白板面试环节表现出色，这应该是好学历的特权吧。</p>\n<p>有个问题不得不提。在过去几年中，非 CS 专业（考虑到我们这个行业兴起的年头，称之为非传统似乎有点可笑）的技术人员大幅增加。这些初级程序员大部分来自训练营。训练营不会教你如何构建红黑树或如何用 C 语言实现哈希表，他们没必要教这些，因为很少有学员毕业后会用到这些。<strong>这并不稀奇，因为当我开发 Rails 应用时，我的 CS 学位根本没有任何帮助。</strong></p>\n<p>白板编程面试在大多数情况下是很令人苦恼的事。我自己也经历过很多次，而且从来没收到过回信。我是一个拥有 CS 硕士学位的顺性男，所以，至少在这件事上「选择像我们这样的人」的准则似乎没有奏效。我认为白板编程面试与大多数人的实际工作内容是相背离的。</p>\n<p>我发现一些问题，因为人们认为从事这个行业要有 CS 学历才可以，所以很多初级技术岗位并没有考虑训练营的学员。这样做有害无益，特别是在行业多样性方面。据我观察，训练营的学员比拥有 CS 学历的人涵盖更广泛的社会阶层，而且训练营的费用肯定比美国的「常春藤联盟」大学少得多，当然还有英国类似的大学（抱歉，英格兰中心论的读者）。合理的学费也有助于实现（但不完全）民主化和权利平等。</p>\n<p>我听说很多训练营都有专门的课程，教初级开发者用死记硬背的方式学习白板编程，用他们不理解的数据结构来操作指针、构建 rails 应用程序等等。如果没有这些课程，在面试时 CS 专业的人就会更吃香。我也面试过很多训练营的学员，跟 CS 专业的毕业生比起来，我更倾向于雇佣前者。</p>\n<p>因为，训练营的学员：</p>\n<ul>\n<li>They’re a thing （他们有能力）</li>\n<li>他们确实很优秀。</li>\n<li>如果你想招一个初级 Ruby 开发，找训练营毕业的是不错的选择。</li>\n</ul>\n<p>面试除了要找到合适的人，你也应该为应聘者留下一个良好印象。如果你给他们出一些不可能完成的白板问题或编程任务，可能直到面试结束后他们都会感觉很糟糕。如果他们接受这份工作，面试时的压力也会一直伴随他们，这样的雇员雇主关系可不是一个好的开头。</p>\n<h3>资深开发者的面试趣事</h3>\n<p>我想讲一些关于「资深」开发人员的面试，有我自己的经历，也有别人的。据我观察，这个级别的招聘基本没有白板编程环节了，甚至（但并不总是）完全不用写代码了。这些面试过程大多是以双方进行某种技术讨论的方式进行。我发现，有时应聘者可能比面试官更老练。因此，面试官很愿意倾听应聘者的想法，并礼貌地询问处理某个问题的方法。</p>\n<p>对我来说这种形式的面试好得多，白板编程对我来说就是地狱。因为我并不擅长，<strong>如果一个面试是以白板编程的方式来进行筛选，那我肯定没法通过。</strong>我的好友 Justin Searls 也有同样的顾虑。尽管这样，大多数与我合作过的开发人员都认为我是很有效率的。如果某些技术牛人因为无法解答你给出的问题而面试失败的话，你就需要反思一下是不是面试方式出了问题。</p>\n<p>我们可以采用技术讨论的方式展开面试。求职者会感觉很轻松，他可以表达自己的观点，还有机会纠正前面犯的错误，倾听面试官并给出回应，这个过程可以加深双方的了解。沟通是程序员需要学习的最重要的事情。<strong>计算机出现的所有问题，归根到底都是人的问题。</strong>这样的面试方式才会让求职者感觉很舒服。</p>\n<p>求职者表达自己的见解，面试官倾听并给予回应。这个过程可以检测出双方是否适合在一起工作，双方是否会在自己犯错时让步，与此同时展示一下平常的工作状态。</p>\n<p>最重要的技术工作都是在良好的沟通下完成的，因此，我们应该围绕这个模型规划面试过程。</p>\n<h3>结论：更好的初级开发者面试过程</h3>\n<p>我有个朋友最近参加了一轮初级开发人员面试，并且在疯狂地学习 CS101 课程，的确很有效果。但我认为不应该这样。两年多来，很多像我朋友一样的人编写出了面向成千上万个用户的生产代码。他们不应该被强迫去「学习」后才能获得一个与他们现有水平相匹配的工作。他们应该自由地谈论日常生活、喜欢的事和讨厌的事。他们应该讨论正在学习的东西、团队中的同伴，以及他们喜欢什么样的工作环境。</p>\n<p>计算机科学是迷人且趣味无穷的，技术人应该都能感受到。大多数人在日常工作中并不会用到太多他们在学校学的知识。不过没关系，这提醒我们在面试时不要刷掉那些获得 CS 学位的人。</p>\n<p>不要用招聘来折磨初级开发者，强迫他们做一些高深的编程，就像逼一个高中生去学习《麦田的守望者》或《红字》长篇小说那样。我们可以从程序员的角度和他们进行交谈，考察他们是否愿意学习、善于沟通，以及是否适合团队合作。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/cd71c2051e50f3854be1295836e603d5.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110906\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110906votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110906\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2032047197\">Ivyw</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2032047197\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/c7a311df16c331ef6562f816118dc031.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            (*^__^*)        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2032047197\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2032047197/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2032047197/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 27</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "00845c61ff2446b059420ec791c96567", "title": "技术的成长曲线", "url": "http://blog.jobbole.com/110142/", "create_date": "2017/04/10", "front_image_url": ["http://wx3.sinaimg.cn/large/63918611gy1fehgkjjrixj20tq0j875c.jpg"], "praise_nums": 4, "comment_nums": 4, "fav_nums": 14, "tags": "职场,程序员,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://zhangtielei.com/posts/blog-growth-curve.html\">张铁蕾</a>   </div><p>小李毕业后在一家公司做软件工程师，转眼间一年多的时间已经过去了。</p>\n<p>回想刚毕业那会，他是怀着无比忐忑的心情进入了这家公司的技术部门。各种新奇的开发工具，叫不上名字的众多软件框架，庞大的代码库，井然有序的工作流程，都是小李以前在学校里不曾遇到过的，这让他感到了前所未有的压力。于是，在开始的那半年，小李就像一株久旱的禾苗遇到了雨水，拼命地吸收着工作中遇到的每一点知识。他学习新的编程语言，学习新的开发工具，学习调试和解bug的技巧，也学习处理各种棘手的业务逻辑。虽然每天工作很累，但每天都是满满的收获。</p>\n<p>而现如今，小李俨然是一名很有经验的老手了。对于工作中一般的问题，他都能游刃有余地加以解决，无非是把现有的一些内部接口重新组合利用，或者按照原有的套路重新设计改进一番。应付工作既然比以前轻松了许多，工作的压力也就显得没有那么大了。于是小李平常也能抽出时间来上上网，看看美剧，或者打打游戏，有时候也带着女友去看场电影或者球赛。</p>\n<p>然而时间长了，小李心里却隐隐多了一丝不安。他再也找不到开始那种突飞猛进的爽快了，而且当对工作越来越熟悉之后，工作本身开始变得枯燥、没意思。他决定花更多精力在自己的技术提高上，但却感觉无从下手，很难突破。每次完成一个新的开发需求，也只是不断重复旧有的东西而已。</p>\n<h2 id=\"成长曲线和四大阶段\">成长曲线和四大阶段</h2>\n<p>小李的情况其实非常典型。很多技术人员在工作一两年之后，对工作周围的事情都驾轻就熟了，就可能会陷入第一个瓶颈期，再难突破。</p>\n<p>为了能更清晰地分析技术成长过程中出现的各种情况，我们来对技术的成长曲线做一个总结。如下图：</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/63918611gy1fehgkjjrixj20tq0j875c.jpg\"></p>\n<p>技术的成长过程并非匀速线性的，而是分阶段的。每个高速增长的突破期后面，都跟着一个平缓的增长期，可以称为舒适期，也可以称为瓶颈期。舒适期是针对过去而言的，而瓶颈期的说法则更着眼于未来。</p>\n<p>一般来说，突破的过程，绝非轻而易举，而且有可能伴随着阵痛。它需要我们付出十分的心力，甚至承担一定的风险，做成一些原本超出自己能力极限的事情。而一旦过了突破期，各种技能在这个层次上融会贯通，就会给我们带来极大的自信和成就感。这个时候，处理同一层面的问题，逐渐变得轻车熟路，于是进入了舒适期。</p>\n<p>舒适期对人有一种天然的吸引力，我们只要待在这个阶段，就能获得最大的安全感，尽量少地遭受不确定性的折磨。很多人会选择待在这个区间，不再走出一步。而另一些人则会对这一阶段的缓慢增长产生焦虑，于是舒适期变成了瓶颈期，从而引发下一轮的突破。</p>\n<p>以每一次大的突破为分界，我们可以将技术人员的成长粗略划分为四大阶段：新手、熟手、专家、宗师（开创者）。</p>\n<p>新手经过半年到一年的工作经验，如果能成功适应这份工作，基本就能有所突破，变成一个熟手。熟手的特点是，能对现成的工具充分利用，胜任大部分日常工作。在技术水平的表现上，他了解大部分的技术概念，但不一定理解真正的含义；在他的眼中，技术还无法自成体系，能理解到的知识架构还有所残缺。他解决问题所依靠的，更多是经验而非缜密的逻辑。前面提到的小李，就处于这个阶段。</p>\n<p>熟手再向上突破一层，则成为技术专家。专家，在某个领域拥有足够全面、系统而深入的知识储备，对于技术上的疑难杂症，有能力深入到足够的层次，指出问题的症结所在；另一方面，专家还应该能够完成对具体问题的抽象，拥有“造轮子”的能力。在专家的眼中，技术的黑盒子被打开，知识点也不再是孤立存在的，而是相互枝连，构成一个完整的逻辑系统。</p>\n<p>而真正达到宗师这一级别的，整个世上也寥寥无几。他们是真正的开创者，能够引领一个技术时代。什么样的人才配得上“宗师”这个称呼呢？比如Dennis M. Ritchie（C语言和Unix之父），再比如Linus（Linux内核的发明人）。</p>\n<p>但就像前面的技术成长曲线图所描绘的，技术的成长阶段并没有一个上限。无论你处在哪个阶段，前面仍然存在无限的上升空间。</p>\n<h3 id=\"郭靖的进阶之路\">郭靖的进阶之路</h3>\n<p>近日细读金庸老爷子的《射雕英雄传》，忽然意识到，郭靖乃是金庸武侠中天资最为鲁钝的一位主人公。然而，郭靖从一个普通少年，终成长为一代大侠，这一过程，正好暗合了前面讲到的技术成长曲线。</p>\n<p>郭靖从六岁开始，在蒙古大漠接受江南六怪传授武功，花了整整十年。后又得全真教掌教马钰传授内功一年有余，武功初入门径，获得了武学上第一个突破（熟手期）。处于这个阶段的郭靖，在武功上与同龄的杨康不相上下。</p>\n<p>郭靖在武学上的第二个突破，起因于两个事件：一个是“北丐”洪七公传授他降龙十八掌，另一个是老顽童骗他背诵《九阴真经》。经过一番历练，在华山顶上，他已经拥有了分别与“东邪”和“北丐”过手三百招而保持不败的战绩。此时的郭靖，已经是高手中的高手了（专家）。这第二次突破，他只用了两年有余。</p>\n<p>而郭靖的第三个突破，已经是在《射雕》之后了，终于成长为一代武学宗师。</p>\n<p>为什么天资并不出众的郭靖，却能够接连取得突破呢？至少两个原因不容忽视。一个是勤奋，“人家练一朝，我就练十天”，所以根基打得好；另一个原因是他恰好学对了东西，降龙十八掌和《九阴真经》都是正宗武学，有幸学到自然是突飞猛进。</p>\n<h2 id=\"突破的要领\">突破的要领</h2>\n<p>技术成长的关键在于突破。</p>\n<p>然而，在技术成长的路上，越到后面，突破的难度就越大。大部分新手，只要保持足够的勤奋，总能达到熟手的程度。但很多人却止步于此，他们或流连于舒适期的诱惑不肯走出来，或长期卡在瓶颈期却找不到突破的出口。能够突破达到专家这一阶段的技术人员，已经足够成为各大公司技术部门的翘楚了。而要达到宗师的级别，则不光靠个人的努力，还需要时代的机遇才有可能。</p>\n<p>那么，为了达到真正的突破，有哪些因素是我们需要重视的呢？</p>\n<h3>第一，根基。</h3>\n<p>在接触一门新技术或者一个新的技术领域时，良好的基础有利于我们快速突破，抵达下一个阶段。不同技术之间，基础却是相通的。比如，对于计算机软件学科的基础知识——数据结构和算法，处于熟手期的程序员可能多半会认为它们在工作中根本没有用。这是因为这个阶段的技术人员主要靠孤立的经验解决问题，一些基础的知识自然就用不上。但对于技术专家层次的人来说，数据结构和算法却是在系统设计的很多方面潜移默化地发挥作用。对于其它计算机基础学科，这个道理也同样适用。</p>\n<p>再比如，现在人工智能和机器学习技术比较火，似乎全民都在学习。但要想学好这些技术，至少应该对于微积分、线性代数、概率论、统计学等数学知识有比较扎实的基础，才能走得更远。</p>\n<h3>第二，外因，一个不疾不徐的环境。</h3>\n<p>过于宽松的环境自然不利于人的进步，而盲目的紧张也不利于人的成长。</p>\n<p>突破的过程需要付出巨大的精力，所以需要投入足够的时间去从容地完成。我们大概都经历过这样一种场景：新产品上线在即，但还有很多问题需要解决。如果距离预定上线时间还有数天，那么我们可以相对从容地用比较优雅的方式来解决这些问题，并做一些长远的打算；但如果我们碰到的情况是，两个小时以后就要上线了，那么我们多半会想一些歪点子来规避这些问题。</p>\n<p>产品开发和技术优化，有时相辅相成，有时又互相矛盾。如果你所处的工作岗位，只是要求你不停地修改业务流程，盲目地试错，那么，可能公司根本没有给你留出技术突破的空间。试想，一个主旨不清，功能点做了新的就扔了旧的，而没有长远的目标，也不去持续优化体验，这样的一个产品，又怎能有持续的生命力呢？</p>\n<h3>第三，正确（正宗）的学习资料。</h3>\n<p>新手刚开始工作的时候，通常只要看一些入门教程（Tutorial），跑几个Demo，扫除了表面上的技术疑问点，再针对业务代码向老员工请教一番，基本就能开始工作了。然后一边编码，一边查阅所需要的API Reference，时间长了，经验和技巧足够多了，就自然变成熟手了。</p>\n<p>而从熟手向专家的突破，则需要系统地去补习知识架构。<strong>技巧应该建立在对于普遍规则的理解之上</strong>。这里不得不提及Spec，它是涉及某项技术的完备的、系统的描述，包含该项技术涉及到的方方面面（具体参见我的另一篇文章《<a href=\"http://blog.jobbole.com/105667/\" target=\"_blank\">技术的正宗与野路子</a>》）。在奔向技术专家的路上，阅读Spec，是不可逾越的一道功课。《射雕》中郭靖的武功突破，很大程度上就是因为他阅读了《九阴真经》这份大大的Spec。当然，除此之外，你可能还需要通读重要部分的API Reference以及Source Code。</p>\n<p>技术专家必然将原始文献（官网Spec、论文等）作为知识的第一来源。相反，跟着某人的博客去系统地学习某方面的技术，是要冒有很大风险的，还需慎重选择。</p>\n<p>最后，要想成为技术上的一代宗师，则需要更高的抽象，做出完全创造性的工作。这份工作不仅仅是阅读Spec，解决具体的问题了，而是创作Spec，开创全新的天地。</p>\n<h3>第四，独立思考，不要自我设限。</h3>\n<p>现在，很多人喜欢把技术好的人喊作“大神”。这自然是代表一种尊重，很多听的人也很受用。</p>\n<p>但是，“神”的称呼暗含了一层意思：神是无法超越的，是普通人学不来的。这是人们在潜意识里划出的一道鸿沟。所以，我就不太喜欢类似这种称呼。</p>\n<p>很多人碰到问题就喜欢找身边“大神”去问，但殊不知问再多问题，你仍然无法真正地有所提高。普通人和“大神”之间真正的鸿沟在于，能否独立思考和解决问题。</p>\n<hr>\n<p>在追求技术成长的路上，不可能总是一帆风顺。我们不免有时沮丧，有时欣喜。</p>\n<p>人生苦短，有人穷其一生，就是想要达到理想中的那个状态。但不管结果如何，当我们青春不再的时候，只求问心无愧。</p>\n<p>（完）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110142\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110142votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110142\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 14 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "c149b57f1cdcb0d8523ac9b9b7202cfc", "title": "用户熟悉的设计，才是最好的设计", "url": "http://blog.jobbole.com/110861/", "create_date": "2017/04/14", "front_image_url": ["https://i1.wp.com/blog.pinpt.co/wp-content/uploads/2017/01/contribution-drop-down-date-2.png?resize=525%2C339"], "praise_nums": 2, "comment_nums": 0, "fav_nums": 0, "tags": "设计", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/guluyi\">古鲁伊</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://blog.pinpt.co/familiar-good/\">blog.pinpt.co</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>Nolan 领导完成了很多设计决策，前几天复查下个产品的设计迭代时，他在 Slack 频道分享了这个主题：</p>\n<p><strong>用户熟悉的设计才是最好的设计</strong></p>\n<p>我非常赞同。</p>\n<p>首次创业者，尤其是新品开发/设计人员面临的一个典型挑战是，想要同时内部和/或通过创新的传输系统给出颠覆性的解决方案。</p>\n<p>或者换句话说，他们试着两次创造轮子，在即使一次也已经足够困难的情况下。简单点说，你不必为了让 SaaS 产品十项全能、与众不同，而绞尽脑汁想出革新性的设计层。</p>\n<p>但实际为了新的客户群（如果处于没有客户的早期阶段），不提出新的 UI 乃至 UX 是艰难的。</p>\n<p>算上数据，我们的产品异常庞大。在产品不断迭代的过程中，我们一直谨记着这条铁则（<a href=\"https://blog.pinpt.co/humble-pie/\">这里</a> 和 <a href=\"https://blog.pinpt.co/show-me-data/\">这里</a> 分享了一些经验教训）。</p>\n<p>在展示产品价值时，我们希望给用户一种新奇、直击心灵的体验，但是事实证明我们在不重要的地方过度优化了。</p>\n<p><a href=\"https://blog.pinpt.co/humble-pie/\">回顾总结</a>，你会发现我们让许多早期用户完全错失了设计和 UI 中的一个重要功能。</p>\n<div style=\"width: 535px\" class=\"wp-caption aligncenter\"><img src=\"https://i1.wp.com/blog.pinpt.co/wp-content/uploads/2017/01/contribution-drop-down-date-2.png?resize=525%2C339\" width=\"525\" height=\"339\">\n<p class=\"wp-caption-text\">Contribution by Date</p>\n</div>\n<p>所以我们进行了改进，将下拉菜单展示在更显眼的位置。实际可能有点过犹不及。</p>\n<p>下面是 Nolan 和团队讨论的一个版本：</p>\n<div style=\"width: 535px\" class=\"wp-caption aligncenter\"><img src=\"https://i0.wp.com/blog.pinpt.co/wp-content/uploads/2017/02/pinpoint-pill-design-menu.jpeg?resize=525%2C319\" width=\"525\" height=\"319\">\n<p class=\"wp-caption-text\">A “pill” design.</p>\n</div>\n<p>如你所见，在这个版本中，我们把之前可能会被忽略的下拉菜单放到了一眼就能看到的地方。但总之不太合适，并且和页面整体展示数据的方式、设计都不搭。</p>\n<p>所以我们继续改进：</p>\n<div style=\"width: 535px\" class=\"wp-caption aligncenter\"><img src=\"https://i1.wp.com/blog.pinpt.co/wp-content/uploads/2017/02/pinpoint-filter-content-view.jpeg?resize=525%2C150\" width=\"525\" height=\"150\">\n<p class=\"wp-caption-text\">Filtered views, options.</p>\n</div>\n<p>现在页面有三层菜单，和我们之前的设计美感更接近些了。但是这版占据了屏幕太多固定区域。当然，可以在折叠菜单上做点小处理，但是不能直击要点（但至少比原始设计明显多了）。</p>\n<p>之后，我们终于想出了一种兼顾各方的设计方案（并非原创）——小侧边栏：</p>\n<div style=\"width: 535px\" class=\"wp-caption aligncenter\"><img src=\"https://i1.wp.com/blog.pinpt.co/wp-content/uploads/2017/02/left-nav-design-1.png?resize=525%2C270\" width=\"525\" height=\"270\">\n<p class=\"wp-caption-text\">A new side-menu look.</p>\n</div>\n<p>当然这不是最终版本，但是达到了我们想要的效果，节省了顶层菜单的覆盖面积。我们将“日期”选项置于顶部，这样就不会流失客户，只是将整体层移到了左侧。</p>\n<p>如果你觉得这种设计莫名熟悉，那么可能是因为看起来和 Slack 很像：</p>\n<div style=\"width: 535px\" class=\"wp-caption aligncenter\"><img src=\"https://i0.wp.com/blog.pinpt.co/wp-content/uploads/2017/02/slack-ui-design-sidebar-ux.png?resize=525%2C286\" width=\"525\" height=\"286\">\n<p class=\"wp-caption-text\">Slack’s sidebar design.</p>\n</div>\n<p>兜兜转了一圈：我们作为一家产品公司，目标是通过已有数据创造独特价值，提供可行见解改变客户及其团队行为。</p>\n<p>我们不必像展示数据、见解那样绕一大圈重新进行设计、创造轮子。<strong>用户熟悉的设计就是好的设计。</strong></p>\n<p>不难想象，这样的侧边栏对任何内容类型或页面或子页面等，都是可以无限升级的。下面是我们试行的“人员”或“团队”页面。</p>\n<div style=\"width: 535px\" class=\"wp-caption aligncenter\"><img src=\"https://i1.wp.com/blog.pinpt.co/wp-content/uploads/2017/02/left-nav-design-3.png?resize=525%2C270\" width=\"525\" height=\"270\">\n<p class=\"wp-caption-text\">Team / People page</p>\n</div>\n<p>侧边栏同样好用。</p>\n<p>有时我们可能有时间、精力，也喜爱设计一些从没见过的东西，但那之前我们要坚守自身产品独特、有影响力的地方。</p>\n<p>我们希望大家以最快的速度了解怎样使用我们系统，快速创造价值，无需学习成本。</p>\n<p>我脑海中有个形象的比喻：这就像给某人一个游戏手柄，告诉他们去玩就好，根本不用教。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/8b23458dab045a48228dfa537d5241ea.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/d2beee507374a3f33067e97fc125e755.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110861\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110861votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110861\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/guluyi\">古鲁伊</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/guluyi\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/662ce8e129bd8134e24a22b10abb0385.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            立志做一名有格调的程序媛        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/guluyi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/guluyi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/guluyi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 26</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "b82e24ca3b6f49d1750e049329ce3f09", "title": "Linux 命令行工具使用小贴士及技巧（4）", "url": "http://blog.jobbole.com/110848/", "create_date": "2017/04/11", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/04/e260ae4f5d153b25be87819b25ff0577.jpg"], "praise_nums": 1, "comment_nums": 1, "fav_nums": 1, "tags": "IT技术,命令行", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/tutorial/command-line-aliases-in-linux/\">Ansh</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8393-1.html\">ictlyh</a>   </div><p>到目前为止，在该系列指南中，我们已经讨论了 <a href=\"http://blog.jobbole.com/110739/\">cd –</a> 和 <a href=\"http://blog.jobbole.com/110774/\">pushd/popd 命令</a>的基本使用方法和相关细节，以及 <a href=\"http://blog.jobbole.com/110845/\">CDPATH 环境变量</a>。在这第四期、也是最后一期文章中，我们会讨论别名的概念以及你可以如何使用它们使你的命令行导航更加轻松和平稳。</p>\n<p>一如往常，在进入该指南的核心之前，值得指出本文中的所有命令以及展示的例子都在 Ubuntu 14.04LTS 中进行了测试。我们使用的命令行 shell 是 bash（4.3.11 版本）。</p>\n<h3 id=\"toc_1\">Linux 中的命令行别名</h3>\n<p>按照外行人的定义，别名可以被认为是一个复杂命令或者一组命令（包括它们的参数和选项）的简称或缩写。所以基本上，使用别名，你可以为那些不那么容易书写/记忆的命令创建易于记忆的名称。</p>\n<p>例如，下面的命令为 <code>cd ~</code> 命令创建别名 <code>home</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efab9101397060\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalias home=\"cd ~\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efab9101397060-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efab9101397060-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efab9101397060-1\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"cd ~\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efab9101397060-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这意味着现在在你的系统中无论何地，无论何时你想要回到你的主目录时，你可以很快地输入 <code>home</code> 然后按回车键实现。</p>\n<p>关于 <code>alias</code> 命令，man 手册是这么描述的：</p>\n<blockquote><p>alias 工具可以创建或者重定义别名定义，或者把现有别名定义输出到标准输出。别名定义提供了输入一个命令时应该被替换的字符串值</p>\n<p>一个别名定义会影响当前 shell 的执行环境以及当前 shell 的所有子 shell 的执行环境。按照 IEEE Std 1003.1-2001 规定，别名定义不应该影响当前 shell 的父进程以及任何 shell 调用的程序环境。</p></blockquote>\n<p>那么，别名到底如何帮助命令行导航呢？这是一个简单的例子：</p>\n<p>假设你正在 <code>/home/himanshu/projects/howtoforge</code> 目录工作，它包括很多子目录以及子子目录。例如下面就是一个完整的目录分支：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efac4965995068\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/home/himanshu/projects/howtoforge/command-line/navigation/tips-tricks/part4/final\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efac4965995068-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efac4965995068-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efac4965995068-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">himanshu</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">projects</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">howtoforge</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">command</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">line</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">navigation</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tips</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tricks</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">part4</span><span class=\"crayon-o\">/</span><span class=\"crayon-m\">final</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efac4965995068-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在想象你在 <code>final</code> 目录，然后你想回到 <code>tips-tricks</code> 目录，然后再从那里，回到 <code>howtoforge</code> 目录。你会怎么做呢？</p>\n<p>是的，一般情况下，你会运行下面的一组命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efacb793986199\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd ../..\r\n\r\ncd ../../..\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efacb793986199-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efacb793986199-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efacb793986199-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efacb793986199-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efacb793986199-1\"><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efacb793986199-2\"> </div><div class=\"crayon-line\" id=\"crayon-58f7e3c9efacb793986199-3\"><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efacb793986199-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>虽然这种方法并没有错误，但它绝对不方便，尤其是当你在一个很长的路径中想往回走例如说 5 个目录时。那么，有什么解决办法吗？答案就是：别名。</p>\n<p>你可以做的是，为每个 <code>cd ..</code> 命令创建容易记忆（和书写）的别名。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efacf975826821\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalias bk1=\"cd ..\"  \r\nalias bk2=\"cd ../..\"  \r\nalias bk3=\"cd ../../..\"  \r\nalias bk4=\"cd ../../../..\"  \r\nalias bk5=\"cd ../../../../..\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efacf975826821-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efacf975826821-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efacf975826821-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efacf975826821-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efacf975826821-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efacf975826821-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efacf975826821-1\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">bk1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"cd ..\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efacf975826821-2\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">bk2</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"cd ../..\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-58f7e3c9efacf975826821-3\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">bk3</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"cd ../../..\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efacf975826821-4\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">bk4</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"cd ../../../..\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-58f7e3c9efacf975826821-5\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">bk5</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"cd ../../../../..\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efacf975826821-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在无论你什么时候想从当前工作目录往回走，例如说 5 个目录，你只需要运行下面的命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efad2362019099\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbk5\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efad2362019099-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efad2362019099-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efad2362019099-1\"><span class=\"crayon-i\">bk5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efad2362019099-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p>现在这不是很简单吗？</p>\n<h3 id=\"toc_2\">相关细节</h3>\n<p>尽管当前我们在 shell 中用于定义别名的技术（通过使用 alias 命令）实现了效果，别名只存在于当前终端会话。很有可能你会希望你定义的别名能保存下来，使得此后你可以在任何新启动的命令行窗口/标签页中使用它们。</p>\n<p>为此，你需要在 <code>~/.bash_aliases</code> 文件中定义你的别名，你的 <code>~/.bashrc</code> 文件默认会加载该文件（如果你使用更早版本的 Ubuntu，我没有验证过是否有效）。</p>\n<p>下面是我的 <code>.bashrc</code> 文件中关于 <code>.bash_aliases</code> 文件的部分：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efad6014061187\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Alias definitions.\r\n# You may want to put all your additions into a separate file like\r\n# ~/.bash_aliases, instead of adding them here directly.\r\n# See /usr/share/doc/bash-doc/examples in the bash-doc package.\r\n\r\nif [ -f ~/.bash_aliases ]; then \r\n      . ~/.bash_aliases\r\nfi\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efad6014061187-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efad6014061187-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efad6014061187-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efad6014061187-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efad6014061187-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efad6014061187-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efad6014061187-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efad6014061187-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efad6014061187-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efad6014061187-1\"><span class=\"crayon-p\"># Alias definitions.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efad6014061187-2\"><span class=\"crayon-p\"># You may want to put all your additions into a separate file like</span></div><div class=\"crayon-line\" id=\"crayon-58f7e3c9efad6014061187-3\"><span class=\"crayon-p\"># ~/.bash_aliases, instead of adding them here directly.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efad6014061187-4\"><span class=\"crayon-p\"># See /usr/share/doc/bash-doc/examples in the bash-doc package.</span></div><div class=\"crayon-line\" id=\"crayon-58f7e3c9efad6014061187-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efad6014061187-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bash</span><span class=\"crayon-sy\">_</span>aliases<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-58f7e3c9efad6014061187-7\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bash_aliases</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efad6014061187-8\"><span class=\"crayon-i\">fi</span></div><div class=\"crayon-line\" id=\"crayon-58f7e3c9efad6014061187-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>一旦你把别名定义添加到你的 <code>.bash_aliases</code> 文件，该别名在任何新终端中都可用。但是，在任何其它你定义别名时已经启动的终端中，你还不能使用它们 – 解决办法是在这些终端中重新加载 <code>.bashrc</code>。下面就是你需要执行的具体命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efad9074496316\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsource ~/.bashrc\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efad9074496316-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efad9074496316-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efad9074496316-1\"><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bashrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efad9074496316-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果你觉得这要做的也太多了（是的，我期待你有更懒惰的办法），那么这里有一个快捷方式来做到这一切：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efadc774560923\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"alias [the-alias]\" &gt;&gt; ~/.bash_aliases &amp;&amp; source ~/.bash_aliases\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efadc774560923-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efadc774560923-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efadc774560923-1\"><span class=\"crayon-s\">\"alias [the-alias]\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bash_aliases</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bash</span><span class=\"crayon-sy\">_</span>aliases</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efadc774560923-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>毫无疑问，你需要用实际的命令替换 <code>[the-alias]</code>。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efadf323317235\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"alias bk5='cd ../../../../..'\" &gt;&gt; ~/.bash_aliases &amp;&amp; source ~/.bash_aliases\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efadf323317235-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efadf323317235-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efadf323317235-1\"><span class=\"crayon-s\">\"alias bk5='cd ../../../../..'\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bash_aliases</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bash</span><span class=\"crayon-sy\">_</span>aliases</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efadf323317235-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>接下来，假设你已经创建了一些别名，并时不时使用它们有一段时间了。突然有一天，你发现它们其中的一个并不像期望的那样。因此你觉得需要查看被赋予该别名的真正命令。你会怎么做呢？</p>\n<p>当然，你可以打开你的 <code>.bash_aliases</code> 文件在那里看看，但这种方式可能有点费时，尤其是当文件中包括很多别名的时候。因此，如果你正在查找一种更简单的方式，这就有一个：你需要做的只是运行 <code>alias</code> 命令并把别名名称作为参数。</p>\n<p>这里有个例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efae6159074071\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ alias bk6\r\nalias bk6='cd ../../../../../..'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efae6159074071-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efae6159074071-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efae6159074071-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efae6159074071-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">alias </span><span class=\"crayon-e\">bk6</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efae6159074071-2\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">bk6</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'cd ../../../../../..'</span></div><div class=\"crayon-line\" id=\"crayon-58f7e3c9efae6159074071-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>你可以看到，上面提到的命令显示了被赋值给别名 <code>bk6</code> 的实际命令。这里还有另一种办法：使用 <code>type</code> 命令。下面是一个例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efaea333952992\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ type bk6\r\nbk6 is aliased to `cd ../../../../../..'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efaea333952992-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efaea333952992-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efaea333952992-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efaea333952992-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type </span><span class=\"crayon-e\">bk6</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efaea333952992-2\"><span class=\"crayon-e\">bk6 </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aliased </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span>'</div><div class=\"crayon-line\" id=\"crayon-58f7e3c9efaea333952992-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><code>type</code> 命令产生了一个易于人类理解的输出。</p>\n<p>另一个值得分享的是你可以将别名用于常见的输入错误。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e3c9efaed108471025\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalias mroe='more'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e3c9efaed108471025-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e3c9efaed108471025-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e3c9efaed108471025-1\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">mroe</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'more'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e3c9efaed108471025-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><em>最后，还值得注意的是并非每个人都喜欢使用别名。他们中的大部分人认为一旦你习惯了你为了简便而定义的别名，当你在其它相同而不存在别名（而且不允许你创建）的系统中工作时就会变得非常困难。更多（也是更准确的）为什么一些专家不推荐使用别名的原因，你到<a href=\"http://unix.stackexchange.com/questions/66934/why-is-aliasing-over-standard-commands-not-recommended\">这里</a>查看。</em></p>\n<h3 id=\"toc_3\">总结</h3>\n<p>就像我们之前文章讨论过的 <code>CDPATH</code> 环境变量，别名也是一把应该谨慎使用的双刃剑。尽管如此也别太丧气，因为每个东西都有它自己的好处和劣势。遇到类似别名的概念时，更多的练习和完备的知识才是重点。</p>\n<p>那么这就是该系列指南的最后章节。希望你喜欢它并能从中学到新的东西/概念。如果你有任何疑问或者问题，请在下面的评论框中和我们（以及其他人）分享。</p>\n<p>请使用手机”扫一扫”x</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110848\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110848votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110848\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "af6dabb009225f19a1ca055412d0a27d", "title": "MySQL 主从复制搭建，基于日志（binlog）", "url": "http://blog.jobbole.com/110934/", "create_date": "2017/04/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/6813e861d7765d2cf8c1f7f313083944.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://raye.wang/2017/04/14/mysqlzhu-cong-fu-zhi-da-jian-ji-yu-ri-zhi-binlog/\">raye.wang</a>   </div><div>\n<h2 id=\"mysql\">什么是MySQL主从复制</h2>\n<p>简单来说，就是保证主SQL（Master）和从SQL（Slave）的数据是一致性的，向Master插入数据后，Slave会自动从Master把修改的数据同步过来（有一定的延迟），通过这种方式来保证数据的一致性，就是主从复制。</p>\n<h2 id=\"mysql\">MySQL主从能解决什么问题</h2>\n<h4 id=\"\">一、高可用</h4>\n<p>因为数据都是相同的，所以当Master挂掉后，可以指定一台Slave充当Master继续保证服务运行，因为数据是一致性的（如果当插入Master就挂掉，可能不一致，因为同步也需要时间），当然这种配置不是简单的把一台Slave充当Master，毕竟还要考虑后续的Salve同步Master，当然本文并不是将高可用的配置，所以这里就不多讲了。</p>\n<h4 id=\"\">二、负载均衡</h4>\n<p>因为读写分离也算是负载均衡的一种，所以就不单独写了，因为一般都是有多台Slave的，所以可以将读操作指定到Slave服务器上（需要代码控制），然后再用负载均衡来选择那台Slave来提供服务，同时也可以吧一些大量计算的查询指定到某台Slave，这样就不会影响Master的写入以及其他查询</p>\n<h4 id=\"\">三、数据备份</h4>\n<p>一般我们都会做数据备份，可能是写定时任务，一些特殊行业可能还需要手动备份，有些行业要求备份和原数据不能在同一个地方，所以主从就能很好的解决这个问题，不仅备份及时，而且还可以多地备份，保证数据的安全</p>\n<h4 id=\"\">四、业务模块化</h4>\n<p>可以一个业务模块读取一个Slave，再针对不同的业务场景进行数据库的索引创建和根据业务选择MySQL存储引擎</p>\n<h4 id=\"\">五、高扩展（硬件扩展）</h4>\n<p>主从复制支持2种扩展方式</p>\n<h5 id=\"1scaleup\">1、scale-up</h5>\n<p>向上扩展或者纵向扩展，主要是提供比现在服务器更好性能的服务器，比如增加CPU和内存以及磁盘阵列等，因为有多台服务器，所以可扩展性比单台更大</p>\n<h5 id=\"2scaleout\">2、scale-out</h5>\n<p>向外扩展或者横向扩展，是指增加服务器数量的扩展，这样主要能分散各个服务器的压力</p>\n<h2 id=\"\">主从复制的缺点</h2>\n<h4 id=\"\">一、成本增加</h4>\n<p>无可厚非的是搭建主从肯定会增加成本，毕竟一台服务器和两台服务器的成本完全不同，另外由于主从必须要开启二进制日志，所以也会造成额外的性能消耗</p>\n<h4 id=\"\">二、数据延迟</h4>\n<p>Slave从Master复制过来肯定是会有一定的数据延迟的，所以当刚插入就出现查询的情况，可能查询不出来，当然如果是插入者自己查询，那么可以直接从Master中查询出来，当然这个也是需要用代码来控制的</p>\n<h4 id=\"\">三、写入更慢</h4>\n<p>主从复制主要是针对读远大于写或者对数据备份实时性要求较高的系统中，因为Master在写中需要更多操作，而且只有一台写入的Master（因为我目前只会配置一台写入Master，最多就是有从Master的Slave，用来在Master挂掉后替换成Master，平时不对外进行服务），所以写入的压力并不能被分散，当然如果直接怎么解决这个问题的话，欢迎留言指教</p>\n<h2 id=\"\">复制方式</h2>\n<p>MySQL5.6开始主从复制有两种方式：基于日志（binlog）、基于GTID（全局事务标示符）。<br>\n本文只涉及基于日志binlog的主从配置</p>\n<h2 id=\"\">复制原理</h2>\n<p>1、Master将数据改变记录到二进制日志(binary log)中，也就是配置文件log-bin指定的文件，这些记录叫做二进制日志事件(binary log events)<br>\n2、Slave通过I/O线程读取Master中的binary log events并写入到它的中继日志(relay log)<br>\n3、Slave重做中继日志中的事件，把中继日志中的事件信息一条一条的在本地执行一次，完成数据在本地的存储，从而实现将改变反映到它自己的数据(数据重放)</p>\n<h4 id=\"\">要求</h4>\n<p>1、主从服务器操作系统版本和位数一致<br>\n2、Master和Slave数据库的版本要一致<br>\n3、Master和Slave数据库中的数据要一致<br>\n4、Master开启二进制日志，Master和Slave的server_id在局域网内必须唯一</p>\n<h2 id=\"\">具体配置</h2>\n<h3 id=\"\">硬件需求</h3>\n<p>两台或两台以上安装了相同版本的MySQL（我没有试过不同版本会不会有问题，有兴趣的可以试试），当然这个可以用虚拟机或者Docker代替，个人推荐用Docker，比虚拟机消耗少太多了，当然用起来可能没有虚拟机那么方便，但是却不用挨个环境配置了</p>\n<h3 id=\"master\">配置Master</h3>\n<h5 id=\"\">一、安装数据库</h5>\n<h5 id=\"mycnf\">二、配置my.cnf</h5>\n<p>不同的系统my.cnf路径不同，所以我们只讲解牵扯修改的地方。添加配置</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e182f08ad603076099\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[mysqld]\r\n## 设置server_id，一般设置为IP,注意要唯一\r\nserver_id=100  \r\n## 复制过滤：也就是指定哪个数据库不用同步（mysql库一般不同步）\r\nbinlog-ignore-db=mysql  \r\n## 开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）\r\nlog-bin=edu-mysql-bin  \r\n## 为每个session 分配的内存，在事务过程中用来存储二进制日志的缓存\r\nbinlog_cache_size=1M  \r\n## 主从复制的格式（mixed,statement,row，默认格式是statement）\r\nbinlog_format=mixed  \r\n## 二进制日志自动删除/过期的天数。默认值为0，表示不自动删除。\r\nexpire_logs_days=7  \r\n## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。\r\n## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致\r\nslave_skip_errors=1062  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08ad603076099-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08ad603076099-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08ad603076099-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08ad603076099-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08ad603076099-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08ad603076099-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08ad603076099-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08ad603076099-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08ad603076099-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08ad603076099-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08ad603076099-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08ad603076099-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08ad603076099-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08ad603076099-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08ad603076099-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08ad603076099-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e182f08ad603076099-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mysqld</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08ad603076099-2\"><span class=\"crayon-p\">## 设置server_id，一般设置为IP,注意要唯一</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08ad603076099-3\"><span class=\"crayon-v\">server_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08ad603076099-4\"><span class=\"crayon-p\">## 复制过滤：也就是指定哪个数据库不用同步（mysql库一般不同步）</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08ad603076099-5\"><span class=\"crayon-v\">binlog</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ignore</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">db</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08ad603076099-6\"><span class=\"crayon-p\">## 开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08ad603076099-7\"><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">edu</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bin</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08ad603076099-8\"><span class=\"crayon-p\">## 为每个session 分配的内存，在事务过程中用来存储二进制日志的缓存</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08ad603076099-9\"><span class=\"crayon-v\">binlog_cache_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1M</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08ad603076099-10\"><span class=\"crayon-p\">## 主从复制的格式（mixed,statement,row，默认格式是statement）</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08ad603076099-11\"><span class=\"crayon-v\">binlog_format</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">mixed</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08ad603076099-12\"><span class=\"crayon-p\">## 二进制日志自动删除/过期的天数。默认值为0，表示不自动删除。</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08ad603076099-13\"><span class=\"crayon-v\">expire_logs_days</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08ad603076099-14\"><span class=\"crayon-p\">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08ad603076099-15\"><span class=\"crayon-p\">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08ad603076099-16\"><span class=\"crayon-v\">slave_skip_errors</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1062</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>配置完成后重启mysql</p>\n<h5 id=\"\">关于复制过滤</h5>\n<p>复制过滤可以让你只复制服务器中的一部分数据，有两种复制过滤：</p>\n<p>1、在Master上过滤二进制日志中的事件<br>\n2、在Slave上过滤中继日志中的事件。</p>\n<h5 id=\"\">复制类型</h5>\n<h6 id=\"1\">1、基于语句的复制</h6>\n<p>在Master上执行的SQL语句，在Slave上执行同样的语句。MySQL默认采用基于语句的复制，效率比较高。一旦发现没法精确复制时，会自动选着基于行的复制</p>\n<h6 id=\"2\">2、基于行的复制</h6>\n<p>把改变的内容复制到Slave，而不是把命令在Slave上执行一遍。从MySQL5.0开始支持</p>\n<h6 id=\"3\">3、混合类型的复制</h6>\n<p>默认采用基于语句的复制，一旦发现基于语句的无法精确的复制时，就会采用基于行的复制</p>\n<h5 id=\"\">三、创建数据同步用户</h5>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e182f08bd724921547\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE USER 'slave'@'%' IDENTIFIED BY '123456';\r\n\r\nGRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'slave'@'%';  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08bd724921547-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08bd724921547-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08bd724921547-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e182f08bd724921547-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">USER</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'slave'</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">'%'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IDENTIFIED </span><span class=\"crayon-i\">BY</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'123456'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08bd724921547-2\"> </div><div class=\"crayon-line\" id=\"crayon-58f7e182f08bd724921547-3\"><span class=\"crayon-e\">GRANT </span><span class=\"crayon-e\">REPLICATION </span><span class=\"crayon-v\">SLAVE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">REPLICATION </span><span class=\"crayon-e\">CLIENT </span><span class=\"crayon-e \">ON *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">TO</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'slave'</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">'%'</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>这里主要是要授予用户REPLICATION SLAVE权限和REPLICATION CLIENT权限</p>\n<h3 id=\"slave\">配置Slave</h3>\n<h5 id=\"\">一、安装数据库</h5>\n<h5 id=\"mycnf\">二、配置my.cnf</h5>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e182f08c1039905283\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[mysqld]\r\n## 设置server_id，一般设置为IP,注意要唯一\r\nserver_id=101  \r\n## 复制过滤：也就是指定哪个数据库不用同步（mysql库一般不同步）\r\nbinlog-ignore-db=mysql  \r\n## 开启二进制日志功能，以备Slave作为其它Slave的Master时使用\r\nlog-bin=edu-mysql-slave1-bin  \r\n## 为每个session 分配的内存，在事务过程中用来存储二进制日志的缓存\r\nbinlog_cache_size=1M  \r\n## 主从复制的格式（mixed,statement,row，默认格式是statement）\r\nbinlog_format=mixed  \r\n## 二进制日志自动删除/过期的天数。默认值为0，表示不自动删除。\r\nexpire_logs_days=7  \r\n## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。\r\n## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致\r\nslave_skip_errors=1062  \r\n## relay_log配置中继日志\r\nrelay_log=edu-mysql-relay-bin  \r\n## log_slave_updates表示slave将复制事件写进自己的二进制日志\r\nlog_slave_updates=1  \r\n## 防止改变数据(除了特殊的线程)\r\nread_only=1  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c1039905283-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7e182f08c1039905283-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mysqld</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-2\"><span class=\"crayon-p\">## 设置server_id，一般设置为IP,注意要唯一</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-3\"><span class=\"crayon-v\">server_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">101</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-4\"><span class=\"crayon-p\">## 复制过滤：也就是指定哪个数据库不用同步（mysql库一般不同步）</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-5\"><span class=\"crayon-v\">binlog</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ignore</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">db</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-6\"><span class=\"crayon-p\">## 开启二进制日志功能，以备Slave作为其它Slave的Master时使用</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-7\"><span class=\"crayon-v\">log</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">edu</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">slave1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bin</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-8\"><span class=\"crayon-p\">## 为每个session 分配的内存，在事务过程中用来存储二进制日志的缓存</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-9\"><span class=\"crayon-v\">binlog_cache_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1M</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-10\"><span class=\"crayon-p\">## 主从复制的格式（mixed,statement,row，默认格式是statement）</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-11\"><span class=\"crayon-v\">binlog_format</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">mixed</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-12\"><span class=\"crayon-p\">## 二进制日志自动删除/过期的天数。默认值为0，表示不自动删除。</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-13\"><span class=\"crayon-v\">expire_logs_days</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-14\"><span class=\"crayon-p\">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-15\"><span class=\"crayon-p\">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-16\"><span class=\"crayon-v\">slave_skip_errors</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1062</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-17\"><span class=\"crayon-p\">## relay_log配置中继日志</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-18\"><span class=\"crayon-v\">relay_log</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">edu</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">relay</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bin</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-19\"><span class=\"crayon-p\">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-20\"><span class=\"crayon-v\">log_slave_updates</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-58f7e182f08c1039905283-21\"><span class=\"crayon-p\">## 防止改变数据(除了特殊的线程)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7e182f08c1039905283-22\"><span class=\"crayon-v\">read_only</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>如果Slave为其它Slave的Master时，必须设置bin_log。配置完成后重启mysql</p>\n<h3 id=\"masterslave\">完成Master和Slave链接</h3>\n<h5 id=\"\">一、初始化数据</h5>\n<p>保证Master和Slave除不同步的数据库，其他库的数据一致</p>\n<h5 id=\"master\">二、查询Master状态</h5>\n<p>在Master中执行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e182f08c6731936229\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nshow master status;  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08c6731936229-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e182f08c6731936229-1\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">master </span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>记录下返回结果的File列和Position列的值</p>\n<h5 id=\"slavemaster\">三、Slave中设置Master信息</h5>\n<p>在Slave中执行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e182f08cd783437147\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nchange master to master_host='192.168.1.100', master_user='slave', master_password='123456', master_port=3306, master_log_file='edu-mysql-bin.000001', master_log_pos=1389, master_connect_retry=30;  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08cd783437147-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e182f08cd783437147-1\"><span class=\"crayon-e\">change </span><span class=\"crayon-e\">master </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">master_host</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'192.168.1.100'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">master_user</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'slave'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">master_password</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'123456'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">master_port</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3306</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">master_log_file</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'edu-mysql-bin.000001'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">master_log_pos</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1389</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">master_connect_retry</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>上面执行的命令的解释：</p>\n<p>master_host=’192.168.1.100′ ## Master的IP地址</p>\n<p>master_user=’slave’ ## 用于同步数据的用户（在Master中授权的用户）</p>\n<p>master_password=’123456′ ## 同步数据用户的密码</p>\n<p>master_port=3306 ## Master数据库服务的端口</p>\n<p>master<em>log</em>file=’edu-mysql-bin.000001′ ##指定Slave从哪个日志文件开始读复制数据（Master上执行命令的结果的File字段）</p>\n<p>master<em>log</em>pos=429 ## 从哪个POSITION号开始读（Master上执行命令的结果的Position字段）</p>\n<p>master<em>connect</em>retry=30 ##当重新建立主从连接时，如果连接建立失败，间隔多久后重试。单位为秒，默认设置为60秒，同步延迟调优参数。</p>\n<h5 id=\"\">四、查看主从同步状态</h5>\n<p>在Slave中执行命令</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e182f08d1426437521\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nshow slave status;  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08d1426437521-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e182f08d1426437521-1\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">slave </span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>可看到Slave<em>IO</em>State为空， Slave<em>IO</em>Running和Slave<em>SQL</em>Running是No，表明Slave还没有开始复制过程。相反Slave<em>IO</em>Running和Slave<em>SQL</em>Running是Yes表明已经开始工作了</p>\n<h5 id=\"\">五、开启主从同步</h5>\n<p>在Slave中执行命令</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7e182f08d4366227959\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstart slave;  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7e182f08d4366227959-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7e182f08d4366227959-1\"><span class=\"crayon-e\">start </span><span class=\"crayon-v\">slave</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>查询查看主从同步状态，会发现Slave<em>IO</em>Running和Slave<em>SQL</em>Running是Yes了，表明开启成功</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110934\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110934votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110934\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "117c0a597cbe009ab0c92351e1c2af6d", "title": "谷歌大牛的 C 语言编程建议和技巧", "url": "http://blog.jobbole.com/110929/", "create_date": "2017/04/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/746b03c66c6e4568ab9770632e5c69e9.jpg"], "praise_nums": 2, "comment_nums": 0, "fav_nums": 0, "tags": "C/C++,开发,C语言", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/pu_zhe\">PJing</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.lysator.liu.se/c/pikestyle.html\">Rob Pike</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：本文作者 Rob Pike 是谷歌公司最著名的软件工程师之一，曾是贝尔实验室 Unix 开发团队成员，Plan 9 操作系统开发的主要领导人，Inferno 操作系统开发的主要领导人。他是缔造 Go 语言和 Limbo 语言的核心人物。和 Brian Kernighan 合著过两本书：《The Unix Programming Environment》 和 《程序设计实践(The Practice of Programming)》。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fertr3yrxuj20hs0bvq5o.jpg\" width=\"640\" height=\"427\"></p>\n<p>本文介绍的建议和技巧，是 Rob Pike 写于 1989 年 2 月，伯乐在线编译如下。</p>\n<h2>介绍</h2>\n<p>Kernighan 和 Plauger 编写的《<a href=\"http://www.lysator.liu.se/c/c-faq/index.html#EoPS\" target=\"_blank\">The Elements of Programming Style</a>》，是一本很重要而且公认有很大影响力的书。但有时候我觉得对于书中的简洁规则，可以看做是一种好的烹饪方法，而不是想简洁的表达一种哲学思维。倘若这本书声称应该有意义地选择变量名称，那么难道他们文章中对变量的命名更好？难道 MaximumValueUntilOverflow 比 maxval 更好吗？ 我不这么认为。</p>\n<p>下面是一篇简短的文章，总体上鼓励在编程时应有清晰的哲学思维，而不是给予硬性规则。我并不希望你们能认可所有的东西，因为它们只是观点，观点会随着时间的变化而变化。可是，如果不是直到现在把它们写在纸上，长久以来这些基于许多经验的观点一直积累在我的头脑中。因此希望这些观点能帮助你们，了解如何规划一个程序的细节。（我还没有看到过一篇讲关于如何规划整个事情的好文章，不过这部分可以是课程的一部分）要是能发现它们的特质，那很好；要是不认同的话，那也很好。但如果能启发你们思考为什么不认同，那样就更好了。在任何情况下，都不应该照搬我所说的方式进行编程；要用你认为最好的编程方式来尝试完成程序。请一以贯之而且毫不留情的这么做。</p>\n<p>欢迎您的评论。</p>\n<h2>排版问题</h2>\n<p>程序是一种出版物。意味着程序员们会先阅读（也许是几天、几周或几年后的你自己阅读），最后才轮到机器。机器的快乐就是程序能编译，机器才不在乎程序写的有多么漂亮，可是人们应该保持程序的美观。有时人们会过度关心：用漂亮的打印机呆板地打印出漂亮的输出，而这些输出只是将所有介词用英文文本以粗体字体凸显出来，都是些与程序无关的细节。虽然有很多人认为程序就应该像 Algol­68 所描述的一样（有些系统甚至要求照搬该风格编写程序），可清晰的程序不会因为这样的呈现而变得更清晰，只会使糟糕的程序变得更可笑。</p>\n<p>对于清晰的程序来说，排版规范一向都是至关重要的。当然，众所周知最有用的是缩进，但是当墨水遮盖了意图时，就会控制住排版。因此即便坚持使用简单的旧打字机输出，也该意识到愚蠢的排版。避免过度修饰，比如保持注释的简洁和灵活。通过程序整齐一致地说出想表达的。接着往下看。</p>\n<h2>变量命名</h2>\n<p>对于变量名称，长度并不是名称的价值所在，清晰的表达才是。不常用的全局变量可能会有一个很长的名称，像 <strong>maxphysaddr</strong>。在循环中每一行所使用的数组索引，并不需要取一个比 <strong><span style=\"color: #ff0000;\">i</span></strong> 更详尽的名字。取 <strong>index</strong> 或者 <strong>elementnumber</strong> 会输入更多的字母（或调用文本编辑器），并且会遮盖住计算的细节。当变量名称很长时，很难明白发生了什么。在一定程度上，这是排版问题，看看下面</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d128491ef434040926\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        for(i=0 to 100)\r\n                array[i]=0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d128491ef434040926-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d128491ef434040926-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d128491ef434040926-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d128491ef434040926-2\"><span class=\"crayon-h\">                </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><i>vs</i>.</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d128491ff087714898\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n       for(elementnumber=0 to 100)\r\n                array[elementnumber]=0;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d128491ff087714898-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d128491ff087714898-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d128491ff087714898-1\"><span class=\"crayon-h\">       </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">elementnumber</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d128491ff087714898-2\"><span class=\"crayon-h\">                </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">elementnumber</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现实例子中的问题会变得更糟。所以仅需把索引当成符号来对待。</p>\n<p>指针也需要合理的符号。<strong><span style=\"color: #ff0000;\">np</span></strong> 仅仅只是作为指针 nodepointer 的助记符。如果一贯都遵从命名规范，那么很容易就能推断出 np 表示“节点指针”。在下一篇文章中会提到更多。</p>\n<p>同时在编程可读性的其它方面，一致性也是极其重要的。假使变量名为 maxphysaddr，则不要给同级关系的变量取名 lowestaddress。</p>\n<p>最后，我倾向于「最小长度」但「最大信息量」的命名，并让上下文补齐其余部分。例如：全局变量在使用时很少有上下文帮助理解，那么它们的命名相对而言更需要令人易懂。因此我称 maxphyaddr （不是 MaximumPhysicalAddress）作为一个全局变量名，对于在本地定义和使用的指针来说 np 并不一定是 NodePoint。这是品味的问题，但品味又与清晰度相关。</p>\n<p>我避免在命名时嵌入大写字母；在我经验丰富的双眼中，它们的阅读舒适性太别扭了，像糟糕的排版一样令人心烦。</p>\n<h2>指针的使用</h2>\n<p>C 语言不同寻常，因为它允许指针指向任何事物。指针是锋利的工具，像任何这样的工具一样，使用得当可以产生令人愉悦的生产力，但使用不当也可以造成极大的破坏（在写这篇文章的前几天，我把木工凿插到拇指里了）。指针在学术界的名声不太好，因为它太危险了，莫名其妙地就变得糟糕的不行。但我认为它是强大的符号，它可以帮助我们清楚地自我表达。</p>\n<p>思考：当有指针指向对象时，对于那个对象，确切地说它只是名称，其它什么也不是。听起来很琐碎，但看看下面的两个表达式：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d12849208033458186\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        np\r\n        node[i]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d12849208033458186-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d12849208033458186-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d12849208033458186-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d12849208033458186-2\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>第一个指向一个 node（节点），第二个计算为（可以说）同一个 node。但第二种形式是不太容易理解的表达式。这里解释一下，因为我们必须要知道 node 是什么，<strong>i</strong> 是什么，还要知道 <strong>i</strong> 和 node 与周围程序之间相关（可能不是很详细）的规则是什么。孤立的表达式并不能说明 <strong>i</strong> 是 node 的有效索引，更不用提是我们想要元素的索引。如果 <strong>i</strong>、<strong>j</strong> 和 <strong>k</strong> 都是 node 数组中的索引将很容易出差错，而且连编译器都不能帮助找出错误。当给子程序传参数时，尤其容易出错：指针只是一个单独的参数；但在接收的子程序中必须认为数组和索引是一体的。</p>\n<p>计算为对象表达式本身，比该对象的地址更不易察觉，而且容易出错。正确使用指针可以简化代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d1284920f622957654\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        parent-&gt;link[i].type</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d1284920f622957654-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d1284920f622957654-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">link</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">type</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><i>vs.</i></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d12849219957528730\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\tlp-&gt;type.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d12849219957528730-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d12849219957528730-1\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">lp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果想取下一个元素的 type 可以是</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d1284921e533733527\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n       parent-&gt;link[++i].type</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d1284921e533733527-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d1284921e533733527-1\"><span class=\"crayon-h\">       </span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">link</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">type</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d12849221996502726\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        (++lp)-&gt;type.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d12849221996502726-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d12849221996502726-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">lp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><code></code><strong>i</strong> 前移，但其余的表达式必须保持不变；用指针的话，只需要做一件事，就是指针前移。</p>\n<p>把排版因素也考虑进来。对于处理连续的结构体来说，使用指针比用表达式可读性更好：只需要较少的笔墨，而且编译器和计算机的性能消耗也很小。与此相关的问题是，指针类型会影响指针正确使用，这也就允许在编译阶段使用一些有用的错误检测，来检查数组序列不能分开。而且如果是结构体，那么它们的标签字段就是其类型的提示。因此</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d12849224744943548\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n             np-&gt;left</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d12849224744943548-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d12849224744943548-1\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">np</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">left</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>是足以让人明白的。如果是索引数组，数组将取一些精心挑选的名字，而且表达式也会变得更长：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d12849228790832192\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n             node[i].left.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d12849228790832192-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d12849228790832192-1\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>此外，由于例子变得越来越大，额外的字符更加让人恼火。</p>\n<p>一般来说，如果发现代码中包含许多相似并复杂的表达式，而且表达式计算为数据结构中的元素，那么明智地使用指针可以消除这些问题。考虑一下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d1284922b436796568\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        if(goleft)\r\n             p-&gt;left=p-&gt;right-&gt;left;\r\n        else\r\n             p-&gt;right=p-&gt;left-&gt;right;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d1284922b436796568-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d1284922b436796568-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7d1284922b436796568-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d1284922b436796568-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d1284922b436796568-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">goleft</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d1284922b436796568-2\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">left</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">right</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f7d1284922b436796568-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d1284922b436796568-4\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">right</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">left</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>看起来像利用复合表达式表示 <strong>p</strong>。有时这值得用一个临时变量（这里的 p）或者把运算提取成一个宏。</p>\n<h2>过程名称</h2>\n<p>过程名称应该表明它们是做什么的，函数名称应该表明它们返回什么。函数通常在像 <strong>if</strong> 这样的表达式使用，因此可读性要好。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d1284922e782590527\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        if(checksize(x))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d1284922e782590527-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d1284922e782590527-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">checksize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>是没有太大帮助的，因为不能推断出 checksize 错误时返回 true，还是非错误时返回。相反</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d12849231226104697\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        if(validsize(x))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d12849231226104697-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d12849231226104697-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">validsize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>使这点能清晰表达，并且在常规使用中将来也不大可能出错。</p>\n<h2>注释</h2>\n<p>这一个微妙的问题，需要自己体会和判断。由于一些原因，我倾向于宁可清除注释。第一，假如代码清晰，并且使用了规范的类型名称和变量名称，应该从代码本身就可以理解。第二，编译器不能检查注释，因此不能保证准确，特别是代码修改过以后。误导性的注释会非常令人困惑。第三，排版问题：注释会使代码变得杂乱。</p>\n<p>但有时我会写注释，像下文一样仅仅只是把它们用于介绍。例如：解释全局变量的使用和类型（我总是在庞大的程序中写注释）；作为一个不寻常或者关键过程的介绍；或标记出大规模计算的一节。</p>\n<p>有一个糟糕注释风格的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d12849235909629434\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        i=i+1;           /* Add one to i */</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d12849235909629434-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d12849235909629434-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">/* Add one to i */</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>还有更糟糕的做法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f7d12849238628817376\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        /**********************************\r\n         *                                *\r\n         *          Add one to i          *\r\n         *                                *\r\n         **********************************/\r\n\r\n                       i=i+1;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f7d12849238628817376-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d12849238628817376-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f7d12849238628817376-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d12849238628817376-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f7d12849238628817376-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f7d12849238628817376-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f7d12849238628817376-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f7d12849238628817376-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/**********************************</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d12849238628817376-2\"><span class=\"crayon-c\">         *                                *</span></div><div class=\"crayon-line\" id=\"crayon-58f7d12849238628817376-3\"><span class=\"crayon-c\">         *          Add one to i          *</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d12849238628817376-4\"><span class=\"crayon-c\">         *                                *</span></div><div class=\"crayon-line\" id=\"crayon-58f7d12849238628817376-5\"><span class=\"crayon-c\">         **********************************/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f7d12849238628817376-6\"> </div><div class=\"crayon-line\" id=\"crayon-58f7d12849238628817376-7\"><span class=\"crayon-h\">                       </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>先不要嘲笑，等到在现实中看到再去吧。</p>\n<p>或许除了诸如重要数据结构的声明（对数据的注释通常比对算法的更有帮助），这样至关重要部分之外，需要避免对注释的“可爱”排版和大段的注释；基本上最好就不要写注释。如果代码需要靠注释来说明，那最好的方法是重写代码，以便能更容易地理解。这就把我们带到了复杂度。</p>\n<h2>复杂度</h2>\n<p>许多程序过于复杂，比需要有效解决的问题更加复杂。这是为什么呢？大部分是由于设计不好，但我会跳过这个问题，因为这个问题太大了。然而程序往往在微观层面就很复杂，有关这些可以在这里解决。</p>\n<h3>规则 1：不要断定程序会在什么地方耗费运行时间。</h3>\n<p>瓶颈总是出现在令人意想不到的地方，直到证实瓶颈在哪，不要试图再次猜测并加快运行速度。</p>\n<h3>规则 2：估量（measure）</h3>\n<p>在没有对代码做出估量之前不要优化速度，除非发现最耗时的那部分代码，要不也不要去做。</p>\n<h3>规则 3：当 n 很小时（通常也很小），花哨的算法运行很慢。</h3>\n<p>花哨算法有很大的常数级别复杂度。在你确定 n 总是很大之前， 不要使用花哨算法。（即使假如 n 变大，也优先使用规则 2）.例如，对于常见问题，二叉树总比伸展树高效。</p>\n<h3>规则 4：花哨的算法比简单的算法更容易有 bug，而且实现起来也更困难</h3>\n<p>尽量使用简单的算法与简单的数据结构。</p>\n<p>以下几乎是所有实际程序中用到的数据结构：</p>\n<dl>\n<dt></dt>\n<dd>数组<br>\n链表<br>\n哈希表<br>\n二叉树</dd>\n</dl>\n<p>当然也必须要有把这些数据结构灵活结合的准备，比如用哈希表实现的符号表，其中哈希表是由字符型数组组成的链表。</p>\n<h3>规则 5：以数据为核心</h3>\n<p>如果选择了适当的数据结构并把一切都组织得很有条理性，算法总是不言而喻的。编程的核心是数据结构，而不是算法。（参考 Brooks p. 102）</p>\n<h3>规则 6：就是没有规则 6。</h3>\n<h2>数据编程</h2>\n<p>不像许多 if 语句，算法或算法的细节通常以紧凑、高效和明确的数据进行编码。眼前的工作可以编码，归根到底是由于其复杂性都是由不相干的细节组合而成。分析表是典型例子，它通过一种解析固定、简单代码段的形式，对编程语言的语法进行编码。有限状态机特别适合这种处理形式，但是几乎任何涉及到对构建数据驱动算法有益的程序，都是将某些抽象数据类型的输入“解析”成序列，序列会由一些独立“动作”构成。</p>\n<p>也许这种设计最有趣的地方是表结构有时可以由另一个程序生成（经典案例是解析生成器）。有个更接地气的例子，假如操作系统是由一组表驱动，这组表包含连接 I/O 请求到相应设备驱动的操作，那么可以通过程序“配置“系统，该程序可以读取到某些特殊设备与可疑机器连接的描述，并打印相应的表。</p>\n<p>数据驱动程序在初学者中不常见的原因之一是由于 Pascal 的专制。 Pascal 像它的创始人一样，坚信代码要和数据分开。因而（至少在原始形式上）无法创建初始化的数据。与图灵和冯诺依曼的理论背道而驰，这些理论可都是定义存储计算机的基本原理。代码和数据是一样的，或至少可以算是。还能怎样解释编译器的工作原理呢？（函数式语言对 I/O 也有类似的问题）</p>\n<h2>函数指针</h2>\n<p>Pascal 专制的另一个结果是初学者不使用函数指针。（在 Pascal 中没有把函数作为变量） 用函数指针来处理编码复杂度会有一些令人感兴趣的地方。</p>\n<p>指针指向的程序有一定的复杂度。这些程序必须遵守一些标准协议，像要求一组都是相同调用的程序就是其中之一。除此之外，所要实现的只是完成业务，复杂度是分散的。</p>\n<p>有个协议的主张是既然所有使用的功能相似，那么它们的行为也必须相似。这对简单的文档、测试、程序扩展和甚至使程序通过网络分布都有帮助——远程过程调用可以通过该协议进行编码。</p>\n<p>我认为面相对象编程的核心是清晰使用函数指针。规定好要对数据执行的一系列操作，以及对这些操作响应的整套数据类型。将程序合拢到一起最简单的方法是为每种类型使用一组函数指针。简而言之，就是定义类和方法。当然，面向对象语言提供了更多更漂亮的语法、派生类型等等，但在概念上几乎没有提出额外的东西。</p>\n<p>数据驱动程序与函数指针的结合，变成了一种表现令人惊讶的工作方法。根据我的经验，这种方法经常会产生惊喜的结果。即使没有面向对象语言，无需额外的工作也可以获得 90％ 的好处，并且能更好地管理结果。我无法再推荐出更高标准的实现方式。我所有的程序都是由这种方式组织管理，而且经过多次开发后都相安无事——远远优于缺少约束的方法。也许正如所说：从长远来看，约束会带来丰厚的回报。</p>\n<h2>包含文件</h2>\n<h3>简单规则：包含（include）文件时应该永远不要嵌套包含。</h3>\n<p>如果声明(在注释或隐式声明里)需要的文件没有优先包含进来，那么使用者（程序员）要决定包含哪些文件，但要以简单的方式处理，并采用避免多重包含的结构。多重包含是系统编程的祸根。将文件包含五次或更多次来编译一个单独的 C 源文件的事情屡见不鲜。Unix 系统中 /usr/include/sys 就用了这么可怕的方式。</p>\n<p>说到 #ifdef，有一个小插曲，虽然它能防止读取两次文件，但实际上经常用错。#ifdef 是定义在文件本身中，而不是文件包含它。结果是常常导致让成千上万不必要的代码通过词汇分析器，这是(优秀编译器中)耗费最大的阶段。</p>\n<p>只需遵从以上简单规则。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110929\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110929votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110929\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/pu_zhe\">PJing</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/pu_zhe\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/02/2c44246a2d67de5a89d43993a8be5090.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介真还没来得及写 :） : (        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/pu_zhe\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/pu_zhe/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/pu_zhe/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 13</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "a7a9a0b269f32a8d42a3e673f2a8941c", "title": "负载均衡原理的解析", "url": "http://blog.jobbole.com/110882/", "create_date": "2017/04/15", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/5ac0fa7a04f0f7bd0533b0ccac546de6.png"], "praise_nums": 3, "comment_nums": 0, "fav_nums": 8, "tags": "IT技术,负载均衡", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/3341316/blog/877206\">源子姗</a>   </div><div>\n<p>开头先理解一下所谓的“均衡”</p>\n<p>不能狭义地理解为分配给所有实际服务器一样多的工作量，因为多台服务器的承载能力各不相同，这可能体现在硬件配置、网络带宽的差异，也可能因为某台服务器身兼多职，我们所说的“均衡”，也就是希望所有服务器都不要过载，并且能够最大程序地发挥作用。</p>\n<h1>一、http重定向</h1>\n<p>当http代理（比如浏览器）向web服务器请求某个URL后，web服务器可以通过http响应头信息中的Location标记来返回一个新的URL。这意味着HTTP代理需要继续请求这个新的URL，完成自动跳转。</p>\n<p>性能缺陷：</p>\n<p>1、吞吐率限制</p>\n<p>主站点服务器的吞吐率平均分配到了被转移的服务器。现假设使用RR（Round Robin）调度策略，子服务器的最大吞吐率为1000reqs/s，那么主服务器的吞吐率要达到3000reqs/s才能完全发挥三台子服务器的作用，那么如果有100台子服务器，那么主服务器的吞吐率可想而知得有大？相反，如果主服务的最大吞吐率为6000reqs/s，那么平均分配到子服务器的吞吐率为2000reqs/s，而现子服务器的最大吞吐率为1000reqs/s，因此就得增加子服务器的数量，增加到6个才能满足。</p>\n<p>2、重定向访问深度不同</p>\n<p>有的重定向一个静态页面，有的重定向相比复杂的动态页面，那么实际服务器的负载差异是不可预料的，而主站服务器却一无所知。因此整站使用重定向方法做负载均衡不太好。</p>\n<p>我们需要权衡转移请求的开销和处理实际请求的开销，前者相对于后者越小，那么重定向的意义就越大，例如下载。你可以去很多镜像下载网站试下，会发现基本下载都使用了Location做了重定向。</p>\n<h1>二、DNS负载均衡</h1>\n<p>DNS负责提供域名解析服务，当访问某个站点时，实际上首先需要通过该站点域名的DNS服务器来获取域名指向的IP地址，在这一过程中，DNS服务器完成了域名到IP地址的映射，同样，这样映射也可以是一对多的，这时候，DNS服务器便充当了负载均衡调度器，它就像http重定向转换策略一样，将用户的请求分散到多台服务器上，但是它的实现机制完全不同。</p>\n<p>使用dig命令来看下”baidu”的DNS设置</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/5ac0fa7a04f0f7bd0533b0ccac546de6.png\" alt=\"\" width=\"483\" height=\"323\"></p>\n<p>可见baidu拥有三个A记录</p>\n<p>相比http重定向，基于DNS的负载均衡完全节省了所谓的主站点，或者说DNS服务器已经充当了主站点的职能。但不同的是，作为调度器，DNS服务器本身的性能几乎不用担心。因为DNS记录可以被用户浏览器或者互联网接入服务商的各级DNS服务器缓存，只有当缓存过期后才会重新向域名的DNS服务器请求解析。也说是DNS不存在http的吞吐率限制，理论上可以无限增加实际服务器的数量。</p>\n<p>特性:</p>\n<p>1、可以根据用户IP来进行智能解析。DNS服务器可以在所有可用的A记录中寻找离用记最近的一台服务器。</p>\n<p>2、动态DNS：在每次IP地址变更时，及时更新DNS服务器。当然，因为缓存，一定的延迟不可避免。</p>\n<p>不足：</p>\n<p>1、没有用户能直接看到DNS解析到了哪一台实际服务器，加服务器运维人员的调试带来了不便。</p>\n<p>2、策略的局限性。例如你无法将HTTP请求的上下文引入到调度策略中，而在前面介绍的基于HTTP重定向的负载均衡系统中，调度器工作在HTTP层面，它可以充分理解HTTP请求后根据站点的应用逻辑来设计调度策略，比如根据请求不同的URL来进行合理的过滤和转移。</p>\n<p>3、如果要根据实际服务器的实时负载差异来调整调度策略，这需要DNS服务器在每次解析操作时分析各服务器的健康状态，对于DNS服务器来说，这种自定义开发存在较高的门槛，更何况大多数站点只是使用第三方DNS服务。</p>\n<p>4、DNS记录缓存，各级节点的DNS服务器不同程序的缓存会让你晕头转向。</p>\n<p>5、基于以上几点，DNS服务器并不能很好地完成工作量均衡分配，最后，是否选择基于DNS的负载均衡方式完全取决于你的需要。</p>\n<h1>三、反向代理负载均衡</h1>\n<p>这个肯定大家都有所接触，因为几乎所有主流的Web服务器都热衷于支持基于反向代理的负载均衡。它的核心工作就是转发HTTP请求。</p>\n<p>相比前面的HTTP重定向和DNS解析，反向代理的调度器扮演的是用户和实际服务器中间人的角色：</p>\n<p>1、任何对于实际服务器的HTTP请求都必须经过调度器</p>\n<p>2、调度器必须等待实际服务器的HTTP响应，并将它反馈给用户（前两种方式不需要经过调度反馈，是实际服务器直接发送给用户）</p>\n<p>特性：</p>\n<p>1、调度策略丰富。例如可以为不同的实际服务器设置不同的权重，以达到能者多劳的效果。</p>\n<p>2、对反向代理服务器的并发处理能力要求高，因为它工作在HTTP层面。</p>\n<p>3、反向代理服务器进行转发操作本身是需要一定开销的，比如创建线程、与后端服务器建立TCP连接、接收后端服务器返回的处理结果、分析HTTP头部信息、用户空间和内核空间的频繁切换等，虽然这部分时间并不长，但是当后端服务器处理请求的时间非常短时，转发的开销就显得尤为突出。例如请求静态文件，更适合使用前面介绍的基于DNS的负载均衡方式。</p>\n<p>4、反向代理服务器可以监控后端服务器，比如系统负载、响应时间、是否可用、TCP连接数、流量等，从而根据这些数据调整负载均衡的策略。</p>\n<p>5、反射代理服务器可以让用户在一次会话周期内的所有请求始终转发到一台特定的后端服务器上（粘滞会话），这样的好处一是保持session的本地访问，二是防止后端服务器的动态内存缓存的资源浪费。</p>\n<h1>四、IP负载均衡(LVS-NAT)</h1>\n<p>因为反向代理服务器工作在HTTP层，其本身的开销就已经严重制约了可扩展性，从而也限制了它的性能极限。那能否在HTTP层面以下实现负载均衡呢？</p>\n<p>NAT服务器:它工作在传输层，它可以修改发送来的IP数据包，将数据包的目标地址修改为实际服务器地址。</p>\n<p>从Linux2.4内核开始，其内置的Neftilter模块在内核中维护着一些数据包过滤表，这些表包含了用于控制数据包过滤的规则。可喜的是，<a href=\"http://lib.csdn.net/base/linux\" target=\"_blank\" rel=\"nofollow\">Linux</a>提供了iptables来对过滤表进行插入、修改和删除等操作。更加令人振奋的是，Linux2.6.x内核中内置了IPVS模块，它的工作性质类型于Netfilter模块，不过它更专注于实现IP负载均衡。</p>\n<p>想知道你的服务器内核是否已经安装了IPVS模块，可以</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/65e506791aee42fb8c012fe28ef2e838.png\" alt=\"\" width=\"314\" height=\"232\"></p>\n<p>有输出意味着IPVS已经安装了。IPVS的管理工具是ipvsadm，它为提供了基于命令行的配置界面，可以通过它快速实现负载均衡系统。这就是大名鼎鼎的LVS(Linux Virtual Server，Linux虚拟服务器)。</p>\n<p>1、打开调度器的数据包转发选项</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f853faa53a0442166682\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\necho 1 &gt; /proc/sys/net/ipv4/ip_forward</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f853faa53a0442166682-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f853faa53a0442166682-1\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ipv4</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ip_forward</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>2、检查实际服务器是否已经将NAT服务器作为自己的默认网关，如果不是，如添加</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f853faa53af766765132\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroute add default gw xx.xx.xx.xx</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f853faa53af766765132-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f853faa53af766765132-1\"><span class=\"crayon-e\">route </span><span class=\"crayon-e\">add </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gw </span><span class=\"crayon-v\">xx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">xx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">xx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">xx</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>3、使用ipvsadm配置</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f853faa53b3916770674\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nipvsadm -A -t 111.11.11.11:80 -s rr</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f853faa53b3916770674-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f853faa53b3916770674-1\"><span class=\"crayon-v\">ipvsadm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">111.11.11.11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rr</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>添加一台虚拟服务器，-t 后面是服务器的外网ip和端口，-s rr是指采用简单轮询的RR调度策略（这属于静态调度策略，除此之外，LVS还提供了系列的动态调度策略，比如最小连接（LC）、带权重的最小连接（WLC），最短期望时间延迟（SED）等）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f853faa53b7512617616\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nipvsadm -a -t 111.11.11.11:80 -r 10.10.120.210:8000 -m\r\n\r\nipvsadm -a -t 111.11.11.11:80 -r 10.10.120.211:8000 -m</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f853faa53b7512617616-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f853faa53b7512617616-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f853faa53b7512617616-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f853faa53b7512617616-1\"><span class=\"crayon-v\">ipvsadm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">111.11.11.11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.10.120.210</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f853faa53b7512617616-2\"> </div><div class=\"crayon-line\" id=\"crayon-58f853faa53b7512617616-3\"><span class=\"crayon-v\">ipvsadm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">111.11.11.11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.10.120.211</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">m</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>添加两台实际服务器（不需要有外网ip），-r后面是实际服务器的内网ip和端口，-m表示采用NAT方式来转发数据包</p>\n<p>运行ipvsadm -L -n可以查看实际服务器的状态。这样就大功告成了。</p>\n<p>实验证明使用基于NAT的负载均衡系统。作为调度器的NAT服务器可以将吞吐率提升到一个新的高度，几乎是反向代理服务器的两倍以上，这大多归功于在内核中进行请求转发的较低开销。但是一旦请求的内容过大时，不论是基于反向代理还是NAT，负载均衡的整体吞吐量都差距不大，这说明对于一睦开销较大的内容，使用简单的反向代理来搭建负载均衡系统是值考虑的。</p>\n<p>这么强大的系统还是有它的瓶颈，那就是NAT服务器的网络带宽，包括内部网络和外部网络。当然如果你不差钱，可以去花钱去购买千兆交换机或万兆交换机，甚至负载均衡硬件设备，但如果你是个屌丝，咋办？</p>\n<p>一个简单有效的办法就是将基于NAT的集群和前面的DNS混合使用，比如５个100Mbps出口宽带的集群，然后通过DNS来将用户请求均衡地指向这些集群，同时，你还可以利用DNS智能解析实现地域就近访问。这样的配置对于大多数业务是足够了，但是对于提供下载或视频等服务的大规模站点，NAT服务器还是不够出色。</p>\n<h1>五、直接路由(LVS-DR)</h1>\n<p>NAT是工作在网络分层模型的传输层（第四层），而直接路由是工作在数据链路层（第二层），貌似更屌些。它通过修改数据包的目标MAC地址（没有修改目标IP），将数据包转发到实际服务器上，不同的是，实际服务器的响应数据包将直接发送给客户羰，而不经过调度器。</p>\n<p>1、网络设置</p>\n<p>这里假设一台负载均衡调度器，两台实际服务器，购买三个外网ip，一台机一个，三台机的默认网关需要相同，最后再设置同样的ip别名，这里假设别名为10.10.120.193。这样一来，将通过10.10.120.193这个IP别名来访问调度器，你可以将站点的域名指向这个IP别名。</p>\n<p>2、将ip别名添加到回环接口lo上</p>\n<p>这是为了让实际服务器不要去寻找其他拥有这个IP别名的服务器，在实际服务器中运行：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/7337e6c37cd8467257d5adf00a084ec9.png\" alt=\"\" width=\"726\" height=\"402\"></p>\n<p>另外还要防止实际服务器响应来自网络中针对IP别名的ARP广播，为此还要执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f853faa53bc867415507\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\necho \"1\" &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore\r\n\r\necho \"2\" &gt; /proc/sys/net/ipv4/conf/lo/arp_announce\r\n\r\necho \"1\" &gt; /proc/sys/net/ipv4/conf/all/arp_ignore\r\n\r\necho \"1\" &gt; /proc/sys/net/ipv4/conf/all/arp_announce</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f853faa53bc867415507-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f853faa53bc867415507-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f853faa53bc867415507-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f853faa53bc867415507-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f853faa53bc867415507-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f853faa53bc867415507-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f853faa53bc867415507-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f853faa53bc867415507-1\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ipv4</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">conf</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lo</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">arp_ignore</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f853faa53bc867415507-2\"> </div><div class=\"crayon-line\" id=\"crayon-58f853faa53bc867415507-3\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ipv4</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">conf</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lo</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">arp_announce</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f853faa53bc867415507-4\"> </div><div class=\"crayon-line\" id=\"crayon-58f853faa53bc867415507-5\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ipv4</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">conf</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">all</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">arp_ignore</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f853faa53bc867415507-6\"> </div><div class=\"crayon-line\" id=\"crayon-58f853faa53bc867415507-7\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ipv4</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">conf</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">all</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">arp_announce</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>配置完了就可以使用ipvsadm配置LVS-DR集群了</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f853faa53bf122445150\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nipvsadm -A -t 10.10.120.193:80 -s rr\r\n\r\nipvsadm -a -t 10.10.120.193:80 -r 10.10.120.210:8000 -g\r\n\r\nipvsadm -a -t 10.10.120.193:80 -r 10.10.120.211:8000 -g</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f853faa53bf122445150-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f853faa53bf122445150-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f853faa53bf122445150-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f853faa53bf122445150-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f853faa53bf122445150-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f853faa53bf122445150-1\"><span class=\"crayon-v\">ipvsadm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.10.120.193</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f853faa53bf122445150-2\"> </div><div class=\"crayon-line\" id=\"crayon-58f853faa53bf122445150-3\"><span class=\"crayon-v\">ipvsadm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span> <span class=\"crayon-cn\">10.10.120.193</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.10.120.210</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f853faa53bf122445150-4\"> </div><div class=\"crayon-line\" id=\"crayon-58f853faa53bf122445150-5\"><span class=\"crayon-v\">ipvsadm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span> <span class=\"crayon-cn\">10.10.120.193</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.10.120.211</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">g</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>-g 就意味着使用直接路由的方式转发数据包</p>\n<p>LVS-DR 相较于LVS-NAT的最大优势在于LVS-DR不受调度器宽带的限制，例如假设三台服务器在WAN交换机出口宽带都限制为10Mbps，只要对于连接调度器和两台实际服务器的LAN交换机没有限速，那么，使用LVS-DR理论上可以达到20Mbps的最大出口宽带，因为它的实际服务器的响应数据包可以不经过调度器而直接发往用户端啊，所以它与调度器的出口宽带没有关系，只能自身的有关系。而如果使用LVS-NAT，集群只能最大使用10Mbps的宽带。所以，越是响应数据包远远超过请求数据包的服务，就越应该降低调度器转移请求的开销，也就越能提高整体的扩展能力，最终也就越依赖于WAN出口宽带。</p>\n<p>总的来说，LVS-DR适合搭建可扩展的负载均衡系统，不论是Web服务器还是文件服务器，以及视频服务器，它都拥有出色的性能。前提是你必须为实际器购买一系列的合法IP地址。</p>\n<h1>六、IP隧道(LVS-TUN)</h1>\n<p>基于IP隧道的请求转发机制：将调度器收到的IP数据包封装在一个新的IP数据包中，转交给实际服务器，然后实际服务器的响应数据包可以直接到达用户端。目前Linux大多支持，可以用LVS来实现，称为LVS-TUN，与LVS-DR不同的是，实际服务器可以和调度器不在同一个WANt网段，调度器通过IP隧道技术来转发请求到实际服务器，所以实际服务器也必须拥有合法的IP地址。</p>\n<p>总体来说，LVS-DR和LVS-TUN都适合响应和请求不对称的Web服务器，如何从它们中做出选择，取决于你的网络部署需要，因为LVS-TUN可以将实际服务器根据需要部署在不同的地域，并且根据就近访问的原则来转移请求，所以有类似这种需求的，就应该选择LVS-TUN。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110882\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110882votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110882\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "6f89271d20f3251585be5c98942583b6", "title": "技术面试宝典： 很全面的算法和数据结构知识（含代码实现）", "url": "http://blog.jobbole.com/110835/", "create_date": "2017/04/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/02/d3d77d84514febf6c4b187e841df44a9.jpg"], "praise_nums": 8, "comment_nums": 0, "fav_nums": 35, "tags": "IT技术,技术面试,数据结构,算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx1265511474\">心灵是一棵开花的树</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://github.com/kdn251/Interviews\">Kevin Naughton</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><strong>目录</strong></p>\n<ul>\n<li>在线练习</li>\n<li>在线编程面试</li>\n<li>数据结构</li>\n<li>算法</li>\n<li>贪心算法</li>\n<li>位运算</li>\n<li>复杂度分析</li>\n<li>视频教程</li>\n<li>面试宝典</li>\n<li>计算机科学资讯</li>\n<li>文件结构</li>\n</ul>\n<p><strong>在线练习</strong></p>\n<ul>\n<li><a href=\"https://leetcode.com/\">LeetCode</a></li>\n<li><a href=\"https://vjudge.net/\">Virtual Judge</a></li>\n<li><a href=\"https://www.careercup.com/\">CareerCup</a></li>\n<li><a href=\"https://www.hackerrank.com/\">HackerRank</a></li>\n<li><a href=\"https://codefights.com/\">CodeFights</a></li>\n<li><a href=\"https://open.kattis.com/\">Kattis</a></li>\n<li><a href=\"https://www.hackerearth.com/\">HackerEarth</a></li>\n<li><a href=\"https://codility.com/programmers/lessons/1-iterations/\">Codility</a></li>\n<li><a href=\"http://codeforces.com/\">Code Forces</a></li>\n<li><a href=\"https://www.codechef.com/\">Code Chef</a></li>\n<li><a href=\"http://www.spoj.com/\">Sphere Online Judge – SPOJ</a></li>\n</ul>\n<p><strong>在线编程面试</strong></p>\n<ul>\n<li><a href=\"http://www.gainlo.co/#!/\">Gainlo</a></li>\n<li><a href=\"https://refdash.com/\">Refdash</a></li>\n</ul>\n<p><strong>数据结构</strong></p>\n<p><strong>链表</strong></p>\n<ul>\n<li>链表是一种由节点（Node）组成的线性数据集合，每个节点通过指针指向下一个节点。它是一种由节点组成，并能用于表示序列的数据结构。</li>\n<li><strong>单链表</strong>：每个节点仅指向下一个节点，最后一个节点指向空（null）。</li>\n<li><strong>双链表</strong>：每个节点有两个指针p，n。p指向前一个节点，n指向下一个节点；最后一个节点指向空。</li>\n<li><strong>循环链表</strong>：每个节点指向下一个节点，最后一个节点指向第一个节点。</li>\n<li>时间复杂度：\n<ul>\n<li>索引：O(n)</li>\n<li>查找：O(n)</li>\n<li>插入：O(1)</li>\n<li>删除：O(1)</li>\n</ul>\n</li>\n</ul>\n<p><strong>栈</strong></p>\n<ul>\n<li>栈是一个元素集合，支持两个基本操作：push用于将元素压入栈，pop用于删除栈顶元素。</li>\n<li>后进先出的数据结构（Last In First Out, LIFO）</li>\n<li>时间复杂度\n<ul>\n<li>索引：O(n)</li>\n<li>查找：O(n)</li>\n<li>插入：O(1)</li>\n<li>删除：O(1)</li>\n</ul>\n</li>\n</ul>\n<p><strong>队列</strong></p>\n<ul>\n<li>队列是一个元素集合，支持两种基本操作：enqueue 用于添加一个元素到队列，dequeue 用于删除队列中的一个元素。</li>\n<li>先进先出的数据结构（First In First Out, FIFO）。</li>\n<li>时间复杂度\n<ul>\n<li>索引：O(n)</li>\n<li>查找：O(n)</li>\n<li>插入：O(1)</li>\n<li>删除：O(1)</li>\n</ul>\n</li>\n</ul>\n<p><strong>树</strong></p>\n<ul>\n<li>树是无向、联通的无环图。</li>\n</ul>\n<p><strong>二叉树</strong></p>\n<ul>\n<li>二叉树是一个树形数据结构，每个节点最多可以有两个子节点，称为左子节点和右子节点。</li>\n<li><strong>满二叉树（Full Tree）</strong>：二叉树中的每个节点有 0 或者 2 个子节点。</li>\n<li><strong>完美二叉树（Perfect Binary）</strong>：二叉树中的每个节点有两个子节点，并且所有的叶子节点的深度是一样的。</li>\n<li><strong>完全二叉树</strong>：二叉树中除最后一层外其他各层的节点数均达到最大值，最后一层的节点都连续集中在最左边。</li>\n</ul>\n<p><strong>二叉查找树</strong></p>\n<ul>\n<li>二叉查找树（BST）是一种二叉树。其任何节点的值都大于等于左子树中的值，小于等于右子树中的值。</li>\n<li>时间复杂度\n<ul>\n<li>索引：O(log(n))</li>\n<li>查找：O(log(n))</li>\n<li>插入：O(log(n))</li>\n<li>删除：O(log(n))</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fehl7rmxs8j20od15ojuu.jpg\"></p>\n<p><strong>字典树</strong></p>\n<ul>\n<li>字典树，又称为基数树或前缀树，是一种用于存储键值为字符串的动态集合或关联数组的查找树。树中的节点并不直接存储关联键值，而是该节点在树中的位置决定了其关联键值。一个节点的所有子节点都有相同的前缀，根节点则是空字符串。</li>\n</ul>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fehl7r4nzfj20e80dcgmq.jpg\"></p>\n<p><strong>树状数组</strong></p>\n<ul>\n<li>树状数组，又称为二进制索引树（Binary Indexed Tree，BIT），其概念上是树，但以数组实现。数组中的下标代表树中的节点，每个节点的父节点或子节点的下标可以通过位运算获得。数组中的每个元素都包含了预计算的区间值之和，在整个树更新的过程中，这些计算的值也同样会被更新。</li>\n<li>时间复杂度\n<ul>\n<li>区间求和：O(log(n))</li>\n<li>更新：O(log(n))</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fehl7qs479j20hl0dcjuy.jpg\"></p>\n<p><strong>线段树</strong></p>\n<ul>\n<li>线段树是用于存储区间和线段的树形数据结构。它允许查找一个节点在若干条线段中出现的次数。</li>\n<li>时间复杂度\n<ul>\n<li>区间查找：O(log(n))</li>\n<li>更新：O(log(n))</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fehl7q5vwvj20hs0cdq4n.jpg\"></p>\n<p><strong>堆</strong></p>\n<ul>\n<li>堆是一种基于树的满足某些特性的数据结构：整个堆中的所有父子节点的键值都满足相同的排序条件。堆分为最大堆和最小堆。在最大堆中，父节点的键值永远大于等于所有子节点的键值，根节点的键值是最大的。最小堆中，父节点的键值永远小于等于所有子节点的键值，根节点的键值是最小的。</li>\n<li>时间复杂度\n<ul>\n<li>索引：O(log(n))</li>\n<li>查找：O(log(n))</li>\n<li>插入：O(log(n))</li>\n<li>删除：O(log(n))</li>\n<li>删除最大值/最小值：O(1)</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fehl7pkqxxj20p00w2ju4.jpg\"></p>\n<p><strong>哈希</strong></p>\n<ul>\n<li>哈希用于将任意长度的数据映射到固定长度的数据。哈希函数的返回值被称为哈希值、哈希码或者哈希。如果不同的主键得到相同的哈希值，则发生了冲突。</li>\n<li><strong>Hash Map</strong>：<em>hash map</em> 是一个存储键值间关系的数据结构。HashMap 通过哈希函数将键转化为桶或者槽中的下标，从而便于指定值的查找。</li>\n<li>冲突解决\n<ul>\n<li><strong>链地址法（</strong><strong>Separate Chaining</strong><strong>）</strong>：在链地址法中，每个桶（bucket）是相互独立的，每一个索引对应一个元素列表。处理HashMap 的时间就是查找桶的时间（常量）与遍历列表元素的时间之和。</li>\n<li><strong>开放地址法（</strong><strong>Open Addressing</strong><strong>）</strong>：在开放地址方法中，当插入新值时，会判断该值对应的哈希桶是否存在，如果存在则根据某种算法依次选择下一个可能的位置，直到找到一个未被占用的地址。开放地址即某个元素的位置并不永远由其哈希值决定。</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fehl7oz319j20fd0dc402.jpg\"></p>\n<p><strong>图</strong></p>\n<ul>\n<li>图是G =（V，E）的有序对，其包括顶点或节点的集合 V 以及边或弧的集合E，其中E包括了两个来自V的元素（即边与两个顶点相关联 ，并且该关联为这两个顶点的无序对）。</li>\n<li><strong>无向图</strong>：图的邻接矩阵是对称的，因此如果存在节点 u 到节点 v 的边，那节点 v 到节点 u 的边也一定存在。</li>\n<li><strong>有向图</strong>：图的邻接矩阵不是对称的。因此如果存在节点 u 到节点 v 的边并不意味着一定存在节点 v 到节点 u 的边。</li>\n</ul>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fehl7og3jej20p0133goj.jpg\"></p>\n<p><strong>算法</strong></p>\n<p><strong>排序</strong></p>\n<p><strong>快速排序</strong></p>\n<ul>\n<li>稳定：否</li>\n<li>时间复杂度\n<ul>\n<li>最优：O(nlog(n))</li>\n<li>最差：O(n^2)</li>\n<li>平均：O(nlog(n))</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://wx3.sinaimg.cn/large/6941baebly1fehl7nu4z7g20r107jqnp.gif\"></p>\n<p><strong>合并排序</strong></p>\n<ul>\n<li>合并排序是一种分治算法。这个算法不断地将一个数组分为两部分，分别对左子数组和右子数组排序，然后将两个数组合并为新的有序数组。</li>\n<li>稳定：是</li>\n<li>时间复杂度：\n<ul>\n<li>最优：O(nlog(n))</li>\n<li>最差：O(nlog(n))</li>\n<li>平均：O(nlog(n))</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://wx4.sinaimg.cn/large/6941baebly1fehl7icnjzg20hs0aokjn.gif\"></p>\n<p><strong>桶排序</strong></p>\n<ul>\n<li>桶排序是一种将元素分到一定数量的桶中的排序算法。每个桶内部采用其他算法排序，或递归调用桶排序。</li>\n<li>时间复杂度\n<ul>\n<li>最优：Ω(n + k)</li>\n<li>最差: O(n^2)</li>\n<li>平均：Θ(n + k)</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fehl7k0qx4j20hs07k75q.jpg\"></p>\n<p><strong>基数排序</strong></p>\n<ul>\n<li>基数排序类似于桶排序，将元素分发到一定数目的桶中。不同的是，基数排序在分割元素之后没有让每个桶单独进行排序，而是直接做了合并操作。</li>\n<li>时间复杂度\n<ul>\n<li>最优：Ω(nk)</li>\n<li>最差: O(nk)</li>\n<li>平均：Θ(nk)</li>\n</ul>\n</li>\n</ul>\n<p><strong>图算法</strong></p>\n<p><strong>深度优先</strong><strong>搜索</strong></p>\n<ul>\n<li>深度优先搜索是一种先遍历子节点而不回溯的图遍历算法。</li>\n<li>时间复杂度：O(|V| + |E|)</li>\n</ul>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fehl7jf9xtg20hs09974o.gif\"></p>\n<p><strong>广度优先</strong><strong>搜索</strong></p>\n<ul>\n<li>广度优先搜索是一种先遍历邻居节点而不是子节点的图遍历算法。</li>\n<li>时间复杂度：O(|V| + |E|)</li>\n</ul>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fehl7iwu8hg20hs09974o.gif\"></p>\n<p><strong>拓扑排序</strong></p>\n<ul>\n<li>拓扑排序是有向图节点的线性排序。对于任何一条节点 u 到节点 v 的边，u 的下标先于 v。</li>\n<li>时间复杂度：O(|V| + |E|)</li>\n</ul>\n<p><strong>Dijkstra算法</strong></p>\n<ul>\n<li>Dijkstra 算法是一种在有向图中查找单源最短路径的算法。</li>\n<li>时间复杂度：O(|V|^2)</li>\n</ul>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fehl77perwg20li09atbg.gif\"></p>\n<p><strong>Bellman-Ford算法</strong></p>\n<ul>\n<li><em>Bellman-Ford </em>是一种在带权图中查找单一源点到其他节点最短路径的算法。</li>\n<li>虽然时间复杂度大于 Dijkstra 算法，但它可以处理包含了负值边的图。</li>\n<li>时间复杂度：\n<ul>\n<li>最优：O(|E|)</li>\n<li>最差：O(|V||E|)</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fehl771hlsg20kr079438.gif\"></p>\n<p><strong>Floyd-Warshall 算法</strong></p>\n<ul>\n<li><em>Floyd-Warshall </em>算法是一种在无环带权图中寻找任意节点间最短路径的算法。</li>\n<li>该算法执行一次即可找到所有节点间的最短路径（路径权重和）。</li>\n<li>时间复杂度：\n<ul>\n<li>最优：O(|V|^3)</li>\n<li>最差：O(|V|^3)</li>\n<li>平均：O(|V|^3)</li>\n</ul>\n</li>\n</ul>\n<p><strong>最小生成树算法</strong></p>\n<ul>\n<li>最小生成树算法是一种在无向带权图中查找最小生成树的贪心算法。换言之，最小生成树算法能在一个图中找到连接所有节点的边的最小子集。</li>\n<li>时间复杂度：O(|V|^2)</li>\n</ul>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fehl76ellbg208q08zago.gif\"></p>\n<p><strong>Kruskal 算法</strong></p>\n<ul>\n<li><em>Kruskal </em>算法也是一个计算最小生成树的贪心算法，但在 Kruskal 算法中，图不一定是连通的。</li>\n<li>时间复杂度：O(|E|log|V|)</li>\n</ul>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fehl75byw0g208q08zgwv.gif\"></p>\n<p><strong>贪心算法</strong></p>\n<ul>\n<li>贪心算法总是做出在当前看来最优的选择，并希望最后整体也是最优的。</li>\n<li>使用贪心算法可以解决的问题必须具有如下两种特性：\n<ul>\n<li>最优子结构\n<ul>\n<li>问题的最优解包含其子问题的最优解。</li>\n</ul>\n</li>\n<li>贪心选择\n<ul>\n<li>每一步的贪心选择可以得到问题的整体最优解。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>实例-硬币选择问题</li>\n<li>给定期望的硬币总和为 V 分，以及 n 种硬币，即类型是 i 的硬币共有 coinValue[i] 分，i的范围是 [0…n – 1]。假设每种类型的硬币都有无限个，求解为使和为 V 分最少需要多少硬币？</li>\n<li>硬币：便士（1美分），镍（5美分），一角（10美分），四分之一（25美分）。</li>\n<li>假设总和 V 为41,。我们可以使用贪心算法查找小于或者等于 V 的面值最大的硬币，然后从 V 中减掉该硬币的值，如此重复进行。\n<ul>\n<li>V = 41 | 使用了0个硬币</li>\n<li>V = 16 | 使用了1个硬币(41 – 25 = 16)</li>\n<li>V = 6 | 使用了2个硬币(16 – 10 = 6)</li>\n<li>V = 1 | 使用了3个硬币(6 – 5 = 1)</li>\n<li>V = 0 | 使用了4个硬币(1 – 1 = 0)</li>\n</ul>\n</li>\n</ul>\n<p><strong>位</strong><strong>运算</strong></p>\n<ul>\n<li>位运算即在比特级别进行操作的技术。使用位运算技术可以带来更快的运行速度与更小的内存使用。</li>\n<li>测试第 k 位：s &amp; (1 &lt;&lt; k);</li>\n<li>设置第k位：s |= (1 &lt;&lt; k);</li>\n<li>关闭第k位：s &amp;= ~(1 &lt;&lt; k);</li>\n<li>切换第k位：s ^= (1 &lt;&lt; k);</li>\n<li>乘以2n：s &lt;&lt; n;</li>\n<li>除以2n：s &gt;&gt; n;</li>\n<li>交集：s &amp; t;</li>\n<li>并集：s | t;</li>\n<li>减法：s &amp; ~t;</li>\n<li>提取最小非0位：s &amp; (-s);</li>\n<li>提取最小0位：~s &amp; (s + 1);</li>\n<li>交换值：x ^= y; y ^= x; x ^= y;</li>\n</ul>\n<h1>运行时分析</h1>\n<p><strong>大 O 表示</strong></p>\n<ul>\n<li>大 O 表示用于表示某个算法的上界，用于描述最坏的情况。</li>\n</ul>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fehl74ftayj20hs0dc0sn.jpg\"></p>\n<p><strong>小 O 表示</strong></p>\n<ul>\n<li>小 O 表示用于描述某个算法的渐进上界，二者逐渐趋近。</li>\n</ul>\n<p><strong>大 Ω 表示</strong></p>\n<ul>\n<li>大 Ω 表示用于描述某个算法的渐进下界。</li>\n</ul>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fehl7409jrj20hs0dcjr9.jpg\"></p>\n<p><strong>小 ω 表示</strong></p>\n<ul>\n<li>小 ω 表示用于描述某个算法的渐进下界，二者逐渐趋近。</li>\n</ul>\n<p><strong>Theta Θ 表示</strong></p>\n<ul>\n<li>Theta Θ 表示用于描述某个算法的确界，包括最小上界和最大下界。</li>\n</ul>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fehl73k2kmj20hs0dc3yg.jpg\"></p>\n<p><strong>以为这就结束了？No, 这些知识不仅仅是停留在理论，还有代码实现。</strong></p>\n<p> </p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1feq19n1ig5j20br24bn79.jpg\" width=\"423\" height=\"2747\"></p>\n<p>这其实是来自 GitHub 的一个 repo：<a href=\"https://github.com/kdn251/interviews\" target=\"_blank\">https://github.com/kdn251/interviews</a></p>\n<p>除了上述算法和数据结知识外，其中还有推荐了一些算法练习网站、视频教程、面试宝典、Google、Facebook 等知名公司面试题及解答代码。下载实例代码或者收藏练习网站。</p>\n<p>Enjoy!</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110835\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110835votetotal\">8</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110835\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 35 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx1265511474\">心灵是一棵开花的树</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx1265511474\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            程序媛        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx1265511474\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/wx1265511474/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx1265511474/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 31</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "245df294b425b9b070c81590e15f95cf", "title": "200 行代码实现一个简单的区块链", "url": "http://blog.jobbole.com/110860/", "create_date": "2017/04/14", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/cbfe085c0bff85abc2536dce6e5c9aa4.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 3, "tags": "IT技术,区块链", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/randomli\">欣仔</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.com/@lhartikk/a-blockchain-in-200-lines-of-code-963cc1cc0e54#.nee3pfym6\">Lauri Hartikka</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>区块链的基础概念很简单：一个分布式数据库，存储一个不断加长的 list，list 中包含着许多有序的记录。然而，在通常情况下，当我们谈到区块链的时候也会谈起使用区块链来解决的问题，这两者很容易混淆。像流行的比特币和以太坊这样基于区块链的项目就是这样。“区块链”这个术语通常和像交易、智能合约、加密货币这样的概念紧紧联系在一起。</p>\n<p>这就令理解区块链变得不必要得复杂起来，特别是当你想理解源码的时候。<span id=\"pos_placeho200 行代码实现一个简单的区块链lder\" style=\"width: 0px; height: 0px; margin: 0px; padding: 0px;\"></span>下面我将通过 200 行 JS 实现的超级简单的区块链来帮助大家理解它，我给这段代码起名为 NaiveChain。</p>\n<h3>块结构</h3>\n<p>第一个逻辑步骤是决定块结构。为了保证事情尽可能的简单，我们只选择最必要的部分：index（下标）、timestamp（时间戳）、data（数据）、hash（哈希值）和 previous hash（前置哈希值）。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/large/63918611ly1femgx7dzc6j20m8057q3v.jpg\" width=\"800\" height=\"187\"></p>\n<p style=\"text-align: center;\">这个块中必须能找到前一个块的哈希值，以此来保证整条链的完整性。</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f84ad3ee685608848649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Block {\r\n    constructor(index, previousHash, timestamp, data, hash) {\r\n        this.index = index;\r\n        this.previousHash = previousHash.toString();\r\n        this.timestamp = timestamp;\r\n        this.data = data;\r\n        this.hash = hash.toString();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee685608848649-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee685608848649-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee685608848649-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee685608848649-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee685608848649-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee685608848649-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee685608848649-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee685608848649-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee685608848649-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f84ad3ee685608848649-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee685608848649-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">constructor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previousHash</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timestamp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee685608848649-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee685608848649-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">previousHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previousHash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee685608848649-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">timestamp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timestamp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee685608848649-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee685608848649-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee685608848649-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee685608848649-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p></p>\n<h3>块哈希</h3>\n<p>为了保存完整的数据，必须哈希区块。SHA-256会对块的内容进行加密，记录这个值应该和“挖矿”毫无关系，因为这里不需要解决工作量证明的问题。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f84ad3ee68f383307924\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvar calculateHash = (index, previousHash, timestamp, data) =&gt; {\r\n    return CryptoJS.SHA256(index + previousHash + timestamp + data).toString();\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee68f383307924-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee68f383307924-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee68f383307924-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f84ad3ee68f383307924-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">calculateHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previousHash</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timestamp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee68f383307924-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CryptoJS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SHA256</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previousHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timestamp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee68f383307924-3\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h3>块的生成</h3>\n<p>要生成一个块，必须知道前一个块的哈希值，然后创造其余所需的内容（= index, hash, data and timestamp）。块的data部分是由终端用户所提供的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f84ad3ee693741200610\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvar generateNextBlock = (blockData) =&gt; {\r\n    var previousBlock = getLatestBlock();\r\n    var nextIndex = previousBlock.index + 1;\r\n    var nextTimestamp = new Date().getTime() / 1000;\r\n    var nextHash = calculateHash(nextIndex, previousBlock.hash, nextTimestamp, blockData);\r\n    return new Block(nextIndex, previousBlock.hash, nextTimestamp, blockData, nextHash);\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee693741200610-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee693741200610-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee693741200610-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee693741200610-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee693741200610-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee693741200610-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee693741200610-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f84ad3ee693741200610-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">generateNextBlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">blockData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee693741200610-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previousBlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getLatestBlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee693741200610-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previousBlock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee693741200610-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextTimestamp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getTime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee693741200610-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">calculateHash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextIndex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previousBlock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextTimestamp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee693741200610-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextIndex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previousBlock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextTimestamp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextHash</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee693741200610-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p>\n<h3>块的存储</h3>\n<p>内存中的Javascript数组被用于存储区块链。区块链的第一个块通常被称为“起源块”，是硬编码的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f84ad3ee697412778564\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvar getGenesisBlock = () =&gt; {\r\n    return new Block(0, \"0\", 1465154705, \"my genesis block!!\", \"816534932c2b7154836da6afc367695e6337db8a921823784c14378abed4f7d7\");\r\n};\r\n\r\nvar blockchain = [getGenesisBlock()];</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee697412778564-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee697412778564-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee697412778564-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee697412778564-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee697412778564-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f84ad3ee697412778564-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">getGenesisBlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee697412778564-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1465154705</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"my genesis block!!\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"816534932c2b7154836da6afc367695e6337db8a921823784c14378abed4f7d7\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee697412778564-3\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee697412778564-4\"> </div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee697412778564-5\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">getGenesisBlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h3>确认块的完整性</h3>\n<p>在任何时候都必须能确认一个区块或者一整条链的区块是否完整。在我们从其他节点接收到新的区块，并需要决定接受或拒绝它们时，这一点尤为重要。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f84ad3ee69b410933035\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvar isValidNewBlock = (newBlock, previousBlock) =&gt; {\r\n    if (previousBlock.index + 1 !== newBlock.index) {\r\n        console.log('invalid index');\r\n        return false;\r\n    } else if (previousBlock.hash !== newBlock.previousHash) {\r\n        console.log('invalid previoushash');\r\n        return false;\r\n    } else if (calculateHashForBlock(newBlock) !== newBlock.hash) {\r\n        console.log('invalid hash: ' + calculateHashForBlock(newBlock) + ' ' + newBlock.hash);\r\n        return false;\r\n    }\r\n    return true;\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee69b410933035-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee69b410933035-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee69b410933035-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee69b410933035-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee69b410933035-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee69b410933035-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee69b410933035-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee69b410933035-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee69b410933035-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee69b410933035-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee69b410933035-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee69b410933035-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee69b410933035-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f84ad3ee69b410933035-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">isValidNewBlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">newBlock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previousBlock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee69b410933035-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">previousBlock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newBlock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee69b410933035-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'invalid index'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee69b410933035-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee69b410933035-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">previousBlock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newBlock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">previousHash</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee69b410933035-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'invalid previoushash'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee69b410933035-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee69b410933035-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">calculateHashForBlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">newBlock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newBlock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee69b410933035-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'invalid hash: '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">calculateHashForBlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">newBlock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newBlock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee69b410933035-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee69b410933035-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee69b410933035-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee69b410933035-13\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0058 seconds] -->\r\n<p></p>\n<h3><span style=\"font-weight: normal;\">选择最长的链</span></h3>\n<p>任何时候在链中都应该只有一组明确的块。万一冲突了（例如：两个结点都生成了72号块时），会选择有最大数目的块的链。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611ly1femgx7s0cnj20m80c7taq.jpg\" width=\"690\" height=\"379\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f84ad3ee6a1707618130\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvar replaceChain = (newBlocks) =&gt; {\r\n    if (isValidChain(newBlocks) &amp;&amp; newBlocks.length &gt; blockchain.length) {\r\n        console.log('Received blockchain is valid. Replacing current blockchain with received blockchain');\r\n        blockchain = newBlocks;\r\n        broadcast(responseLatestMsg());\r\n    } else {\r\n        console.log('Received blockchain invalid');\r\n    }\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a1707618130-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a1707618130-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a1707618130-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a1707618130-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a1707618130-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a1707618130-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a1707618130-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a1707618130-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a1707618130-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a1707618130-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">replaceChain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">newBlocks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a1707618130-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isValidChain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">newBlocks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newBlocks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a1707618130-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Received blockchain is valid. Replacing current blockchain with received blockchain'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a1707618130-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newBlocks</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a1707618130-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">broadcast</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">responseLatestMsg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a1707618130-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a1707618130-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Received blockchain invalid'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a1707618130-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a1707618130-9\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p></p>\n<h3>与其他结点的通信</h3>\n<p>结点的本质是和其他结点共享和同步区块链，下面的规则能保证网络同步。</p>\n<ul>\n<li>当一个结点生成一个新块时，它会在网络上散布这个块。</li>\n</ul>\n<ul>\n<li>当一个节点连接新peer时，它会查询最新的block。</li>\n</ul>\n<ul>\n<li>当一个结点遇到一个块，其index大于当前所有块的index时，它会添加这个块到它当前的链中，或者到整个区块链中查询这个块。</li>\n</ul>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611ly1femgx87ba7j20m8087t9h.jpg\" width=\"690\" height=\"254\"></p>\n<p style=\"text-align: center;\">如图为当节点遵循前文所述协议时会发生的一些典型通信场景</p>\n<p>我没有采用自动发现peer的工具。peers的位置（URL）必须是手动添加的。</p>\n<h3>结点控制</h3>\n<p>在某种程度上用户必须能够控制结点。这一点通过搭建一个HTTP服务器可以实现。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f84ad3ee6a5178870948\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvar initHttpServer = () =&gt; {\r\n    var app = express();\r\n    app.use(bodyParser.json());\r\n\r\n    app.get('/blocks', (req, res) =&gt; res.send(JSON.stringify(blockchain)));\r\n    app.post('/mineBlock', (req, res) =&gt; {\r\n        var newBlock = generateNextBlock(req.body.data);\r\n        addBlock(newBlock);\r\n        broadcast(responseLatestMsg());\r\n        console.log('block added: ' + JSON.stringify(newBlock));\r\n        res.send();\r\n    });\r\n    app.get('/peers', (req, res) =&gt; {\r\n        res.send(sockets.map(s =&gt; s._socket.remoteAddress + ':' + s._socket.remotePort));\r\n    });\r\n    app.post('/addPeer', (req, res) =&gt; {\r\n        connectToPeers([req.body.peer]);\r\n        res.send();\r\n    });\r\n    app.listen(http_port, () =&gt; console.log('Listening http on port: ' + http_port));\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a5178870948-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a5178870948-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a5178870948-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a5178870948-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a5178870948-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a5178870948-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a5178870948-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a5178870948-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a5178870948-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a5178870948-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a5178870948-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">initHttpServer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a5178870948-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">express</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bodyParser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a5178870948-4\"> </div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/blocks'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stringify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a5178870948-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/mineBlock'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">newBlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">generateNextBlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a5178870948-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">addBlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">newBlock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">broadcast</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">responseLatestMsg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a5178870948-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'block added: '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stringify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">newBlock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a5178870948-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/peers'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a5178870948-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sockets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">remoteAddress</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">':'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">remotePort</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a5178870948-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/addPeer'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">connectToPeers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">peer</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a5178870948-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a5178870948-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http_port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Listening http on port: '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http_port</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a5178870948-21\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0078 seconds] -->\r\n<p>用户可以用下面的方法和结点互动：</p>\n<ul>\n<li>列出所有的块</li>\n</ul>\n<ul>\n<li>用用户提供的内容创建一个新的块</li>\n</ul>\n<ul>\n<li>列出或者新增peers</li>\n</ul>\n<p>下面这个Curl的例子就是最直接的控制结点的方法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-58f84ad3ee6a9511497910\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#get all blocks from the node\r\ncurl http://localhost:3001/blocks</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-58f84ad3ee6a9511497910-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-58f84ad3ee6a9511497910-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-58f84ad3ee6a9511497910-1\"><span class=\"crayon-p\">#get all blocks from the node</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-58f84ad3ee6a9511497910-2\"><span class=\"crayon-e\">curl </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//localhost:3001/blocks</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3>体系结构</h3>\n<p>需要指出的是，节点实际上展现了两个web服务器：一个（HTTP服务器）是让用户控制节点，另一个（Websocket HTTP服务器）。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611ly1femgx8q1r4j20at04w3yg.jpg\" width=\"389\" height=\"176\"></p>\n<p style=\"text-align: center;\">NaiveChain的主要组成部分</p>\n<h3>总结</h3>\n<p>创造 NaiveChain 的目的是为了示范和学习，因为它并没有“挖矿”算法（PoS of PoW），不能被用于公用网络，但是它实现了区块链运作的基本特性。</p>\n<p>你可以在 Github 库中查看更多的技术细节。 https://github.com/lhartikk/naivechain</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/08/647babf96cf39feeea99ca6771f37763.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110860\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110860votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110860\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/randomli\">欣仔</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/randomli\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/12/5858dcb1cf754469936ed3326e54932e.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            假装会写代码的伪程序员~        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/randomli\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/randomli/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/randomli/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/1715653890/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1\"><i class=\"fa fa-weibo\"></i></a> <a title=\"QQ：497480210\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},
{"url_object_id": "3c3d477dded1f683e01a23eb62219059", "title": "未来是属于算法的，不是代码", "url": "http://blog.jobbole.com/110841/", "create_date": "2017/04/11", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/10/9184208f96827c412ab7d3570590ef76.jpg"], "praise_nums": 3, "comment_nums": 4, "fav_nums": 6, "tags": "IT技术,代码,算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"><p><script src=\"http://www.imooc.com/open/courselistrandjs\"></script><span style=\"display:block;margin-bottom:10px;\"></span></p>\n</div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://hackernoon.com/the-future-is-algorithms-not-code-64cacca3b908#.2sdlw4gsb\">hackernoon</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>大数据的时代已经来临。数据带来的狂潮就犹如又一次工业革命一样席卷着人类。在大数据的时代，人类对世界的理解方法从<strong>有限具体</strong>向<strong>抽象</strong>过渡，这也就是为什么算法比代码更加重要的原因。</p>\n<h3 id=\"b8db\" class=\"graf graf--h3 graf-after--p\">说到大数据……</h3>\n<p id=\"8222\" class=\"graf graf--p graf-after--h3\">如果把人类的历史压缩到一天，那么我们可以忽略之前的时间，直接从晚上11点07分开始说起。这本该是安静的一天，但是就在这一天快结束的短短的时段里，突然产生出大量的知识和信息，需要在人与人之间进行传播。你可以想象一下，之前，人类的知识和信息的传播方式是通过口口相传，代代相传，由父到子，师授徒承的方式来进行的。而在某一个时刻，人类社会所产生出的知识和信息的体量已经达到了传统方式无法承载的地步。</p>\n<p id=\"d7c4\" class=\"graf graf--p graf-after--p\">我们需要某种方式来对如此规模的知识和信息进行存储和传播。以前，采用书写的方式记录知识和信息，被认为是人类社会的重大技术革新。然而，柏拉图在《斐德罗篇》中写道：“苏格拉抵对采用书本进行知识传承的方法表示担忧，因为他认为书本并不能激发真正的知识和智慧，正确的方法应该是口口相传。”</p>\n<p id=\"94c3\" class=\"graf graf--p graf-after--p\">他的观点正好代表了知识和信息的有限传播方法。你和你认识的人通过说话进行直接交流，那么在交流对话过程中就有正向和反向的观点产生。而一本书，则完全不同，这是一种抽象的交流传播方法，因为读者和作者之间并没有直接的交流。书的作者不可能知道是谁，多少人，在什么时候什么地点读了他们的作品。书的作者也许可以根据读者们的情况对作品进行一些优化调整，但是总的来说这还是一种抽象的知识传播和学习的方法。</p>\n<h3 id=\"7113\" class=\"graf graf--h3 graf-after--p\">大数据和等腰三角形</h3>\n<p id=\"f16f\" class=\"graf graf--p graf-after--h3\">大数据时代产生的另外一项重要变革，就是我们会从简单计算向抽象计算过度。也就是形成了定理、符号、算法等等被称之为数学的思想。人类历史上有记载的最早的计算始于公元前 2500 年的美索不达米亚。当时美索不达米亚人需要算出一个装满的谷仓能够养活多少人。</p>\n<p id=\"3be6\" class=\"graf graf--p graf-after--p\">美索不达米亚人的问题是非常具体的。他们的计算问题是为了解决生活中的相应问题。这种一个计算问题对应一个生活中具体问题的模式，就被称作是<strong>有限具体问题</strong>。这也是为什么很多专家认为美索不达米亚人的计算并不是数学的起源。这种有限具体的计算模式一直持续了很久，直到公元前500年的古希腊。那时的毕达哥拉斯学派的学者们开始研究奇怪的三角形的问题。比如：等腰三角形的边长是不是都是整数。</p>\n<p id=\"d2ef\" class=\"graf graf--p graf-after--p\">如果你采用有限具体的方法来解答这类问题，就要像毕达哥拉斯学派的学者们当时做的那样，通过把具体的数字代入进去看情况是不是满足。不过，随着代入数字的数量越来越多，复杂性的问题出现了。你究竟需要代入多少数据，才能最终证明这个命题是真还是假呢？（顺便说一下，这个命题是假的，不可能所有等腰三角形的边长都是整数。）等腰三角形边长问题的不同之处在于，它是不具体的。因为这个命题没有限定三角形的面积，也没有限定边长范围。因此可能的情况是无穷多的。不过一旦你开始把理性思维应用到大量数字上，那么就形成了数学思想。这也就是大数据的意思。毕达哥拉斯学派的思维方式将人类带向了更接近抽象的数学本质，我们今天也在用符号、规则系统以及理性的思维来解决这类抽象的问题。</p>\n<p id=\"3f2f\" class=\"graf graf--p graf-after--p\">也许你能在人类历史上找出更多关于大数据的例子，但是从本文的目的出发，我则要直接跳到20世纪，来看看编码是如何兴起，以及如何在现代科技世界中扮演重要角色的。</p>\n<h3 id=\"c917\" class=\"graf graf--h3 graf-after--p\">编程的兴起</h3>\n<p id=\"3210\" class=\"graf graf--p graf-after--h3\">编码，或者叫编程（我们在这里认为这两个词是一个意思）首次出现在历史舞台，要追溯到美国女海军少将Grace Hooper女士1945年在哈佛Mark I型计算机上工作的那个年代。在此之前，电脑（Computer）这个词，现在大家都这么叫，就是单纯的“计算机器”。第二次世界大战期间，发射火炮需要参照一个弹道表来计算弹道。弹道表上的数据，是用偏微分方程代入上百个不同的参数因子算出来的，这些参数包括：距离，海拔，风速，温度，湿度等等。顺便说一下，“电脑”（Computer）这个词，是军方用来形容那些战争期间操作计算机器的女性操作员的。这些女性操作员以“电脑”而闻名。她们需要把计算卡插入计算机器，然后摇动手柄解出方程。制作一张计算卡当时需要170个人月的工作量。</p>\n<p id=\"96c3\" class=\"graf graf--p graf-after--p\">编程的出现，源于人们想找到一种更简单的方式来执行计算过程。如果我们能够为计算机器设计一套指令，让硬件能够根据指令来执行操作，那么那些对机器的手工操作就可以淘汰了。</p>\n<p id=\"5eb3\" class=\"graf graf--p graf-after--p\">这种方式听上去是不是很耳熟？美索不达米亚人采用泥板来进行计算，而编程则是20世纪人类使用的“新泥板”。尽管编程看上去比泥板要先进多了，但是本质上都是对具体问题进行的有限计算。只是用编程的方式计算效率更高。编程淘汰了手动计算的方式，让人类有能力去处理大量的数据。</p>\n<h3 id=\"03cc\" class=\"graf graf--h3 graf-after--p\">算法 vs. 代码</h3>\n<blockquote id=\"090e\" class=\"graf graf--pullquote graf-after--h3\"><p>算法：用一系列步骤来描述解决某种问题的思想，执行这些步骤后可以达到问题的正确性条件和终结条件。算法是对计算的一种抽象描述，与具体的实现无关。</p></blockquote>\n<blockquote id=\"722b\" class=\"graf graf--pullquote graf-after--pullquote\"><p>代码：计算机的一套指令集。在特定平台上使用特定的计算机语言对计算问题进行具体实现。</p></blockquote>\n<p id=\"f3fb\" class=\"graf graf--p graf-after--pullquote\">计算机提供的指令操作的方式让人类可以通过算法来实现复杂的计算。而算法本身却是远在编程发明之前就存在的。穆斯林数学家Al-Khawarizm在公元820年就提出了一次和二次方程的求根算法。而算法（Algorithm）这个词就是从Al-Khawarizm的名字的拉丁语译名“Algoritmi”演变而来，“代数”（Algebra）这个词则是来自于阿拉伯语“al-jabr”，这是Al-Khawarizm在解二次方程时所用的一个步骤的名称。算法要求其步骤或指令是有限的，可实现的，而且能得到结果。正如我们所见，编程可以直接给计算机下指令。这种方式正好对实现算法非常有利，因为从本质上来说，编程就是让计算机按照一定的顺序执行不同的指令。</p>\n<p class=\"graf graf--p graf-after--p\">在大数据时代的早期，我们要处理的信息量大大增加。不过通过设计和应用，可以让我们在编程方面取得优势，再加上“摩尔定律”带来的机器性能上的进步，让我们有能力处理人类世界日益增长的数字化需求。但是用计算机解决有限具体问题的本质并没有变，因为人类是通过写代码来告诉计算机硬件具体需要执行哪些操作。不管这些操作本身有多复杂，但是终究还是来自于人类的指令。不过，算法已经展示出了巨大的潜力，或许能开创一个全新的抽象时代。</p>\n<h3 id=\"910e\" class=\"graf graf--h3 graf-after--p\">算法的兴起</h3>\n<p class=\"graf graf--p graf-after--h3\">从下面这个角度，我们可以看到算法与编码的巨大不同：你可以用代码实现算法。并且，算法的不同实现方式会影响算法的性能。例如，使用binary heap来搜索序列中的最大或最小元素就比较高效，用来排序则没那么高效。但是你会编程并不意味着你能设计算法，这和你能唱歌不一定就能写歌是一个道理。</p>\n<p class=\"graf graf--p graf-after--p\">所有人都知道，“摩尔定律”预言的硬件性能的增长刺激了数字化经济的发展，但是很少有人知道，在很多领域，算法带来的性能增长远比硬件来得更高。实际上，根据2010年的联邦报告显示，算法在语音识别，自然语言处理，物流等方面都带来了显著的性能增长。</p>\n<blockquote id=\"26b6\" class=\"graf graf--pullquote graf--startsWithDoubleQuote graf-after--p\"><p>“尽管公众的理解程度并不高，但是仍然不能掩盖其卓越的效果——在许多领域，算法的进步带来的性能增长要远超CPU计算速度增长的贡献。”——节选自“致总统和国会的报告：设计数字化未来”</p></blockquote>\n<h3 id=\"1bee\" class=\"graf graf--h3 graf-after--pullquote\">抽象算法</h3>\n<p id=\"48a4\" class=\"graf graf--p graf-after--h3\">我们在目前的这个时代需要处理的数据量，让我们必须放弃之前具体有限的思维方式。这是大数据迫使我们这么做的。大数据迫使我们必须后退一步，这是抽象的一步，以便于我们能够找到一种有效的方法，来处理当今时代汹涌泛滥的数据潮流。传统的做法是，你写一段代码，通过特定的参数或模式来对数据库进行搜索。比如，你要搜索“客户数据库”，找出在两周内购买2件以上物品，且支出超过30欧元的客户有哪些。你想给这类客户提供一些建议。所以你提供一种模式去搜索这些用户的数据。但是，大数据的方式是正好相反的，你需要通过大量的数据来找出模式是什么样的。</p>\n<p id=\"8db7\" class=\"graf graf--p graf-after--p\">试想一下。这里有海量的数据，人类无法从中直观地找出模式。这时你就必须再退一步。这抽象的一步是为了让我们利用聚类，分类，机器学习等为基础的新方法（而不是具体的程序代码），从数据中找出有用的模式。这一步的关键在于，要找出你我看不见的模式。就像是光谱里的波长一样，人的肉眼是看不出来的，如果数据超过了一定的体量，那模式就不再直观了。这种超过一定体量，我们无法直接看出模式的数据，就叫做大数据。</p>\n<p id=\"70bf\" class=\"graf graf--p graf-after--p\">这抽象算法的一步会走得更远。它不仅能帮我们找出数据中隐藏的模式，甚至还能帮我们写算法的代码。在Pedro Domingos写的“终极算法”这本书里，描述了一种“学习算法”，通过机器学习的手段，这种算法不但能够创造新的算法，而且还能写出我们需要的代码，这样计算机就能“自己写代码了，就把人类从编码中解放出来。”为了达到这样的目的，我们就必须对这些算法的工作原理有更好的了解，并通过改进这些算法，让它们能够更贴合我们的需要。不然，我们就没法充分发挥这种抽象转变的巨大潜力。</p>\n<blockquote id=\"6a1d\" class=\"graf graf--pullquote graf--startsWithDoubleQuote graf-after--p\"><p>“工业革命把人类从手工劳动中解放出来，而信息革命将人类从脑力劳动中解放出来，但是机器学习则是让计算机解放了自己。如果没有机器学习，程序员将成为革命进程的瓶颈；有了它，进度就不成问题。”——Pedro Domingos, “终极算法”</p></blockquote>\n<h3 id=\"611f\" class=\"graf graf--h3 graf-after--pullquote\">关于算法的思考</h3>\n<p id=\"0a36\" class=\"graf graf--p graf-after--h3\">在从具体有限的计算向抽象计算过度的过程中，我们还是需要各种各样的程序员的。不过这不是问题的关键。我不是要说编程不重要，也不是说编程不会做出贡献了。我想表达的观点是，我们需要开始对算法加以重视。算法并不仅仅是数学家需要关心，或者在学校里面才会用的东西。其实我们在编程的时候，算法就在我们周围，只是大家觉得不需要知道算法的实现或者原理罢了。目前，已经有人在致力于把更先进的技术（例如遗传算法）应用到大数据上，从而探索在不同领域进行优化和改进的可能了。甚至有人对金属冷却的过程进行建模，然后创建了效率更好的优化算法。（这种算法叫做“退火法”，这是一个从非常规角度思考算法的好例子，感兴趣的可以了解一下。）</p>\n<p id=\"97b4\" class=\"graf graf--p graf-after--p graf--trailing\">目前，编程已经被提高到了和读书、写字一样的地位，在新的数字化经济时代成为了一个关键技能。这种热度反而掩盖了我们对算法的看法。算法逐渐成为我们生活的一部分：想想那些网上电影推荐，新闻推荐，正是算法根据我们的行为归纳了我们的模式。我们需要对算法加深理解，只有这样，我们才能更加深刻地理解我们的未来。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/04/78805a221a988e79ef3f42d7c5bfd4187.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"110841\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"110841votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"110841\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/avatars/5423/Corbis-42-221258652.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            黄小非：毕业于重庆大学计算机系，南开大学软件工程硕士，SCJP。 目前在一家国企信息中心任职软件开发工程师。主要技术兴趣为Java平台相关技术、系统构架、C/C++、计算机图形学等。（新浪微博：@黄小非）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/huangxiaofei\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/huangxiaofei/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 50</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
]